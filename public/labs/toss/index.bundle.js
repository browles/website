!function(t){function e(n){if(i[n])return i[n].exports;var s=i[n]={exports:{},id:n,loaded:!1};return t[n].call(s.exports,s,s.exports,e),s.loaded=!0,s.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){"use strict";function n(t){this.node=t,this.children=[];for(var e=0,i=_.bodies.length;i>e;e++)this.children.push(new s(t.addChild(),_.bodies[e]));r.requestUpdate(this)}function s(t,e){this.node=t,this.body=e,this.node.setProportionalSize(.9,.9,0),this.node.setMountPoint(.5,.5),this.node.setOrigin(.5,.5),this.el=new a(t),this.el.setProperty("background",e.color),this.el.setProperty("zIndex",e.zIndex),this.el.setProperty("borderRadius","20px"),this.el.setProperty("color","white"),this.el.setProperty("textAlign","center"),this.el.setProperty("fontSize","40px"),this.el.setProperty("lineHeight","300px"),this.el.setContent(""+(e.i+1)),this.gestures=new o(t),this.gestures.on("drag",function(t){switch(t.status){case"move":g.position.set(t.center.x,t.center.y,0).subtract(_.origin);break;case"start":e.dragging=!0,g.position.set(t.center.x,t.center.y,0).subtract(_.origin),e.zIndex=++f,d=new u.BallAndSocket(e,g,{anchor:h.Vec3.clone(g.position)}),_.add(d);var i=e.i;_.remove(v[i],m[i]);break;case"end":e.dragging=!1,_.remove(d),_.add(v[E],m[E])}})}var r=i(26),o=i(33),a=i(34),h=i(46),u=i(67),c=i(25);r.init();var p=window.innerWidth,l=window.innerHeight,d=null,f=0,_=new c({origin:new h.Vec3(p/2,25+l/2,0)});window.onresize=function(){p=window.innerWidth,l=window.innerHeight,_.setOrigin(p/2,25+l/2,0)},window.addEventListener("mousemove",function(t){t.preventDefault()}),window.addEventListener("touchmove",function(t){t.preventDefault()}),n.prototype.onUpdate=function(t){_.update(t);for(var e=0,i=this.children.length;i>e;e++)this.children[e].update();r.requestUpdateOnNextTick(this)},s.prototype.update=function(){var t=_.getTransform(this.body),e=t.position,i=t.rotation;this.node.setPosition(e[0],e[1],e[2]),this.node.setRotation(i[0],i[1],i[2],i[3]),this.el.setProperty("zIndex",this.body.zIndex)};for(var g=new u.Particle({mass:1e8,restrictions:["xyz","xyz"]}),y=[],v=[],m=[],w=10,x=Math.floor(360*Math.random()),E=0;w>E;E++){var C=[.95*p,.95*l,100],I=new u.Box({size:C,mass:1,restrictions:["z","xy"]});I.i=E,I.color="hsl("+(x+90*E%360)+",50%,50%)",I.dragging=!1,I.setPosition(.5*-w+E,.5*-w+E,0);var T=new u.Spring(null,I,{period:.2,dampingRatio:1,anchor:h.Vec3.clone(I.position)}),b=new u.RotationalSpring(null,I,{period:.2,dampingRatio:1});y.push(I),v.push(T),m.push(b)}var z=new u.Drag(y,{strength:.7}),S=new u.RotationalDrag(y,{strength:5});_.add(y,v,m,z,S);var M=new h.Vec3,R=new h.Vec3;_.on("prestep",function(t){y.forEach(function(t,e){var i=h.Vec3.subtract(t.position,M,R);i.dot(t.velocity)>0&&t.velocity.length()>250?_.remove(v[e],m[e]):i.length()>.65*p?_.remove(v[e],m[e]):!t.dragging&&i.length()<.25*p&&_.add(v[e],m[e])})});var A=r.createScene("body");new n(A.addChild())},function(t,e){"use strict";var i=function(t,e,i){this.x=t||0,this.y=e||0,this.z=i||0};i.prototype.set=function(t,e,i){return null!=t&&(this.x=t),null!=e&&(this.y=e),null!=i&&(this.z=i),this},i.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},i.prototype.subtract=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},i.prototype.rotateX=function(t){var e=this.y,i=this.z,n=Math.cos(t),s=Math.sin(t);return this.y=e*n-i*s,this.z=e*s+i*n,this},i.prototype.rotateY=function(t){var e=this.x,i=this.z,n=Math.cos(t),s=Math.sin(t);return this.x=i*s+e*n,this.z=i*n-e*s,this},i.prototype.rotateZ=function(t){var e=this.x,i=this.y,n=Math.cos(t),s=Math.sin(t);return this.x=e*n-i*s,this.y=e*s+i*n,this},i.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},i.prototype.cross=function(t){var e=this.x,i=this.y,n=this.z,s=t.x,r=t.y,o=t.z;return this.x=i*o-n*r,this.y=n*s-e*o,this.z=e*r-i*s,this},i.prototype.scale=function(t){return this.x*=t,this.y*=t,this.z*=t,this},i.prototype.invert=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},i.prototype.map=function(t){return this.x=t(this.x),this.y=t(this.y),this.z=t(this.z),this},i.prototype.length=function(){var t=this.x,e=this.y,i=this.z;return Math.sqrt(t*t+e*e+i*i)},i.prototype.lengthSq=function(){var t=this.x,e=this.y,i=this.z;return t*t+e*e+i*i},i.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},i.prototype.clear=function(){return this.x=0,this.y=0,this.z=0,this},i.prototype.isZero=function(){return 0===this.x&&0===this.y&&0===this.z},i.prototype.toArray=function(){return[this.x,this.y,this.z]},i.prototype.normalize=function(){var t=this.x,e=this.y,i=this.z,n=Math.sqrt(t*t+e*e+i*i)||1;return n=1/n,this.x*=n,this.y*=n,this.z*=n,this},i.prototype.applyRotation=function(t){var e=t.w,i=-t.x,n=-t.y,s=-t.z,r=this.x,o=this.y,a=this.z,h=-i*r-n*o-s*a,u=r*e+o*s-n*a,c=o*e+i*a-r*s,p=a*e+r*n-i*o,l=e,d=-i,f=-n,_=-s;return this.x=u*l+d*h+f*p-c*_,this.y=c*l+f*h+u*_-d*p,this.z=p*l+_*h+d*c-u*f,this},i.prototype.applyMatrix=function(t){var e=t.get(),i=this.x,n=this.y,s=this.z;return this.x=e[0]*i+e[1]*n+e[2]*s,this.y=e[3]*i+e[4]*n+e[5]*s,this.z=e[6]*i+e[7]*n+e[8]*s,this},i.normalize=function(t,e){var i=t.x,n=t.y,s=t.z,r=Math.sqrt(i*i+n*n+s*s)||1;return r=1/r,e.x=i*r,e.y=n*r,e.z=s*r,e},i.applyRotation=function(t,e,i){var n=e.w,s=-e.x,r=-e.y,o=-e.z,a=t.x,h=t.y,u=t.z,c=-s*a-r*h-o*u,p=a*n+h*o-r*u,l=h*n+s*u-a*o,d=u*n+a*r-s*h,f=n,_=-s,g=-r,y=-o;return i.x=p*f+_*c+g*d-l*y,i.y=l*f+g*c+p*y-_*d,i.z=d*f+y*c+_*l-p*g,i},i.clone=function(t){return new i(t.x,t.y,t.z)},i.add=function(t,e,i){return i.x=t.x+e.x,i.y=t.y+e.y,i.z=t.z+e.z,i},i.subtract=function(t,e,i){return i.x=t.x-e.x,i.y=t.y-e.y,i.z=t.z-e.z,i},i.scale=function(t,e,i){return i.x=t.x*e,i.y=t.y*e,i.z=t.z*e,i},i.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},i.cross=function(t,e,i){var n=t.x,s=t.y,r=t.z,o=e.x,a=e.y,h=e.z;return i.x=s*h-r*a,i.y=r*o-n*h,i.z=n*a-s*o,i},i.project=function(t,e,i){var n=t.x,s=t.y,r=t.z,o=e.x,a=e.y,h=e.z,u=n*o+s*a+r*h;return u/=o*o+a*a+h*h,i.x=o*u,i.y=a*u,i.z=h*u,i},t.exports=i},function(t,e){"use strict";function i(t){t=t||{},this.setOptions(t),this._ID=n++}var n=0;i.prototype.setOptions=function(t){for(var e in t)this[e]=t[e];this.init(t)},i.prototype.init=function(t){},i.prototype.update=function(t,e){},i.prototype.resolve=function(t,e){},t.exports=i},function(t,e){"use strict";function i(t){this.values=t||[1,0,0,0,1,0,0,0,1]}i.prototype.get=function(){return this.values},i.prototype.set=function(t){return this.values=t,this},i.prototype.copy=function(t){var e=this.values,i=t.values;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this},i.prototype.vectorMultiply=function(t,e){var i=this.values,n=t.x,s=t.y,r=t.z;return e.x=i[0]*n+i[1]*s+i[2]*r,e.y=i[3]*n+i[4]*s+i[5]*r,e.z=i[6]*n+i[7]*s+i[8]*r,e},i.prototype.multiply=function(t){var e=this.values,i=t.values,n=e[0],s=e[1],r=e[2],o=e[3],a=e[4],h=e[5],u=e[6],c=e[7],p=e[8],l=i[0],d=i[1],f=i[2],_=i[3],g=i[4],y=i[5],v=i[6],m=i[7],w=i[8];return e[0]=n*l+s*_+r*v,e[1]=n*d+s*g+r*m,e[2]=n*f+s*y+r*w,e[3]=o*l+a*_+h*v,e[4]=o*d+a*g+h*m,e[5]=o*f+a*y+h*w,e[6]=u*l+c*_+p*v,e[7]=u*d+c*g+p*m,e[8]=u*f+c*y+p*w,this},i.prototype.transpose=function(){var t=this.values,e=t[1],i=t[2],n=t[3],s=t[5],r=t[6],o=t[7];return t[1]=n,t[2]=r,t[3]=e,t[5]=o,t[6]=i,t[7]=s,this},i.prototype.getDeterminant=function(){var t=this.values,e=t[3],i=t[4],n=t[5],s=t[6],r=t[7],o=t[8],a=t[0]*(i*o-n*r)-t[1]*(e*o-n*s)+t[2]*(e*r-i*s);return a},i.prototype.inverse=function(){var t=this.values,e=t[0],i=t[1],n=t[2],s=t[3],r=t[4],o=t[5],a=t[6],h=t[7],u=t[8],c=e*(r*u-o*h)-i*(s*u-o*a)+n*(s*h-r*a);return Math.abs(c)<1e-40?null:(c=1/c,t[0]=(r*u-o*h)*c,t[3]=(-s*u+o*a)*c,t[6]=(s*h-r*a)*c,t[1]=(-i*u+n*h)*c,t[4]=(e*u-n*a)*c,t[7]=(-e*h+i*a)*c,t[2]=(i*o-n*r)*c,t[5]=(-e*o+n*s)*c,t[8]=(e*r-i*s)*c,this)},i.clone=function(t){return new i(t.values.slice())},i.inverse=function(t,e){var i=t.values,n=e.values,s=i[0],r=i[1],o=i[2],a=i[3],h=i[4],u=i[5],c=i[6],p=i[7],l=i[8],d=s*(h*l-u*p)-r*(a*l-u*c)+o*(a*p-h*c);return Math.abs(d)<1e-40?null:(d=1/d,n[0]=(h*l-u*p)*d,n[3]=(-a*l+u*c)*d,n[6]=(a*p-h*c)*d,n[1]=(-r*l+o*p)*d,n[4]=(s*l-o*c)*d,n[7]=(-s*p+r*c)*d,n[2]=(r*u-o*h)*d,n[5]=(-s*u+o*a)*d,n[8]=(s*h-r*a)*d,e)},i.transpose=function(t,e){var i=t.values,n=e.values,s=i[0],r=i[1],o=i[2],a=i[3],h=i[4],u=i[5],c=i[6],p=i[7],l=i[8];return n[0]=s,n[1]=a,n[2]=c,n[3]=r,n[4]=h,n[5]=p,n[6]=o,n[7]=u,n[8]=l,e},i.add=function(t,e,i){var n=t.values,s=e.values,r=i.values,o=n[0],a=n[1],h=n[2],u=n[3],c=n[4],p=n[5],l=n[6],d=n[7],f=n[8],_=s[0],g=s[1],y=s[2],v=s[3],m=s[4],w=s[5],x=s[6],E=s[7],C=s[8];return r[0]=o+_,r[1]=a+g,r[2]=h+y,r[3]=u+v,r[4]=c+m,r[5]=p+w,r[6]=l+x,r[7]=d+E,r[8]=f+C,i},i.subtract=function(t,e,i){var n=t.values,s=e.values,r=i.values,o=n[0],a=n[1],h=n[2],u=n[3],c=n[4],p=n[5],l=n[6],d=n[7],f=n[8],_=s[0],g=s[1],y=s[2],v=s[3],m=s[4],w=s[5],x=s[6],E=s[7],C=s[8];return r[0]=o-_,r[1]=a-g,r[2]=h-y,r[3]=u-v,r[4]=c-m,r[5]=p-w,r[6]=l-x,r[7]=d-E,r[8]=f-C,i},i.multiply=function(t,e,i){var n=t.values,s=e.values,r=i.values,o=n[0],a=n[1],h=n[2],u=n[3],c=n[4],p=n[5],l=n[6],d=n[7],f=n[8],_=s[0],g=s[1],y=s[2],v=s[3],m=s[4],w=s[5],x=s[6],E=s[7],C=s[8];return r[0]=o*_+a*v+h*x,r[1]=o*g+a*m+h*E,r[2]=o*y+a*w+h*C,r[3]=u*_+c*v+p*x,r[4]=u*g+c*m+p*E,r[5]=u*y+c*w+p*C,r[6]=l*_+d*v+f*x,r[7]=l*g+d*m+f*E,r[8]=l*y+d*w+f*C,i},t.exports=i},function(t,e){"use strict";function i(t,e){t?t instanceof Array?this.targets=t:this.targets=[t]:this.targets=[],e=e||{},this.setOptions(e),this._ID=n++}var n=0;i.prototype.setOptions=function(t){for(var e in t)this[e]=t[e];this.init(t)},i.prototype.addTarget=function(t){this.targets.push(t)},i.prototype.removeTarget=function(t){var e=this.targets.indexOf(t);0>e||this.targets.splice(e,1)},i.prototype.init=function(t){},i.prototype.update=function(t,e){},t.exports=i},function(t,e){"use strict";var i={INIT_DOM:0,DOM_RENDER_SIZE:1,CHANGE_TRANSFORM:2,CHANGE_SIZE:3,CHANGE_PROPERTY:4,CHANGE_CONTENT:5,CHANGE_ATTRIBUTE:6,ADD_CLASS:7,REMOVE_CLASS:8,SUBSCRIBE:9,GL_SET_DRAW_OPTIONS:10,GL_AMBIENT_LIGHT:11,GL_LIGHT_POSITION:12,GL_LIGHT_COLOR:13,MATERIAL_INPUT:14,GL_SET_GEOMETRY:15,GL_UNIFORMS:16,GL_BUFFER_DATA:17,GL_CUTOUT_STATE:18,GL_MESH_VISIBILITY:19,GL_REMOVE_MESH:20,PINHOLE_PROJECTION:21,ORTHOGRAPHIC_PROJECTION:22,CHANGE_VIEW_TRANSFORM:23,WITH:24,FRAME:25,ENGINE:26,START:27,STOP:28,TIME:29,TRIGGER:30,NEED_SIZE_FOR:31,DOM:32,READY:33,ALLOW_DEFAULT:34,PREVENT_DEFAULT:35,UNSUBSCRIBE:36,prettyPrint:function(t,e,i){var s;e=e?e:0;for(var r={i:e,result:""},o=i?i+e:t.length;r.i<o;r.i++){if(s=n[t[r.i]],!s)throw new Error("PARSE ERROR: no command registered for: "+t[r.i]);s(t,r)}return r.result}},n=[];n[i.INIT_DOM]=function(t,e){e.result+=e.i+". INIT_DOM\n    tagName: "+t[++e.i]+"\n\n"},n[i.DOM_RENDER_SIZE]=function(t,e){e.result+=e.i+". DOM_RENDER_SIZE\n    selector: "+t[++e.i]+"\n\n"},n[i.CHANGE_TRANSFORM]=function(t,e){e.result+=e.i+". CHANGE_TRANSFORM\n    val: [";for(var i=0;16>i;i++)e.result+=t[++e.i]+(15>i?", ":"");e.result+="]\n\n"},n[i.CHANGE_SIZE]=function(t,e){e.result+=e.i+". CHANGE_SIZE\n    x: "+t[++e.i]+", y: "+t[++e.i]+"\n\n"},n[i.CHANGE_PROPERTY]=function(t,e){e.result+=e.i+". CHANGE_PROPERTY\n    key: "+t[++e.i]+", value: "+t[++e.i]+"\n\n"},n[i.CHANGE_CONTENT]=function(t,e){e.result+=e.i+". CHANGE_CONTENT\n    content: "+t[++e.i]+"\n\n"},n[i.CHANGE_ATTRIBUTE]=function(t,e){e.result+=e.i+". CHANGE_ATTRIBUTE\n    key: "+t[++e.i]+", value: "+t[++e.i]+"\n\n"},n[i.ADD_CLASS]=function(t,e){e.result+=e.i+". ADD_CLASS\n    className: "+t[++e.i]+"\n\n"},n[i.REMOVE_CLASS]=function(t,e){e.result+=e.i+". REMOVE_CLASS\n    className: "+t[++e.i]+"\n\n"},n[i.SUBSCRIBE]=function(t,e){e.result+=e.i+". SUBSCRIBE\n    event: "+t[++e.i]+"\n\n"},n[i.GL_SET_DRAW_OPTIONS]=function(t,e){e.result+=e.i+". GL_SET_DRAW_OPTIONS\n    options: "+t[++e.i]+"\n\n"},n[i.GL_AMBIENT_LIGHT]=function(t,e){e.result+=e.i+". GL_AMBIENT_LIGHT\n    r: "+t[++e.i]+"g: "+t[++e.i]+"b: "+t[++e.i]+"\n\n"},n[i.GL_LIGHT_POSITION]=function(t,e){e.result+=e.i+". GL_LIGHT_POSITION\n    x: "+t[++e.i]+"y: "+t[++e.i]+"z: "+t[++e.i]+"\n\n"},n[i.GL_LIGHT_COLOR]=function(t,e){e.result+=e.i+". GL_LIGHT_COLOR\n    r: "+t[++e.i]+"g: "+t[++e.i]+"b: "+t[++e.i]+"\n\n"},n[i.MATERIAL_INPUT]=function(t,e){e.result+=e.i+". MATERIAL_INPUT\n    key: "+t[++e.i]+", value: "+t[++e.i]+"\n\n"},n[i.GL_SET_GEOMETRY]=function(t,e){e.result+=e.i+". GL_SET_GEOMETRY\n   x: "+t[++e.i]+", y: "+t[++e.i]+", z: "+t[++e.i]+"\n\n"},n[i.GL_UNIFORMS]=function(t,e){e.result+=e.i+". GL_UNIFORMS\n    key: "+t[++e.i]+", value: "+t[++e.i]+"\n\n"},n[i.GL_BUFFER_DATA]=function(t,e){e.result+=e.i+". GL_BUFFER_DATA\n    data: ";for(var i=0;5>i;i++)e.result+=t[++e.i]+", ";e.result+="\n\n"},n[i.GL_CUTOUT_STATE]=function(t,e){e.result+=e.i+". GL_CUTOUT_STATE\n    state: "+t[++e.i]+"\n\n"},n[i.GL_MESH_VISIBILITY]=function(t,e){e.result+=e.i+". GL_MESH_VISIBILITY\n    visibility: "+t[++e.i]+"\n\n"},n[i.GL_REMOVE_MESH]=function(t,e){e.result+=e.i+". GL_REMOVE_MESH\n\n"},n[i.PINHOLE_PROJECTION]=function(t,e){e.result+=e.i+". PINHOLE_PROJECTION\n    depth: "+t[++e.i]+"\n\n"},n[i.ORTHOGRAPHIC_PROJECTION]=function(t,e){e.result+=e.i+". ORTHOGRAPHIC_PROJECTION\n"},n[i.CHANGE_VIEW_TRANSFORM]=function(t,e){e.result+=e.i+". CHANGE_VIEW_TRANSFORM\n   value: [";for(var i=0;16>i;i++)e.result+=t[++e.i]+(15>i?", ":"");e.result+="]\n\n"},n[i.PREVENT_DEFAULT]=function(t,e){e.result+=e.i+". PREVENT_DEFAULT\n    value: "+t[++e.i]+"\n\n"},n[i.ALLOW_DEFAULT]=function(t,e){e.result+=e.i+". ALLOW_DEFAULT\n    value: "+t[++e.i]+"\n\n"},n[i.READY]=function(t,e){e.result+=e.i+". READY\n\n"},n[i.WITH]=function(t,e){e.result+=e.i+". **WITH**\n     path: "+t[++e.i]+"\n\n"},n[i.TIME]=function(t,e){e.result+=e.i+". TIME\n     ms: "+t[++e.i]+"\n\n"},n[i.NEED_SIZE_FOR]=function(t,e){e.result+=e.i+". NEED_SIZE_FOR\n    selector: "+t[++e.i]+"\n\n"},t.exports=i},function(t,e,i){"use strict";function n(t){s.call(this,t),this.detail=t.detail}var s=i(18);n.prototype=Object.create(s.prototype),n.prototype.constructor=n,n.prototype.toString=function(){return"UIEvent"},t.exports=n},function(t,e){"use strict";function i(t,e,i,n){this.w=t||1,this.x=e||0,this.y=i||0,this.z=n||0}var n=Math.sin,s=Math.cos,r=Math.asin,o=Math.acos,a=Math.atan2,h=Math.sqrt;i.prototype.multiply=function(t){var e=this.x,i=this.y,n=this.z,s=this.w,r=t.x,o=t.y,a=t.z,h=t.w||0;return this.w=s*h-e*r-i*o-n*a,this.x=e*h+r*s+o*n-i*a,this.y=i*h+o*s+e*a-r*n,this.z=n*h+a*s+r*i-e*o,this},i.prototype.leftMultiply=function(t){var e=t.x,i=t.y,n=t.z,s=t.w||0,r=this.x,o=this.y,a=this.z,h=this.w;return this.w=s*h-e*r-i*o-n*a,this.x=e*h+r*s+o*n-i*a,this.y=i*h+o*s+e*a-r*n,this.z=n*h+a*s+r*i-e*o,this},i.prototype.rotateVector=function(t,e){var i=this.w,n=-this.x,s=-this.y,r=-this.z,o=t.x,a=t.y,h=t.z,u=-n*o-s*a-r*h,c=o*i+a*r-s*h,p=a*i+n*h-o*r,l=h*i+o*s-n*a,d=i,f=-n,_=-s,g=-r;return e.x=c*d+f*u+_*l-p*g,e.y=p*d+_*u+c*g-f*l,e.z=l*d+g*u+f*p-c*_,e},i.prototype.invert=function(){return this.w=-this.w,this.x=-this.x,this.y=-this.y,this.z=-this.z,this},i.prototype.conjugate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},i.prototype.length=function(){var t=this.w,e=this.x,i=this.y,n=this.z;return h(t*t+e*e+i*i+n*n)},i.prototype.normalize=function(){var t=this.w,e=this.x,i=this.y,n=this.z,s=h(t*t+e*e+i*i+n*n);return 0===s?this:(s=1/s,this.w*=s,this.x*=s,this.y*=s,this.z*=s,this)},i.prototype.set=function(t,e,i,n){return null!=t&&(this.w=t),null!=e&&(this.x=e),null!=i&&(this.y=i),null!=n&&(this.z=n),this},i.prototype.copy=function(t){return this.w=t.w,this.x=t.x,this.y=t.y,this.z=t.z,this},i.prototype.clear=function(){return this.w=1,this.x=0,this.y=0,this.z=0,this},i.prototype.dot=function(t){return this.w*t.w+this.x*t.x+this.y*t.y+this.z*t.z},i.prototype.slerp=function(t,e,i){var s,r,a,h,u,c=this.w,p=this.x,l=this.y,d=this.z,f=t.w,_=t.x,g=t.y,y=t.z;return r=c*f+p*_+l*g+d*y,1-r>1e-5?(s=o(r),a=n(s),h=n((1-e)*s)/a,u=n(e*s)/a):(h=1-e,u=e),i.w=c*h+f*u,i.x=p*h+_*u,i.y=l*h+g*u,i.z=d*h+y*u,i},i.prototype.toMatrix=function(t){var e=this.w,i=this.x,n=this.y,s=this.z,r=i*i,o=n*n,a=s*s,h=i*n,u=i*s,c=n*s;return t.set([1-2*(o+a),2*(h-e*s),2*(u+e*n),2*(h+e*s),1-2*(r+a),2*(c-e*i),2*(u-e*n),2*(c+e*i),1-2*(r+o)])},i.prototype.toEuler=function(t){var e=this.w,i=this.x,n=this.y,s=this.z,o=i*i,h=n*n,u=s*s,c=2*(i*s+n*e);return c=-1>c?-1:c>1?1:c,t.x=a(2*(i*e-n*s),1-2*(o+h)),t.y=r(c),t.z=a(2*(s*e-i*n),1-2*(h+u)),t},i.prototype.fromEuler=function(t,e,i){var r=.5*t,o=.5*e,a=.5*i,h=n(r),u=n(o),c=n(a),p=s(r),l=s(o),d=s(a);return this.w=p*l*d-h*u*c,this.x=h*l*d+p*u*c,this.y=p*u*d-h*l*c,this.z=p*l*c+h*u*d,this},i.prototype.fromAngleAxis=function(t,e,i,r){var o=h(e*e+i*i+r*r);if(0===o)this.w=1,this.x=this.y=this.z=0;else{o=1/o;var a=.5*t,u=n(a);this.w=s(a),this.x=u*e*o,this.y=u*i*o,this.z=u*r*o}return this},i.multiply=function(t,e,i){var n=t.w||0,s=t.x,r=t.y,o=t.z,a=e.w||0,h=e.x,u=e.y,c=e.z;return i.w=n*a-s*h-r*u-o*c,i.x=s*a+h*n+u*o-r*c,i.y=r*a+u*n+s*c-h*o,i.z=o*a+c*n+h*r-s*u,i},i.normalize=function(t,e){var i=t.w,n=t.x,s=t.y,r=t.z,o=h(i*i+n*n+s*s+r*r);return 0===o?this:(o=1/o,e.w*=o,e.x*=o,e.y*=o,e.z*=o,e)},i.conjugate=function(t,e){return e.w=t.w,e.x=-t.x,e.y=-t.y,e.z=-t.z,e},i.clone=function(t){return new i(t.w,t.x,t.y,t.z)},i.dot=function(t,e){return t.w*e.w+t.x*e.x+t.y*e.y+t.z*e.z},t.exports=i},function(t,e,i){"use strict";function n(){this._nodes={},this._queue=[]}function s(t,e){e.length=0;var i,n=0,s=t.length;for(i=0;s>i;i++)"/"===t[i]&&(e.push(t.substring(n,i)),n=i+1);return i-n>0&&e.push(t.substring(n,i)),e}var r=i(30),o=i(9);n.prototype._setUpdater=function(t){this._updater=t;for(var e in this._nodes)this._nodes[e]._setUpdater(t)},n.prototype.addChildrenToQueue=function(t){for(var e,i=t.getChildren(),n=0,s=i.length;s>n;n++)e=i[n],e&&this._queue.push(e)},n.prototype.next=function(){return this._queue.shift()},n.prototype.breadthFirstNext=function(){var t=this._queue.shift();return t?(this.addChildrenToQueue(t),t):void 0},n.prototype.mount=function(t,e){if(!e)throw new Error("Dispatch: no node passed to mount at: "+t);if(this._nodes[t])throw new Error("Dispatch: there is a node already registered at: "+t);e._setUpdater(this._updater),this._nodes[t]=e;var i=o.parent(t),n=i?this._nodes[i]:e;if(!n)throw new Error("Parent to path: "+t+" doesn't exist at expected path: "+i);var s,r,a=e.getChildren(),h=e.getComponents();if(n.isMounted()&&e._setMounted(!0,t),n.isShown()&&e._setShown(!0),n.isMounted()){for(e._setParent(n),e.onMount&&e.onMount(t),s=0,r=h.length;r>s;s++)h[s]&&h[s].onMount&&h[s].onMount(e,s);for(s=0,r=a.length;r>s;s++)a[s]&&a[s].mount?a[s].mount(t+"/"+s):a[s]&&this.mount(t+"/"+s,a[s])}if(n.isShown())for(e.onShow&&e.onShow(),s=0,r=h.length;r>s;s++)h[s]&&h[s].onShow&&h[s].onShow()},n.prototype.dismount=function(t){var e=this._nodes[t];if(!e)throw new Error("No node registered to path: "+t);var i,n,s=e.getChildren(),r=e.getComponents();if(e.isShown())for(e._setShown(!1),e.onHide&&e.onHide(),i=0,n=r.length;n>i;i++)r[i]&&r[i].onHide&&r[i].onHide();if(e.isMounted()){for(e.onDismount&&e.onDismount(t),i=0,n=s.length;n>i;i++)s[i]&&s[i].dismount?s[i].dismount():s[i]&&this.dismount(t+"/"+i);for(i=0,n=r.length;n>i;i++)r[i]&&r[i].onDismount&&r[i].onDismount();e._setMounted(!1),e._setParent(null)}this._nodes[t]=null},n.prototype.getNode=function(t){return this._nodes[t]},n.prototype.show=function(t){var e=this._nodes[t];if(!e)throw new Error("No node registered to path: "+t);e.onShow&&e.onShow();for(var i=e.getComponents(),n=0,s=i.length;s>n;n++)i[n]&&i[n].onShow&&i[n].onShow();this.addChildrenToQueue(e);for(var r;r=this.breadthFirstNext();)this.show(r.getLocation())},n.prototype.hide=function(t){var e=this._nodes[t];if(!e)throw new Error("No node registered to path: "+t);e.onHide&&e.onHide();for(var i=e.getComponents(),n=0,s=i.length;s>n;n++)i[n]&&i[n].onHide&&i[n].onHide();this.addChildrenToQueue(e);for(var r;r=this.breadthFirstNext();)this.hide(r.getLocation())},n.prototype.lookupNode=function(t){if(!t)throw new Error("lookupNode must be called with a path");this._queue.length=0;var e=this._queue;s(t,e);for(var i=0,n=e.length;n>i;i++)e[i]=this._nodes[e[i]];return e[e.length-1]},n.prototype.dispatch=function(t,e,i){if(!t)throw new Error("dispatch requires a path as it's first argument");if(!e)throw new Error("dispatch requires an event name as it's second argument");var n=this._nodes[t];if(n){this.addChildrenToQueue(n);for(var s;s=this.breadthFirstNext();)s&&s.onReceive&&s.onReceive(e,i)}},n.prototype.dispatchUIEvent=function(t,e,i){if(!t)throw new Error("dispatchUIEvent needs a valid path to dispatch to");if(!e)throw new Error("dispatchUIEvent needs an event name as its second argument");var n;if(r.call(i),n=this.getNode(t)){var s,o,a,h;for(i.node=n;n;){for(n.onReceive&&n.onReceive(e,i),o=n.getComponents(),a=0,h=o.length;h>a;a++)o[a]&&o[a].onReceive&&o[a].onReceive(e,i);if(i.propagationStopped)break;if(s=n.getParent(),s===n)return;n=s}}},t.exports=new n},function(t,e){"use strict";var i={hasTrailingSlash:function(t){return"/"===t[t.length-1]},depth:function(t){for(var e=0,i=t.length,n=this.hasTrailingSlash(t)?i-1:i,s=0;n>s;s++)e+="/"===t[s]?1:0;return e},index:function(t){for(var e=t.length,i=this.hasTrailingSlash(t)?e-1:e;i--&&"/"!==t[i];);var n=parseInt(t.substring(i+1));return isNaN(n)?0:n},indexAtDepth:function(t,e){for(var i=0,n=t.length,s=0;n>i;i++)if("/"===t[i]&&s++,s===e)return t=t.substring(i?i+1:i),s=t.indexOf("/"),t=-1===s?t:t.substring(0,s),s=parseInt(t),isNaN(s)?t:s},parent:function(t){return t.substring(0,t.lastIndexOf("/",t.length-2))},isChildOf:function(t,e){return this.isDescendentOf(t,e)&&this.depth(t)===this.depth(e)+1},isDescendentOf:function(t,e){return t===e?!1:(t=this.hasTrailingSlash(t)?t:t+"/",e=this.hasTrailingSlash(e)?e:e+"/",this.depth(e)<this.depth(t)&&0===t.indexOf(e))},getSelector:function(t){var e=t.indexOf("/");return-1===e?t:t.substring(0,e)}};t.exports=i},function(t,e,i){"use strict";function n(t){this.events=new a,t=t||{},this.position=t.position||new s,this.orientation=t.orientation||new r,this.velocity=new s,this.momentum=new s,this.angularVelocity=new s,this.angularMomentum=new s,this.mass=t.mass||1,this.inverseMass=1/this.mass,this.force=new s,this.torque=new s,this.restitution=null!=t.restitution?t.restitution:.4,this.friction=null!=t.friction?t.friction:.2,this.inverseInertia=new o([0,0,0,0,0,0,0,0,0]),this.localInertia=new o([0,0,0,0,0,0,0,0,0]),this.localInverseInertia=new o([0,0,0,0,0,0,0,0,0]),this.size=t.size||[0,0,0];var e=t.velocity;e&&this.setVelocity(e.x,e.y,e.z),this.restrictions=0,this.setRestrictions.apply(this,t.restrictions||[]),this.collisionMask=t.collisionMask||1,this.collisionGroup=t.collisionGroup||1,this.type=1,this._ID=c++}var s=i(1),r=i(7),o=i(3),a=i(11),h=new s,u=new o,c=0;n.prototype.on=function(t,e){return this.events.on(t,e),this},n.prototype.off=function(t,e){return this.events.off(t,e),this},n.prototype.trigger=function(t,e){return this.events.trigger(t,e),this},n.prototype.getRestrictions=function(){var t="",e="",i=this.restrictions;return 32&i&&(t+="x"),16&i&&(t+="y"),8&i&&(t+="z"),4&i&&(e+="x"),2&i&&(e+="y"),1&i&&(e+="z"),[t,e]},n.prototype.setRestrictions=function(t,e){return t=t||"",e=e||"",this.restrictions=0,t.indexOf("x")>-1&&(this.restrictions|=32),t.indexOf("y")>-1&&(this.restrictions|=16),t.indexOf("z")>-1&&(this.restrictions|=8),e.indexOf("x")>-1&&(this.restrictions|=4),e.indexOf("y")>-1&&(this.restrictions|=2),e.indexOf("z")>-1&&(this.restrictions|=1),this},n.prototype.getMass=function(){return this.mass},n.prototype.setMass=function(t){return this.mass=t,this.inverseMass=1/t,this},n.prototype.getInverseMass=function(){return this.inverseMass},n.prototype.updateLocalInertia=function(){return this.localInertia.set([0,0,0,0,0,0,0,0,0]),this.localInverseInertia.set([0,0,0,0,0,0,0,0,0]),this},n.prototype.updateInertia=function(){var t=this.localInverseInertia,e=this.orientation;if(t[0]===t[4]&&t[4]===t[8]||1===e.w)return this;var i=e.toMatrix(u);return o.multiply(i,this.inverseInertia,this.inverseInertia),o.multiply(this.localInverseInertia,i.transpose(),this.inverseInertia),this},n.prototype.getPosition=function(){return this.position},n.prototype.setPosition=function(t,e,i){return this.position.set(t,e,i),this},n.prototype.getVelocity=function(){return this.velocity},n.prototype.setVelocity=function(t,e,i){return this.velocity.set(t,e,i),s.scale(this.velocity,this.mass,this.momentum),this},n.prototype.getMomentum=function(){return this.momentum},n.prototype.setMomentum=function(t,e,i){return this.momentum.set(t,e,i),s.scale(this.momentum,this.inverseMass,this.velocity),this},n.prototype.getOrientation=function(){return this.orientation},n.prototype.setOrientation=function(t,e,i,n){return this.orientation.set(t,e,i,n).normalize(),this.updateInertia(),this},n.prototype.getAngularVelocity=function(){return this.angularVelocity},n.prototype.setAngularVelocity=function(t,e,i){this.angularVelocity.set(t,e,i);var n=o.inverse(this.inverseInertia,u);return n?n.vectorMultiply(this.angularVelocity,this.angularMomentum):this.angularMomentum.clear(),this},n.prototype.getAngularMomentum=function(){return this.angularMomentum},n.prototype.setAngularMomentum=function(t,e,i){return this.angularMomentum.set(t,e,i),this.inverseInertia.vectorMultiply(this.angularMomentum,this.angularVelocity),this},n.prototype.getForce=function(){return this.force},n.prototype.setForce=function(t,e,i){return this.force.set(t,e,i),this},n.prototype.getTorque=function(){return this.torque},n.prototype.setTorque=function(t,e,i){return this.torque.set(t,e,i),this},n.prototype.applyForce=function(t){return this.force.add(t),this},n.prototype.applyTorque=function(t){return this.torque.add(t),this},n.prototype.applyImpulse=function(t){return this.momentum.add(t),s.scale(this.momentum,this.inverseMass,this.velocity),this},n.prototype.applyAngularImpulse=function(t){return this.angularMomentum.add(t),this.inverseInertia.vectorMultiply(this.angularMomentum,this.angularVelocity),this},n.prototype.support=function(){return h},n.prototype.updateShape=function(){},t.exports=n},function(t,e){"use strict";function i(){this._events={}}i.prototype.on=function(t,e){this._events[t]||(this._events[t]=[]);var i=this._events[t];return i.push(e),function(){i.splice(i.indexOf(e),1)}},i.prototype.off=function(t,e){var i=this._events[t];return i&&i.splice(i.indexOf(e),1),this},i.prototype.trigger=function(t,e){var i=this._events[t];if(i)for(var n=0,s=i.length;s>n;n++)i[n](e);return this},t.exports=i},function(t,e,i){"use strict";function n(){this.pathStore=new g}function s(t,e,i){var n=i.align[0],s=i.align[1],r=i.align[2];t.onAlignChange&&t.onAlignChange(n,s,r);for(var o=0,a=e.length;a>o;o++)e[o]&&e[o].onAlignChange&&e[o].onAlignChange(n,s,r);i.alignChanged=!1}function r(t,e,i){var n=i.mountPoint[0],s=i.mountPoint[1],r=i.mountPoint[2];t.onMountPointChange&&t.onMountPointChange(n,s,r);for(var o=0,a=e.length;a>o;o++)e[o]&&e[o].onMountPointChange&&e[o].onMountPointChange(n,s,r);i.mountPointChanged=!1}function o(t,e,i){var n=i.origin[0],s=i.origin[1],r=i.origin[2];t.onOriginChange&&t.onOriginChange(n,s,r);for(var o=0,a=e.length;a>o;o++)e[o]&&e[o].onOriginChange&&e[o].onOriginChange(n,s,r);i.originChanged=!1}function a(t,e,i){var n=i.position[0],s=i.position[1],r=i.position[2];t.onPositionChange&&t.onPositionChange(n,s,r);for(var o=0,a=e.length;a>o;o++)e[o]&&e[o].onPositionChange&&e[o].onPositionChange(n,s,r);i.positionChanged=!1}function h(t,e,i){var n=i.rotation[0],s=i.rotation[1],r=i.rotation[2],o=i.rotation[3];t.onRotationChange&&t.onRotationChange(n,s,r,o);for(var a=0,h=e.length;h>a;a++)e[a]&&e[a].onRotationChange&&e[a].onRotationChange(n,s,r,o);i.rotationChanged=!1}function u(t,e,i){var n=i.scale[0],s=i.scale[1],r=i.scale[2];t.onScaleChange&&t.onScaleChange(n,s,r);for(var o=0,a=e.length;a>o;o++)e[o]&&e[o].onScaleChange&&e[o].onScaleChange(n,s,r);i.scaleChanged=!1}function c(t,e,i){t.onTransformChange&&t.onTransformChange(i);for(var n=0,s=e.length;s>n;n++)e[n]&&e[n].onTransformChange&&e[n].onTransformChange(i)}function p(t,e,i){t.onLocalTransformChange&&t.onLocalTransformChange(i);for(var n=0,s=e.length;s>n;n++)e[n]&&e[n].onLocalTransformChange&&e[n].onLocalTransformChange(i)}function l(t,e,i){t.onWorldTransformChange&&t.onWorldTransformChange(i);for(var n=0,s=e.length;s>n;n++)e[n]&&e[n].onWorldTransformChange&&e[n].onWorldTransformChange(i)}var d=i(9),f=i(17),_=i(8),g=i(16);n.prototype.registerTransformAtPath=function(t,e){if(!d.depth(t))return this.pathStore.insert(t,e?e:new f);var i=this.pathStore.get(d.parent(t));if(!i)throw new Error("No parent transform registered at expected path: "+d.parent(t));e&&e.setParent(i),this.pathStore.insert(t,e?e:new f(i))},n.prototype.deregisterTransformAtPath=function(t){this.pathStore.remove(t)},n.prototype.makeBreakPointAt=function(t){var e=this.pathStore.get(t);if(!e)throw new Error("No transform Registered at path: "+t);e.setBreakPoint()},n.prototype.makeCalculateWorldMatrixAt=function(t){var e=this.pathStore.get(t);if(!e)throw new Error("No transform Registered at path: "+t);e.setCalculateWorldMatrix()},n.prototype.get=function(t){return this.pathStore.get(t)},n.prototype.update=function(){for(var t,e,i,n,d,g,y=this.pathStore.getItems(),v=this.pathStore.getPaths(),m=0,w=y.length;w>m;m++)i=_.getNode(v[m]),i&&(g=i.getComponents(),t=y[m],n=t.vectors,d=t.offsets,d.alignChanged&&s(i,g,d),d.mountPointChanged&&r(i,g,d),d.originChanged&&o(i,g,d),n.positionChanged&&a(i,g,n),n.rotationChanged&&h(i,g,n),n.scaleChanged&&u(i,g,n),(e=t.calculate(i))&&(c(i,g,t),e&f.LOCAL_CHANGED&&p(i,g,t.getLocalTransform()),e&f.WORLD_CHANGED&&l(i,g,t.getWorldTransform())))},t.exports=new n},function(t,e){"use strict";function i(t,e){return function(){return 0!==t.length?t.pop():new e}}function n(t){return function(e){t.push(e)}}var s={};s.pools={},s.register=function(t,e){var s=this.pools[t]=[];this["request"+t]=i(s,e),this["free"+t]=n(s)},s.disposeOf=function(t){for(var e=this.pools[t],i=e.length;i--;)e.pop()},t.exports=s},function(t,e,i){"use strict";function n(){this.pathStore=new c}function s(t,e,i){var n=i.getSizeMode(),s=n[0],r=n[1],o=n[2];t.onSizeModeChange&&t.onSizeModeChange(s,r,o);for(var a=0,h=e.length;h>a;a++)e[a]&&e[a].onSizeModeChange&&e[a].onSizeModeChange(s,r,o);i.sizeModeChanged=!1}function r(t,e,i){var n=i.getAbsolute(),s=n[0],r=n[1],o=n[2];t.onAbsoluteSizeChange&&t.onAbsoluteSizeChange(s,r,o);for(var a=0,h=e.length;h>a;a++)e[a]&&e[a].onAbsoluteSizeChange&&e[a].onAbsoluteSizeChange(s,r,o);i.absoluteSizeChanged=!1}function o(t,e,i){var n=i.getProportional(),s=n[0],r=n[1],o=n[2];t.onProportionalSizeChange&&t.onProportionalSizeChange(s,r,o);for(var a=0,h=e.length;h>a;a++)e[a]&&e[a].onProportionalSizeChange&&e[a].onProportionalSizeChange(s,r,o);i.proportionalSizeChanged=!1}function a(t,e,i){var n=i.getDifferential(),s=n[0],r=n[1],o=n[2];t.onDifferentialSizeChange&&t.onDifferentialSizeChange(s,r,o);for(var a=0,h=e.length;h>a;a++)e[a]&&e[a].onDifferentialSizeChange&&e[a].onDifferentialSizeChange(s,r,o);i.differentialSizeChanged=!1}function h(t,e,i){var n=i.getRenderSize(),s=n[0],r=n[1],o=n[2];t.onRenderSizeChange&&t.onRenderSizeChange(s,r,o);for(var a=0,h=e.length;h>a;a++)e[a]&&e[a].onRenderSizeChange&&e[a].onRenderSizeChange(s,r,o);i.renderSizeChanged=!1}function u(t,e,i){var n=i.get(),s=n[0],r=n[1],o=n[2];t.onSizeChange&&t.onSizeChange(s,r,o);for(var a=0,h=e.length;h>a;a++)e[a]&&e[a].onSizeChange&&e[a].onSizeChange(s,r,o);i.sizeChanged=!1}var c=i(16),p=i(15),l=i(8),d=i(9);n.prototype.registerSizeAtPath=function(t,e){if(!d.depth(t))return this.pathStore.insert(t,e?e:new p);var i=this.pathStore.get(d.parent(t));if(!i)throw new Error("No parent size registered at expected path: "+d.parent(t));e&&e.setParent(i),this.pathStore.insert(t,e?e:new p(i))},n.prototype.deregisterSizeAtPath=function(t){this.pathStore.remove(t)},n.prototype.get=function(t){return this.pathStore.get(t)},n.prototype.update=function(){var t,e,i,n,c,p=this.pathStore.getItems(),d=this.pathStore.getPaths();for(i=0,n=p.length;n>i;i++)t=l.getNode(d[i]),
c=t.getComponents(),t&&(e=p[i],e.sizeModeChanged&&s(t,c,e),e.absoluteSizeChanged&&r(t,c,e),e.proportionalSizeChanged&&o(t,c,e),e.differentialSizeChanged&&a(t,c,e),e.renderSizeChanged&&h(t,c,e),e.fromComponents(c)&&u(t,c,e))},t.exports=new n},function(t,e){"use strict";function i(t){this.finalSize=new Float32Array(3),this.sizeChanged=!1,this.sizeMode=new Uint8Array(3),this.sizeModeChanged=!1,this.absoluteSize=new Float32Array(3),this.absoluteSizeChanged=!1,this.proportionalSize=new Float32Array(o),this.proportionalSizeChanged=!1,this.differentialSize=new Float32Array(3),this.differentialSizeChanged=!1,this.renderSize=new Float32Array(3),this.renderSizeChanged=!1,this.parent=null!=t?t:null}function n(t,e,i){return null!=i&&t[e]!==i?(t[e]=i,!0):!1}function s(t,e,i,s){var r=!1;return r=n(t,0,e)||r,r=n(t,1,i)||r,r=n(t,2,s)||r}function r(t){if(t.constructor===String)switch(t.toLowerCase()){case"relative":case"default":return i.RELATIVE;case"absolute":return i.ABSOLUTE;case"render":return i.RENDER;default:throw new Error("unknown size mode: "+t)}else if(0>t||t>i.RENDER)throw new Error("unknown size mode: "+t);return t}var o=[1,1,1],a=[0,0,0];i.RELATIVE=0,i.ABSOLUTE=1,i.RENDER=2,i.DEFAULT=i.RELATIVE,i.prototype.setParent=function(t){return this.parent=t,this},i.prototype.getParent=function(){return this.parent},i.prototype.setSizeMode=function(t,e,i){return null!=t&&(t=r(t)),null!=e&&(e=r(e)),null!=i&&(i=r(i)),this.sizeModeChanged=s(this.sizeMode,t,e,i),this},i.prototype.getSizeMode=function(){return this.sizeMode},i.prototype.setAbsolute=function(t,e,i){return this.absoluteSizeChanged=s(this.absoluteSize,t,e,i),this},i.prototype.getAbsolute=function(){return this.absoluteSize},i.prototype.setProportional=function(t,e,i){return this.proportionalSizeChanged=s(this.proportionalSize,t,e,i),this},i.prototype.getProportional=function(){return this.proportionalSize},i.prototype.setDifferential=function(t,e,i){return this.differentialSizeChanged=s(this.differentialSize,t,e,i),this},i.prototype.getDifferential=function(){return this.differentialSize},i.prototype.get=function(){return this.finalSize},i.prototype.fromComponents=function(t){for(var e,n,s=this.sizeMode,r=this.finalSize,o=this.parent?this.parent.get():a,h=!1,u=t.length,c=0;3>c;c++){switch(e=r[c],s[c]){case i.RELATIVE:r[c]=o[c]*this.proportionalSize[c]+this.differentialSize[c];break;case i.ABSOLUTE:r[c]=this.absoluteSize[c];break;case i.RENDER:var p,l;for(n=0;u>n;n++)l=t[n],l&&l.getRenderSize&&(p=l.getRenderSize()[c],r[c]=r[c]<p||0===r[c]?p:r[c])}h=h||e!==r[c]}return this.sizeChanged=h,h},t.exports=i},function(t,e,i){"use strict";function n(){this.items=[],this.paths=[],this.memo={}}var s=i(9);n.prototype.insert=function(t,e){var i=this.paths,n=i.indexOf(t);if(-1!==n)throw new Error("item already exists at path: "+t);for(var r=0,o=s.depth(t),a=s.index(t);i[r]&&o>=s.depth(i[r]);)r++;for(;i[r]&&o===s.depth(i[r])&&a<s.index(i[r]);)r++;i.splice(r,0,t),this.items.splice(r,0,e),this.memo[t]=r;for(var h=this.paths.length;h>r;r++)this.memo[this.paths[r]]=null},n.prototype.remove=function(t){var e=this.paths,i=this.memo[t]?this.memo[t]:e.indexOf(t);if(-1===i)throw new Error("Cannot remove. No item exists at path: "+t);e.splice(i,1),this.items.splice(i,1),this.memo[t]=null;for(var n=this.paths.length;n>i;i++)this.memo[this.paths[i]]=null},n.prototype.get=function(t){if(this.memo[t])return this.items[this.memo[t]];var e=this.paths.indexOf(t);return-1===e?void 0:(this.memo[t]=e,this.items[e])},n.prototype.getItems=function(){return this.items},n.prototype.getPaths=function(){return this.paths},t.exports=n},function(t,e){"use strict";function i(t){this.local=new Float32Array(i.IDENT),this.global=new Float32Array(i.IDENT),this.offsets={align:new Float32Array(3),alignChanged:!1,mountPoint:new Float32Array(3),mountPointChanged:!1,origin:new Float32Array(3),originChanged:!1},this.vectors={position:new Float32Array(3),positionChanged:!1,rotation:new Float32Array(h),rotationChanged:!1,scale:new Float32Array(u),scaleChanged:!1},this._lastEulerVals=[0,0,0],this._lastEuler=!1,this.parent=t?t:null,this.breakPoint=!1,this.calculatingWorldMatrix=!1}function n(t,e,i){return null!=i&&t[e]!==i?(t[e]=i,!0):!1}function s(t,e,i,s,r){var o=!1;return o=n(t,0,e)||o,o=n(t,1,i)||o,o=n(t,2,s)||o,null!=r&&(o=n(t,3,r)||o),o}function r(t,e){var n=e.getLocalTransform(),s=t.getSize(),r=e.vectors,o=e.offsets,a=t.getParent().getSize(),h=0,u=n[0],c=n[1],p=n[2],l=n[4],d=n[5],f=n[6],_=n[8],g=n[9],y=n[10],v=n[12],m=n[13],w=n[14],x=r.position[0],E=r.position[1],C=r.position[2],I=r.rotation[0],T=r.rotation[1],b=r.rotation[2],z=r.rotation[3],S=r.scale[0],M=r.scale[1],R=r.scale[2],A=o.align[0]*a[0],O=o.align[1]*a[1],D=o.align[2]*a[2],L=o.mountPoint[0]*s[0],P=o.mountPoint[1]*s[1],N=o.mountPoint[2]*s[2],U=o.origin[0]*s[0],G=o.origin[1]*s[1],k=o.origin[2]*s[2],F=z*I,V=z*T,q=z*b,B=I*I,H=T*T,W=b*b,Q=I*T,j=I*b,Y=T*b;return n[0]=(1-2*(H+W))*S,n[1]=2*(Q+q)*S,n[2]=2*(j-V)*S,n[3]=0,n[4]=2*(Q-q)*M,n[5]=(1-2*(B+W))*M,n[6]=2*(Y+F)*M,n[7]=0,n[8]=2*(j+V)*R,n[9]=2*(Y-F)*R,n[10]=(1-2*(B+H))*R,n[11]=0,n[12]=A+x-L+U-(n[0]*U+n[4]*G+n[8]*k),n[13]=O+E-P+G-(n[1]*U+n[5]*G+n[9]*k),n[14]=D+C-N+k-(n[2]*U+n[6]*G+n[10]*k),n[15]=1,e.calculatingWorldMatrix&&e.calculateWorldMatrix()&&(h|=i.WORLD_CHANGED),(u!==n[0]||c!==n[1]||p!==n[2]||l!==n[4]||d!==n[5]||f!==n[6]||_!==n[8]||g!==n[9]||y!==n[10]||v!==n[12]||m!==n[13]||w!==n[14])&&(h|=i.LOCAL_CHANGED),h}function o(t,e){var n=e.getLocalTransform(),s=e.parent.getLocalTransform(),r=t.getSize(),o=e.vectors,a=e.offsets,h=t.getParent().getSize(),u=!1,c=n[0],p=n[1],l=n[2],d=n[4],f=n[5],_=n[6],g=n[8],y=n[9],v=n[10],m=n[12],w=n[13],x=n[14],E=s[0],C=s[1],I=s[2],T=s[4],b=s[5],z=s[6],S=s[8],M=s[9],R=s[10],A=s[12],O=s[13],D=s[14],L=o.position[0],P=o.position[1],N=o.position[2],U=o.rotation[0],G=o.rotation[1],k=o.rotation[2],F=o.rotation[3],V=o.scale[0],q=o.scale[1],B=o.scale[2],H=a.align[0]*h[0],W=a.align[1]*h[1],Q=a.align[2]*h[2],j=a.mountPoint[0]*r[0],Y=a.mountPoint[1]*r[1],K=a.mountPoint[2]*r[2],Z=a.origin[0]*r[0],X=a.origin[1]*r[1],J=a.origin[2]*r[2],$=F*U,tt=F*G,et=F*k,it=U*U,nt=G*G,st=k*k,rt=U*G,ot=U*k,at=G*k,ht=(1-2*(nt+st))*V,ut=2*(rt+et)*V,ct=2*(ot-tt)*V,pt=2*(rt-et)*q,lt=(1-2*(it+st))*q,dt=2*(at+$)*q,ft=2*(ot+tt)*B,_t=2*(at-$)*B,gt=(1-2*(it+nt))*B,yt=H+L-j+Z-(ht*Z+pt*X+ft*J),vt=W+P-Y+X-(ut*Z+lt*X+_t*J),mt=Q+N-K+J-(ct*Z+dt*X+gt*J);return n[0]=E*ht+T*ut+S*ct,n[1]=C*ht+b*ut+M*ct,n[2]=I*ht+z*ut+R*ct,n[3]=0,n[4]=E*pt+T*lt+S*dt,n[5]=C*pt+b*lt+M*dt,n[6]=I*pt+z*lt+R*dt,n[7]=0,n[8]=E*ft+T*_t+S*gt,n[9]=C*ft+b*_t+M*gt,n[10]=I*ft+z*_t+R*gt,n[11]=0,n[12]=E*yt+T*vt+S*mt+A,n[13]=C*yt+b*vt+M*mt+O,n[14]=I*yt+z*vt+R*mt+D,n[15]=1,e.calculatingWorldMatrix&&e.calculateWorldMatrix()&&(u|=i.WORLD_CHANGED),(c!==n[0]||p!==n[1]||l!==n[2]||d!==n[4]||f!==n[5]||_!==n[6]||g!==n[8]||y!==n[9]||v!==n[10]||m!==n[12]||w!==n[13]||x!==n[14])&&(u|=i.LOCAL_CHANGED),u}function a(t,e,i){var n,s=e[0],r=e[1],o=e[2],a=e[4],h=e[5],u=e[6],c=e[8],p=e[9],l=e[10],d=e[12],f=e[13],_=e[14],g=!1,y=i[0],v=i[1],m=i[2],w=i[3];return n=y*s+v*a+m*c+w*d,g=g?g:t[0]===n,t[0]=n,n=y*r+v*h+m*p+w*f,g=g?g:t[1]===n,t[1]=n,n=y*o+v*u+m*l+w*_,g=g?g:t[2]===n,t[2]=n,t[3]=0,y=i[4],v=i[5],m=i[6],w=i[7],n=y*s+v*a+m*c+w*d,g=g?g:t[4]===n,t[4]=n,n=y*r+v*h+m*p+w*f,g=g?g:t[5]===n,t[5]=n,n=y*o+v*u+m*l+w*_,g=g?g:t[6]===n,t[6]=n,t[7]=0,y=i[8],v=i[9],m=i[10],w=i[11],n=y*s+v*a+m*c+w*d,g=g?g:t[8]===n,t[8]=n,n=y*r+v*h+m*p+w*f,g=g?g:t[9]===n,t[9]=n,n=y*o+v*u+m*l+w*_,g=g?g:t[10]===n,t[10]=n,t[11]=0,y=i[12],v=i[13],m=i[14],w=i[15],n=y*s+v*a+m*c+w*d,g=g?g:t[12]===n,t[12]=n,n=y*r+v*h+m*p+w*f,g=g?g:t[13]===n,t[13]=n,n=y*o+v*u+m*l+w*_,g=g?g:t[14]===n,t[14]=n,t[15]=1,g}var h=[0,0,0,1],u=[1,1,1];i.IDENT=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],i.WORLD_CHANGED=1,i.LOCAL_CHANGED=2,i.prototype.reset=function(){this.parent=null,this.breakPoint=!1,this.calculatingWorldMatrix=!1},i.prototype.setParent=function(t){this.parent=t},i.prototype.getParent=function(){return this.parent},i.prototype.setBreakPoint=function(){this.breakPoint=!0,this.calculatingWorldMatrix=!0},i.prototype.setCalculateWorldMatrix=function(){this.calculatingWorldMatrix=!0},i.prototype.isBreakPoint=function(){return this.breakPoint},i.prototype.getLocalTransform=function(){return this.local},i.prototype.getWorldTransform=function(){if(!this.isBreakPoint()&&!this.calculatingWorldMatrix)throw new Error("This transform is not calculating world transforms");return this.global},i.prototype.calculate=function(t){return!this.parent||this.parent.isBreakPoint()?r(t,this):o(t,this)},i.prototype.getPosition=function(){return this.vectors.position},i.prototype.setPosition=function(t,e,i){this.vectors.positionChanged=s(this.vectors.position,t,e,i)},i.prototype.getRotation=function(){return this.vectors.rotation},i.prototype.setRotation=function(t,e,i,n){var r,o,a,h,u=this.vectors.rotation;if(null!=n)r=t,o=e,a=i,h=n,this._lastEulerVals[0]=null,this._lastEulerVals[1]=null,this._lastEulerVals[2]=null,this._lastEuler=!1;else{if(null==t||null==e||null==i)if(this._lastEuler)t=null==t?this._lastEulerVals[0]:t,e=null==e?this._lastEulerVals[1]:e,i=null==i?this._lastEulerVals[2]:i;else{var c=-2*(u[1]*u[2]-u[3]*u[0]);Math.abs(c)>.99999?(e=null==e?.5*Math.PI*c:e,t=null==t?Math.atan2(-u[0]*u[2]+u[3]*u[1],.5-u[1]*u[1]-u[2]*u[2]):t,i=null==i?0:i):(e=null==e?Math.asin(c):e,t=null==t?Math.atan2(u[0]*u[2]+u[3]*u[1],.5-u[0]*u[0]-u[1]*u[1]):t,i=null==i?Math.atan2(u[0]*u[1]+u[3]*u[2],.5-u[0]*u[0]-u[2]*u[2]):i)}var p=.5*t,l=.5*e,d=.5*i,f=Math.sin(p),_=Math.sin(l),g=Math.sin(d),y=Math.cos(p),v=Math.cos(l),m=Math.cos(d),w=_*g,x=v*g,E=_*m,C=v*m;r=f*C+y*w,o=y*E-f*x,a=y*x+f*E,h=y*C-f*w,this._lastEuler=!0,this._lastEulerVals[0]=t,this._lastEulerVals[1]=e,this._lastEulerVals[2]=i}this.vectors.rotationChanged=s(u,r,o,a,h)},i.prototype.getScale=function(){return this.vectors.scale},i.prototype.setScale=function(t,e,i){this.vectors.scaleChanged=s(this.vectors.scale,t,e,i)},i.prototype.getAlign=function(){return this.offsets.align},i.prototype.setAlign=function(t,e,i){this.offsets.alignChanged=s(this.offsets.align,t,e,null!=i?i-.5:i)},i.prototype.getMountPoint=function(){return this.offsets.mountPoint},i.prototype.setMountPoint=function(t,e,i){this.offsets.mountPointChanged=s(this.offsets.mountPoint,t,e,null!=i?i-.5:i)},i.prototype.getOrigin=function(){return this.offsets.origin},i.prototype.setOrigin=function(t,e,i){this.offsets.originChanged=s(this.offsets.origin,t,e,null!=i?i-.5:i)},i.prototype.calculateWorldMatrix=function(){for(var t=this.parent;t&&!t.isBreakPoint();)t=t.parent;if(t)return a(this.global,t.getWorldTransform(),this.local);for(var e=0;16>e;e++)this.global[e]=this.local[e];return!1},t.exports=i},function(t,e){"use strict";function i(t){this.type=t.type,this.defaultPrevented=t.defaultPrevented,this.timeStamp=t.timeStamp;var e=t.target.constructor;(e===HTMLInputElement||e===HTMLTextAreaElement||e===HTMLSelectElement)&&(this.value=t.target.value)}i.prototype.toString=function(){return"Event"},t.exports=i},function(t,e,i){"use strict";function n(t){s.call(this,t),this.screenX=t.screenX,this.screenY=t.screenY,this.clientX=t.clientX,this.clientY=t.clientY,this.ctrlKey=t.ctrlKey,this.shiftKey=t.shiftKey,this.altKey=t.altKey,this.metaKey=t.metaKey,this.button=t.button,this.buttons=t.buttons,this.pageX=t.pageX,this.pageY=t.pageY,this.x=t.x,this.y=t.y,this.offsetX=t.offsetX,this.offsetY=t.offsetY}var s=i(6);n.prototype=Object.create(s.prototype),n.prototype.constructor=n,n.prototype.toString=function(){return"MouseEvent"},t.exports=n},function(t,e){"use strict";var i=function(t,e){t instanceof Array||t instanceof Float32Array?(this.x=t[0]||0,this.y=t[1]||0):(this.x=t||0,this.y=e||0)};i.prototype.set=function(t,e){return null!=t&&(this.x=t),null!=e&&(this.y=e),this},i.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},i.prototype.subtract=function(t){return this.x-=t.x,this.y-=t.y,this},i.prototype.scale=function(t){return t instanceof i?(this.x*=t.x,this.y*=t.y):(this.x*=t,this.y*=t),this},i.prototype.rotate=function(t){var e=this.x,i=this.y,n=Math.cos(t),s=Math.sin(t);return this.x=e*n-i*s,this.y=e*s+i*n,this},i.prototype.dot=function(t){return this.x*t.x+this.y*t.y},i.prototype.cross=function(t){return this.x*t.y-this.y*t.x},i.prototype.invert=function(){return this.x*=-1,this.y*=-1,this},i.prototype.map=function(t){return this.x=t(this.x),this.y=t(this.y),this},i.prototype.length=function(){var t=this.x,e=this.y;return Math.sqrt(t*t+e*e)},i.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this},i.prototype.clear=function(){return this.x=0,this.y=0,this},i.prototype.isZero=function(){return 0!==this.x||0!==this.y?!1:!0},i.prototype.toArray=function(){return[this.x,this.y]},i.normalize=function(t,e){var i=t.x,n=t.y,s=Math.sqrt(i*i+n*n)||1;return s=1/s,e.x=t.x*s,e.y=t.y*s,e},i.clone=function(t){return new i(t.x,t.y)},i.add=function(t,e,i){return i.x=t.x+e.x,i.y=t.y+e.y,i},i.subtract=function(t,e,i){return i.x=t.x-e.x,i.y=t.y-e.y,i},i.scale=function(t,e,i){return i.x=t.x*e,i.y=t.y*e,i},i.dot=function(t,e){return t.x*e.x+t.y*e.y},i.cross=function(t,e){return t.x*e.y-t.y*e.x},t.exports=i},function(t,e,i){"use strict";function n(t,e,i){var n=y;return l.cross(t,e,n),l.cross(n,i,n),n}function s(t,e){for(var i,n,s,r,o=-(1/0),a=0;a<t.length;a++)s=t[a],n=l.dot(s,e),n>o&&(i=s,o=n,r=a);return{vertex:i,index:r}}function r(t,e,i){this.distance=t,this.normal=e,this.vertexIndices=i}function o(){this.vertices=[],this.numVertices=0,this.features=[],this.numFeatures=0,this.lastVertexIndex=0,this._IDPool={vertices:[],features:[]}}function a(t,e,i,n){for(var s=t[i].vertex,r=t[n].vertex,o=0,a=e.length;a>o;o++){var h=e[o];if(h){var u=t[h[0]].vertex,c=t[h[1]].vertex;if(s===u&&r===c||s===c&&r===u)return void(e[o]=null)}}e.push([i,n])}function h(t,e){e=e||1e3;var i,n,s=u(t,e),r=[];for(i=0,n=s.features.length;n>i;i++){var o=s.features[i];o&&r.push(o.vertexIndices)}var a=p(s.vertices,r),h=a.centroid,c=[];for(i=0,n=s.vertices.length;n>i;i++)c.push(l.subtract(s.vertices[i].vertex,h,new l));var d=[];for(i=0,n=c.length;n>i;i++)d.push(l.normalize(c[i],new l));var f={},_={};for(i=0;i<r.length;i++){var g=r[i][0],y=r[i][1],v=r[i][2];_[g]=_[g]||{},_[y]=_[y]||{},_[v]=_[v]||{},f[g]=f[g]||[],f[y]=f[y]||[],f[v]=f[v]||[],_[g][y]||(_[g][y]=1,f[g].push(y)),_[g][v]||(_[g][v]=1,f[g].push(v)),_[y][g]||(_[y][g]=1,f[y].push(g)),_[y][v]||(_[y][v]=1,f[y].push(v)),_[v][g]||(_[v][g]=1,f[v].push(g)),_[v][y]||(_[v][y]=1,f[v].push(y))}this.indices=r,this.vertices=c,this.normals=d,this.polyhedralProperties=a,this.graph=f}function u(t,e){var i=new o;i.addVertex(s(t,new l(1,0,0))),i.addVertex(s(t,new l(-1,0,0)));var r,a,h,u,c,p,d=i.vertices[0].vertex,f=i.vertices[1].vertex,_=l.subtract(f,d,x),g=-(1/0);for(c=0;c<t.length;c++)if(a=t[c],a!==d&&a!==f){var y=l.subtract(a,d,v);r=l.dot(y,n(_,y,_)),r=0>r?-1*r:r,r>g&&(g=r,h=a,u=c)}i.addVertex({vertex:h,index:u});var m=h,w=l.subtract(m,d,E),b=l.cross(_,w,new l);for(b.normalize(),g=-(1/0),c=0;c<t.length;c++)a=t[c],a!==d&&a!==f&&a!==m&&(r=l.dot(l.subtract(a,d,v),b),r=0>r?-1*r:r,r>g&&(g=r,h=a,u=c));i.addVertex({vertex:h,index:u});var z=h,S=l.subtract(z,d,C),M=l.subtract(m,f,I),R=l.subtract(z,f,T),A=l.cross(w,S,new l),O=l.cross(_,S,new l),D=l.cross(M,R,new l);A.normalize(),O.normalize(),D.normalize(),l.dot(b,S)>0&&b.invert(),l.dot(A,_)>0&&A.invert(),l.dot(O,w)>0&&O.invert(),l.dot(D,_)<0&&D.invert();var L=0,P=1,N=2,U=3;i.addFeature(null,b,[L,P,N]),i.addFeature(null,A,[L,N,U]),i.addFeature(null,O,[L,P,U]),i.addFeature(null,D,[P,N,U]);var G={};for(c=0,p=i.vertices.length;p>c;c++)G[i.vertices[c].index]=!0;var k=d.x+f.x+m.x+z.x,F=d.y+f.y+m.y+z.y,V=d.z+f.z+m.z+z.z,q=new l(k,F,V);q.scale(.25);for(var B=i.features,H=0;H++<e;){var W=null;for(c=0,p=B.length;p>c;c++)if(B[c]&&!B[c].done){W=B[c],h=null,u=null,d=i.vertices[W.vertexIndices[0]].vertex;var Q=s(t,W.normal);h=Q.vertex,u=Q.index;var j=l.dot(l.subtract(h,d,v),W.normal);.001>j||G[u]?W.done=!0:(G[u]=!0,i.addVertex(Q),i.reshape(q))}if(null===W)break}return i}function c(t,e,i,n,s){var r=t+e;n[0]=r+i;var o=t*t,a=o+e*r;n[1]=a+i*n[0],n[2]=t*o+e*a+i*n[1],s[0]=n[1]+t*(n[0]+t),s[1]=n[1]+e*(n[0]+e),s[2]=n[1]+i*(n[0]+i)}function p(t,e){var i,n,s=[0,0,0,0,0,0,0,0,0,0],r=[],o=[],a=[],h=[],u=[],p=[];for(i=0,n=e.length;n>i;i++){var f=t[e[i][0]].vertex,_=t[e[i][1]].vertex,g=t[e[i][2]].vertex,y=l.subtract(_,f,x),v=l.subtract(g,f,E),m=y.cross(v);l.dot(f,m)<0&&m.invert();var w=m.x,C=m.y,I=m.z,T=f.x,b=f.y,z=f.z,S=_.x,M=_.y,R=_.z,A=g.x,O=g.y,D=g.z;c(T,S,A,r,h),c(b,M,O,o,u),c(z,R,D,a,p),s[0]+=w*r[0],s[1]+=w*r[1],s[2]+=C*o[1],s[3]+=I*a[1],s[4]+=w*r[2],s[5]+=C*o[2],s[6]+=I*a[2],s[7]+=w*(b*h[0]+M*h[1]+O*h[2]),s[8]+=C*(z*u[0]+R*u[1]+D*u[2]),s[9]+=I*(T*p[0]+S*p[1]+A*p[2])}s[0]/=6,s[1]/=24,s[2]/=24,s[3]/=24,s[4]/=60,s[5]/=60,s[6]/=60,s[7]/=120,s[8]/=120,s[9]/=120;var L=1/0,P=-(1/0),N=1/0,U=-(1/0),G=1/0,k=-(1/0);for(i=0,n=t.length;n>i;i++){var F=t[i].vertex;F.x<L&&(L=F.x),F.x>P&&(P=F.x),F.y<N&&(N=F.y),F.y>U&&(U=F.y),F.z<G&&(G=F.z),F.z>k&&(k=F.z)}var V=[P-L,U-N,k-G],q=s[0],B=new l(s[1],s[2],s[3]);B.scale(1/q);var H=new d([s[4],s[7],s[9],s[7],s[5],s[8],s[9],s[8],s[6]]);return{size:V,volume:q,centroid:B,eulerTensor:H}}var l=i(1),d=i(3),f=i(13);f.register("DynamicGeometry",o),f.register("DynamicGeometryFeature",r);var _=f.requestDynamicGeometryFeature,g=f.freeDynamicGeometryFeature,y=new l,v=new l,m=new l,w=new l,x=new l,E=new l,C=new l,I=new l,T=new l;r.prototype.reset=function(t,e,i){return this.distance=t,this.normal=e,this.vertexIndices=i,this},o.prototype.reset=function(){return this.vertices=[],this.numVertices=0,this.features=[],this.numFeatures=0,this.lastVertexIndex=0,this._IDPool={vertices:[],features:[]},this},o.prototype.addVertex=function(t){var e=this._IDPool.vertices.length?this._IDPool.vertices.pop():this.vertices.length;this.vertices[e]=t,this.lastVertexIndex=e,this.numVertices++},o.prototype.removeVertex=function(t){var e=this.vertices[t];return this.vertices[t]=null,this._IDPool.vertices.push(t),this.numVertices--,e},o.prototype.addFeature=function(t,e,i){var n=this._IDPool.features.length?this._IDPool.features.pop():this.features.length;this.features[n]=_().reset(t,e,i),this.numFeatures++},o.prototype.removeFeature=function(t){var e=this.features[t];this.features[t]=null,this._IDPool.features.push(t),this.numFeatures--,g(e)},o.prototype.getLastVertex=function(){return this.vertices[this.lastVertexIndex]},o.prototype.getFeatureClosestToOrigin=function(){for(var t=1/0,e=null,i=this.features,n=0,s=i.length;s>n;n++){var r=i[n];r&&r.distance<t&&(t=r.distance,e=r)}return e},o.prototype.reshape=function(t){var e,i,n,s,r,o=this.vertices,h=this.getLastVertex().vertex,u=this.features,c=[];for(n=0,r=u.length;r>n;n++)u[n]&&(i=u[n].vertexIndices,e=o[i[0]].vertex,l.dot(u[n].normal,l.subtract(h,e,m))>-.001&&(a(o,c,i[0],i[1]),a(o,c,i[1],i[2]),a(o,c,i[2],i[0]),this.removeFeature(n)));var p=h,d=this.lastVertexIndex;for(s=0,r=c.length;r>s;s++)if(c[s]){var f=c[s][0],_=c[s][1],g=o[f].vertex,y=o[_].vertex,w=l.subtract(g,p,x),C=l.subtract(y,p,E),I=l.cross(w,C,new l);if(I.normalize(),t){var T=l.subtract(t,p,v);l.dot(I,T)>-.001&&I.invert(),this.addFeature(null,I,[d,f,_])}else{var b=l.dot(I,p);0>b&&(I.invert(),b*=-1),this.addFeature(b,I,[d,f,_])}}},o.prototype.simplexContainsOrigin=function(t,e){var i=this.vertices.length,s=this.lastVertexIndex,r=s-1,o=s-2,a=s-3;r=0>r?r+i:r,o=0>o?o+i:o,a=0>a?a+i:a;var h,u,c,p,d,f,_,g,y,v,m,b,z,S=this.vertices[s].vertex,M=this.vertices[r].vertex,R=this.vertices[o].vertex,A=this.vertices[a].vertex,O=l.scale(S,-1,w),D=l.subtract(M,S,x);if(4===i){if(h=l.subtract(R,S,E),u=l.subtract(A,S,C),d=l.cross(D,h,new l),f=l.cross(h,u,new l),_=l.cross(D,u,new l),d.normalize(),f.normalize(),_.normalize(),l.dot(d,u)>0&&d.invert(),l.dot(f,D)>0&&f.invert(),l.dot(_,h)>0&&_.invert(),y=l.dot(d,O),v=l.dot(f,O),m=l.dot(_,O),.001>y&&.001>m&&.001>v)return c=l.subtract(R,M,I),p=l.subtract(A,M,T),g=l.cross(c,p,new l),g.normalize(),l.dot(g,D)<=0&&g.invert(),b=-1*l.dot(g,M),this.addFeature(-y,d,[s,r,o]),this.addFeature(-v,f,[s,o,a]),this.addFeature(-m,_,[s,a,r]),this.addFeature(-b,g,[r,o,a]),!0;y>=.001?(z=this.removeVertex(a),t.copy(d)):v>=.001?(z=this.removeVertex(r),t.copy(f)):(z=this.removeVertex(o),t.copy(_))}else 3===i?(h=l.subtract(R,S,E),l.cross(D,h,t),l.dot(t,O)<=0&&t.invert()):t.copy(n(D,O,D));return z&&e&&e(z),!1},t.exports={DynamicGeometry:o,ConvexHull:h}},function(t,e,i){"use strict";function n(t){function e(e){r.call(this,e);var i=t.polyhedralProperties.size,n=e.size||i,h=n[0]/i[0],u=n[1]/i[1],c=n[2]/i[2];this._scale=[h,u,c];var p=new o([h,0,0,0,u,0,0,0,c]);this.hull=t,this.vertices=[];for(var l=0,d=t.vertices.length;d>l;l++)this.vertices.push(p.vectorMultiply(t.vertices[l],new a));s.call(this,p),this.inverseInertia.copy(this.localInverseInertia),this.updateInertia();var f=e.angularVelocity;f&&this.setAngularVelocity(f.x,f.y,f.z)}if(!(t instanceof u)){if(!(t instanceof Array))throw new Error("convexBodyFactory requires a ConvexHull object or an array of Vec3's as input.");t=new u(t)}return e.prototype=Object.create(r.prototype),e.prototype.constructor=e,e.prototype.setSize=function(e,i,n){var s=t.polyhedralProperties.size;this.size[0]=e,this.size[1]=i,this.size[2]=n;var r=e/s[0],a=i/s[1],h=n/s[2];this._scale=[r,a,h];for(var u=new o([r,0,0,0,a,0,0,0,h]),c=this.vertices,p=0,l=t.vertices.length;l>p;p++)u.vectorMultiply(t.vertices[p],c[p]);return this},e.prototype.updateLocalInertia=function(){var t=this._scale[0],e=this._scale[1],i=this._scale[2],n=new o([t,0,0,0,e,0,0,0,i]);return s.call(this,n),this},e.prototype.support=function(t){for(var e,i,n,s=this.vertices,r=-(1/0),o=0,h=s.length;h>o;o++)e=s[o],i=a.dot(e,t),i>r&&(n=e,r=i);return n},e.prototype.updateShape=function(){for(var t=this.vertices,e=this.orientation,i=this.hull.vertices,n=this._scale[0],s=this._scale[1],r=this._scale[2],o=c,h=0,u=t.length;u>h;h++)o.copy(i[h]),o.x*=n,o.y*=s,o.z*=r,a.applyRotation(o,e,t[h]);return this},e}function s(t){var e=this.hull.polyhedralProperties,i=t.get(),n=i[0]*i[4]*i[8],s=e.eulerTensor,r=new o;o.multiply(t,s,r),o.multiply(r,t,r);var a=r.get(),h=a[0],u=a[4],c=a[8],p=a[1],l=a[7],d=a[2],f=e.volume*n,_=this.mass,g=_/f,y=u+c,v=h+c,m=h+u,w=-p,x=-l,E=-d,C=e.centroid;y-=f*(C.y*C.y+C.z*C.z),v-=f*(C.z*C.z+C.x*C.x),m-=f*(C.x*C.x+C.y*C.y),w+=f*C.x*C.y,x+=f*C.y*C.z,E+=f*C.z*C.x,y*=g*n,v*=g*n,m*=g*n,w*=g*n,x*=g*n,E*=g*n;var I=[y,w,E,w,v,x,E,x,m];this.localInertia.set(I),o.inverse(this.localInertia,this.localInverseInertia)}var r=i(10),o=i(3),a=i(1),h=i(21),u=h.ConvexHull,c=new a;t.exports=n},function(t,e){"use strict";function i(t){this._body=t,this._ID=t._ID,this.position=null,this.vertices={x:[],y:[],z:[]},this.update()}var n=4,s=8,r=0,o=1,a=2,h=3,u=4,c=5;i.prototype.update=function(){var t=this._body,e=this.position=t.position,i=1/0,p=-(1/0),l=1/0,d=-(1/0),f=1/0,_=-(1/0),g=t.type;if(g===n)p=d=_=t.radius,i=l=f=-t.radius;else if(g===s){var y=t.direction;switch(p=d=_=1e6,i=l=f=-1e6,y){case r:d=25,l=-1e3;break;case o:d=1e3,l=-25;break;case a:p=25,i=-1e3;break;case h:p=1e3,i=-25;break;case u:_=25,f=-1e3;break;case c:_=1e3,f=-25}}else if(t.vertices)for(var v=t.vertices,m=0,w=v.length;w>m;m++){var x=v[m];x.x<i&&(i=x.x),x.x>p&&(p=x.x),x.y<l&&(l=x.y),x.y>d&&(d=x.y),x.z<f&&(f=x.z),x.z>_&&(_=x.z)}else p=d=_=25,i=l=f=-25;var E=this.vertices;E.x[0]=i+e.x,E.x[1]=p+e.x,E.y[0]=l+e.y,E.y[1]=d+e.y,E.z[0]=f+e.z,E.z[1]=_+e.z},i.checkOverlap=function(t,e){var i=t.vertices,n=e.vertices,s=i.x[0],r=i.x[1],o=n.x[0],a=n.x[1];if(s>=o&&a>=s||o>=s&&r>=o){var h=i.y[0],u=i.y[1],c=n.y[0],p=n.y[1];if(h>=c&&p>=h||c>=h&&u>=c){var l=i.z[0],d=i.z[1],f=n.z[0],_=n.z[1];if(l>=f&&_>=l||f>=l&&d>=f)return!0}}return!1},i.vertexThreshold=100,t.exports=i},function(t,e){"use strict";var i,n,s=0,r=["ms","moz","webkit","o"];if("object"==typeof window){i=window.requestAnimationFrame,n=window.cancelAnimationFrame||window.cancelRequestAnimationFrame;for(var o=0;o<r.length&&!i;++o)i=window[r[o]+"RequestAnimationFrame"],n=window[r[o]+"CancelRequestAnimationFrame"]||window[r[o]+"CancelAnimationFrame"];i&&!n&&(i=null)}if(!i){var a=Date.now?Date.now:function(){return(new Date).getTime()};i=function(t){var e=a(),i=Math.max(0,16-(e-s)),n=setTimeout(function(){t(e+i)},i);return s=e+i,n},n=function(t){clearTimeout(t)}}var h={requestAnimationFrame:i,cancelAnimationFrame:n};t.exports=h},function(t,e,i){"use strict";function n(t){this.events=new p,t=t||{},this.bodies=[],this.forces=[],this.constraints=[],this.step=t.step||1e3/60,this.iterations=t.iterations||10,this._indexPools={bodies:[],forces:[],constraints:[]},this._entityMaps={bodies:{},forces:{},constraints:{}},this.speed=t.speed||1,this.time=0,this.delta=0,this.origin=t.origin||new l,this.orientation=t.orientation?t.orientation.normalize():new d,this.frameDependent=t.frameDependent||!1,this.transformBuffers={position:[0,0,0],rotation:[0,0,0,1]}}function s(t,e,i){var n=t._entityMaps[i];if(null==n[e._ID]){var s=t[i],r=t._indexPools[i];r.length?n[e._ID]=r.pop():n[e._ID]=s.length,s[n[e._ID]]=e}}function r(t,e,i){var n=t._entityMaps[i],s=n[e._ID];null!=s&&(t._indexPools[i].push(s),t[i][s]=null,n[e._ID]=null)}function o(t,e){t.momentum.add(l.scale(t.force,e,g)),t.angularMomentum.add(l.scale(t.torque,e,g)),l.scale(t.momentum,t.inverseMass,t.velocity),t.inverseInertia.vectorMultiply(t.angularMomentum,t.angularVelocity),t.force.clear(),t.torque.clear()}function a(t,e){if(0!==t.restrictions){var i=t.restrictions,n=null,s=null,r=null,o=null,a=null,h=null;32&i&&(n=0),16&i&&(s=0),8&i&&(r=0),4&i&&(o=0),2&i&&(a=0),1&i&&(h=0),(null!==n||null!==s||null!==r)&&t.setVelocity(n,s,r),(null!==o||null!==a||null!==h)&&t.setAngularVelocity(o,a,h)}t.position.add(l.scale(t.velocity,e,g));var u=t.angularVelocity,c=t.orientation,p=u.x,d=u.y,f=u.z,_=c.w,y=c.x,v=c.y,m=c.z,w=.5*e;c.w+=(-p*y-d*v-f*m)*w,c.x+=(p*_+d*m-f*v)*w,c.y+=(d*_+f*y-p*m)*w,c.z+=(f*_+p*v-d*y)*w,c.normalize(),t.updateInertia()}var h=i(10),u=i(2),c=i(4),p=i(11),l=i(1),d=i(7),f=new l,_=new d,g=new l;n.prototype.on=function(t,e){return this.events.on(t,e),this},n.prototype.off=function(t,e){return this.events.off(t,e),this},n.prototype.trigger=function(t,e){return this.events.trigger(t,e),this},n.prototype.setOrigin=function(t,e,i){return this.origin.set(t,e,i),this},n.prototype.setOrientation=function(t,e,i,n){return this.orientation.set(t,e,i,n).normalize(),this},n.prototype.add=function(){for(var t=0,e=arguments.length;e>t;t++){var i=arguments[t];if(i instanceof Array)for(var n=0,s=i.length;s>n;n++){var r=i[n];this.add(r)}else i instanceof h?this.addBody(i):i instanceof u?this.addConstraint(i):i instanceof c&&this.addForce(i)}return this},n.prototype.remove=function(){for(var t=0,e=arguments.length;e>t;t++){var i=arguments[t];if(i instanceof Array)for(var n=0,s=i.length;s>n;n++){var r=i[n];this.add(r)}else i instanceof h?this.removeBody(i):i instanceof u?this.removeConstraint(i):i instanceof c&&this.removeForce(i)}return this},n.prototype.addBody=function(t){s(this,t,"bodies")},n.prototype.addForce=function(t){s(this,t,"forces")},n.prototype.addConstraint=function(t){s(this,t,"constraints")},n.prototype.removeBody=function(t){r(this,t,"bodies")},n.prototype.removeForce=function(t){r(this,t,"forces")},n.prototype.removeConstraint=function(t){r(this,t,"constraints")},n.prototype.update=function(t){0===this.time&&(this.time=t);var e=this.bodies,i=this.forces,n=this.constraints,s=this.frameDependent,r=this.step,h=.001*r,u=this.speed,c=this.delta;c+=(t-this.time)*u,this.time=t;for(var p,l,d,f,_;c>r;){for(this.events.trigger("prestep",t),p=0,l=i.length;l>p;p++)d=i[p],null!==d&&d.update(t,h);for(p=0,l=e.length;l>p;p++)f=e[p],null!==f&&o(f,h);for(p=0,l=n.length;l>p;p++)_=n[p],null!==_&&_.update(t,h);for(var g=0,y=this.iterations;y>g;g++)for(p=0,l=n.length;l>p;p++)_=n[p],null!==_&&_.resolve(t,h);for(p=0,l=e.length;l>p;p++)f=e[p],null!==f&&a(f,h);this.events.trigger("poststep",t),s?c=0:c-=r}this.delta=c},n.prototype.getTransform=function(t){var e=this.origin,i=this.orientation,n=this.transformBuffers,s=t.position,r=t.orientation,o=r,a=s;return 1!==i.w&&(o=d.multiply(r,i,_),a=i.rotateVector(s,f)),n.position[0]=e.x+a.x,n.position[1]=e.y+a.y,n.position[2]=e.z+a.z,n.rotation[0]=o.x,n.rotation[1]=o.y,n.rotation[2]=o.z,n.rotation[3]=o.w,n},t.exports=n},function(t,e,i){"use strict";function n(){var t=this;a._setUpdater(this),this._updateQueue=[],this._nextUpdateQueue=[],this._scenes={},this._messages=g,this._inUpdate=!1,this._clock=new s,this._channel=new o,this._channel.onMessage=function(e){t.handleMessage(e)}}var s=i(29),r=i(32),o=i(28),a=i(8),h=i(72),u=i(70),c=i(69),p=i(12),l=i(14),d=i(5),f=[d.ENGINE,d.START],_=[d.ENGINE,d.STOP],g=[d.TIME,null];n.prototype.init=function(t){if("undefined"==typeof window)throw new Error("FamousEngine#init needs to have access to the global window object. Instantiate Compositor and UIManager manually in the UI thread.");return this.compositor=t&&t.compositor||new u,this.renderLoop=t&&t.renderLoop||new c,this.uiManager=new h(this.getChannel(),this.compositor,this.renderLoop),this},n.prototype.setChannel=function(t){return this._channel=t,this},n.prototype.getChannel=function(){return this._channel},n.prototype._update=function(){this._inUpdate=!0;var t,e=this._clock.now(),i=this._nextUpdateQueue,n=this._updateQueue;for(this._messages[1]=e,l.update(),p.update();i.length;)n.unshift(i.pop());for(;n.length;)t=n.shift(),t&&t.update&&t.update(e),t&&t.onUpdate&&t.onUpdate(e);this._inUpdate=!1},n.prototype.requestUpdate=function(t){if(!t)throw new Error("requestUpdate must be called with a class to be updated");this._inUpdate?this.requestUpdateOnNextTick(t):this._updateQueue.push(t)},n.prototype.requestUpdateOnNextTick=function(t){this._nextUpdateQueue.push(t)},n.prototype.handleMessage=function(t){if(!t)throw new Error("onMessage must be called with an array of messages");for(var e;t.length>0;)switch(e=t.shift()){case d.WITH:this.handleWith(t);break;case d.FRAME:this.handleFrame(t);break;default:throw new Error("received unknown command: "+e)}return this},n.prototype.handleWith=function(t){var e=t.shift(),i=t.shift();switch(i){case d.TRIGGER:var n=t.shift(),s=t.shift();a.dispatchUIEvent(e,n,s);break;default:throw new Error("received unknown command: "+i)}return this},n.prototype.handleFrame=function(t){if(!t)throw new Error("handleFrame must be called with an array of messages");if(!t.length)throw new Error("FRAME must be sent with a time");return this.step(t.shift()),this},n.prototype.step=function(t){if(null==t)throw new Error("step must be called with a time");if(this._clock.step(t),this._update(),this._messages.length)for(this._channel.sendMessage(this._messages);this._messages.length>2;)this._messages.pop();return this},n.prototype.getContext=function(t){if(!t)throw new Error("getContext must be called with a selector");var e=t.indexOf("/");return t=-1===e?t:t.substring(0,e),this._scenes[t]},n.prototype.getClock=function(){return this._clock},n.prototype.message=function(t){return this._messages.push(t),this},n.prototype.createScene=function(t){return t=t||"body",this._scenes[t]&&this._scenes[t].dismount(),this._scenes[t]=new r(t,this),this._scenes[t]},n.prototype.addScene=function(t){var e=t._selector,i=this._scenes[e];return i&&i!==t&&i.dismount(),t.isMounted()||t.mount(t.getSelector()),this._scenes[e]=t,this},n.prototype.removeScene=function(t){var e=t._selector,i=this._scenes[e];return i&&i===t&&(t.isMounted()&&t.dismount(),delete this._scenes[e]),this},n.prototype.startRenderLoop=function(){return this._channel.sendMessage(f),this},n.prototype.stopRenderLoop=function(){return this._channel.sendMessage(_),this},n.prototype.startEngine=function(){return console.warn("FamousEngine.startEngine is deprecated! Use FamousEngine.startRenderLoop instead!"),this.startRenderLoop()},n.prototype.stopEngine=function(){return console.warn("FamousEngine.stopEngine is deprecated! Use FamousEngine.stopRenderLoop instead!"),this.stopRenderLoop()},t.exports=new n},function(t,e,i){"use strict";function n(t){this._node=t,this._projectionType=n.ORTHOGRAPHIC_PROJECTION,this._focalDepth=0,this._near=0,this._far=0,this._requestingUpdate=!1,
this._id=t.addComponent(this),this._viewTransform=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this._viewDirty=!1,this._perspectiveDirty=!1,this.setFlat()}var s=i(5);n.FRUSTUM_PROJECTION=0,n.PINHOLE_PROJECTION=1,n.ORTHOGRAPHIC_PROJECTION=2,n.prototype.toString=function(){return"Camera"},n.prototype.getValue=function(){return{component:this.toString(),projectionType:this._projectionType,focalDepth:this._focalDepth,near:this._near,far:this._far}},n.prototype.setValue=function(t){return this.toString()===t.component?(this.set(t.projectionType,t.focalDepth,t.near,t.far),!0):!1},n.prototype.set=function(t,e,i,n){this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0),this._projectionType=t,this._focalDepth=e,this._near=i,this._far=n},n.prototype.setDepth=function(t){return this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0),this._perspectiveDirty=!0,this._projectionType=n.PINHOLE_PROJECTION,this._focalDepth=t,this._near=0,this._far=0,this},n.prototype.setFrustum=function(t,e){return this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0),this._perspectiveDirty=!0,this._projectionType=n.FRUSTUM_PROJECTION,this._focalDepth=0,this._near=t,this._far=e,this},n.prototype.setFlat=function(){return this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0),this._perspectiveDirty=!0,this._projectionType=n.ORTHOGRAPHIC_PROJECTION,this._focalDepth=0,this._near=0,this._far=0,this},n.prototype.onUpdate=function(){this._requestingUpdate=!1;var t=this._node.getLocation();if(this._node.sendDrawCommand(s.WITH).sendDrawCommand(t),this._perspectiveDirty)switch(this._perspectiveDirty=!1,this._projectionType){case n.FRUSTUM_PROJECTION:this._node.sendDrawCommand(s.FRUSTRUM_PROJECTION),this._node.sendDrawCommand(this._near),this._node.sendDrawCommand(this._far);break;case n.PINHOLE_PROJECTION:this._node.sendDrawCommand(s.PINHOLE_PROJECTION),this._node.sendDrawCommand(this._focalDepth);break;case n.ORTHOGRAPHIC_PROJECTION:this._node.sendDrawCommand(s.ORTHOGRAPHIC_PROJECTION)}this._viewDirty&&(this._viewDirty=!1,this._node.sendDrawCommand(s.CHANGE_VIEW_TRANSFORM),this._node.sendDrawCommand(this._viewTransform[0]),this._node.sendDrawCommand(this._viewTransform[1]),this._node.sendDrawCommand(this._viewTransform[2]),this._node.sendDrawCommand(this._viewTransform[3]),this._node.sendDrawCommand(this._viewTransform[4]),this._node.sendDrawCommand(this._viewTransform[5]),this._node.sendDrawCommand(this._viewTransform[6]),this._node.sendDrawCommand(this._viewTransform[7]),this._node.sendDrawCommand(this._viewTransform[8]),this._node.sendDrawCommand(this._viewTransform[9]),this._node.sendDrawCommand(this._viewTransform[10]),this._node.sendDrawCommand(this._viewTransform[11]),this._node.sendDrawCommand(this._viewTransform[12]),this._node.sendDrawCommand(this._viewTransform[13]),this._node.sendDrawCommand(this._viewTransform[14]),this._node.sendDrawCommand(this._viewTransform[15]))},n.prototype.onTransformChange=function(t){var e=t;this._viewDirty=!0,this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0);var i=e[0],n=e[1],s=e[2],r=e[3],o=e[4],a=e[5],h=e[6],u=e[7],c=e[8],p=e[9],l=e[10],d=e[11],f=e[12],_=e[13],g=e[14],y=e[15],v=i*a-n*o,m=i*h-s*o,w=i*u-r*o,x=n*h-s*a,E=n*u-r*a,C=s*u-r*h,I=c*_-p*f,T=c*g-l*f,b=c*y-d*f,z=p*g-l*_,S=p*y-d*_,M=l*y-d*g,R=1/(v*M-m*S+w*z+x*b-E*T+C*I);this._viewTransform[0]=(a*M-h*S+u*z)*R,this._viewTransform[1]=(s*S-n*M-r*z)*R,this._viewTransform[2]=(_*C-g*E+y*x)*R,this._viewTransform[3]=(l*E-p*C-d*x)*R,this._viewTransform[4]=(h*b-o*M-u*T)*R,this._viewTransform[5]=(i*M-s*b+r*T)*R,this._viewTransform[6]=(g*w-f*C-y*m)*R,this._viewTransform[7]=(c*C-l*w+d*m)*R,this._viewTransform[8]=(o*S-a*b+u*I)*R,this._viewTransform[9]=(n*b-i*S-r*I)*R,this._viewTransform[10]=(f*E-_*w+y*v)*R,this._viewTransform[11]=(p*w-c*E-d*v)*R,this._viewTransform[12]=(a*T-o*z-h*I)*R,this._viewTransform[13]=(i*z-n*T+s*I)*R,this._viewTransform[14]=(_*m-f*x-g*v)*R,this._viewTransform[15]=(c*x-p*m+l*v)*R},t.exports=n},function(t,e){"use strict";function i(){"undefined"!=typeof self&&self.window!==self&&this._enterWorkerMode()}i.prototype._enterWorkerMode=function(){this._workerMode=!0;var t=this;self.addEventListener("message",function(e){t.onMessage(e.data)})},i.prototype.onMessage=null,i.prototype.sendMessage=function(t){this._workerMode?self.postMessage(t):this.onmessage(t)},i.prototype.onmessage=null,i.prototype.postMessage=function(t){return this.onMessage(t)},t.exports=i},function(t,e){"use strict";function i(){this._time=0,this._frame=0,this._timerQueue=[],this._updatingIndex=0,this._scale=1,this._scaledTime=this._time}i.prototype.setScale=function(t){return this._scale=t,this},i.prototype.getScale=function(){return this._scale},i.prototype.step=function(t){this._frame++,this._scaledTime=this._scaledTime+(t-this._time)*this._scale,this._time=t;for(var e=0;e<this._timerQueue.length;e++)this._timerQueue[e](this._scaledTime)&&this._timerQueue.splice(e,1);return this},i.prototype.now=function(){return this._scaledTime},i.prototype.getTime=i.prototype.now,i.prototype.getFrame=function(){return this._frame},i.prototype.setTimeout=function(t,e){var i=Array.prototype.slice.call(arguments,2),n=this._time,s=function(s){return s-n>=e?(t.apply(null,i),!0):!1};return this._timerQueue.push(s),s},i.prototype.setInterval=function(t,e){var i=Array.prototype.slice.call(arguments,2),n=this._time,s=function(s){return s-n>=e&&(t.apply(null,i),n=s),!1};return this._timerQueue.push(s),s},i.prototype.clearTimer=function(t){var e=this._timerQueue.indexOf(t);return-1!==e&&this._timerQueue.splice(e,1),this},t.exports=i},function(t,e){"use strict";function i(){this.propagationStopped=!1,this.stopPropagation=n}function n(){this.propagationStopped=!0}t.exports=i},function(t,e,i){"use strict";function n(){this._requestingUpdate=!1,this._inUpdate=!1,this._mounted=!1,this._shown=!0,this._updater=null,this._opacity=1,this._UIEvents=[],this._updateQueue=[],this._nextUpdateQueue=[],this._freedComponentIndicies=[],this._components=[],this._freedChildIndicies=[],this._children=[],this._fullChildren=[],this._parent=null,this._id=null,this._transformID=null,this._sizeID=null,this.constructor.NO_DEFAULT_COMPONENTS||this._init()}var s=i(14),r=i(8),o=i(12),a=i(15),h=i(17);n.RELATIVE_SIZE=0,n.ABSOLUTE_SIZE=1,n.RENDER_SIZE=2,n.DEFAULT_SIZE=0,n.NO_DEFAULT_COMPONENTS=!1,n.prototype._init=function(){this._transformID=this.addComponent(new h),this._sizeID=this.addComponent(new a)},n.prototype._setParent=function(t){this._parent&&-1!==this._parent.getChildren().indexOf(this)&&this._parent.removeChild(this),this._parent=t},n.prototype._setMounted=function(t,e){this._mounted=t,this._id=e?e:null},n.prototype._setShown=function(t){this._shown=t},n.prototype._setUpdater=function(t){this._updater=t,this._requestingUpdate&&this._updater.requestUpdate(this)},n.prototype.getLocation=function(){return this._id},n.prototype.getId=n.prototype.getLocation,n.prototype.emit=function(t,e){return r.dispatch(this.getLocation(),t,e),this},n.prototype.sendDrawCommand=function(t){return this._updater.message(t),this},n.prototype.getValue=function(){var t=this._children.length,e=this._components.length,i=0,n={location:this.getId(),spec:{location:this.getId(),showState:{mounted:this.isMounted(),shown:this.isShown(),opacity:this.getOpacity()||null},offsets:{mountPoint:[0,0,0],align:[0,0,0],origin:[0,0,0]},vectors:{position:[0,0,0],rotation:[0,0,0,1],scale:[1,1,1]},size:{sizeMode:[0,0,0],proportional:[1,1,1],differential:[0,0,0],absolute:[0,0,0],render:[0,0,0]}},UIEvents:this._UIEvents,components:[],children:[]};if(n.location){var r=o.get(this.getId()),a=s.get(this.getId());for(i=0;3>i;i++)n.spec.offsets.mountPoint[i]=r.offsets.mountPoint[i],n.spec.offsets.align[i]=r.offsets.align[i],n.spec.offsets.origin[i]=r.offsets.origin[i],n.spec.vectors.position[i]=r.vectors.position[i],n.spec.vectors.rotation[i]=r.vectors.rotation[i],n.spec.vectors.scale[i]=r.vectors.scale[i],n.spec.size.sizeMode[i]=a.sizeMode[i],n.spec.size.proportional[i]=a.proportionalSize[i],n.spec.size.differential[i]=a.differentialSize[i],n.spec.size.absolute[i]=a.absoluteSize[i],n.spec.size.render[i]=a.renderSize[i];n.spec.vectors.rotation[3]=r.vectors.rotation[3]}for(i=0;t>i;i++)this._children[i]&&this._children[i].getValue&&n.children.push(this._children[i].getValue());for(i=0;e>i;i++)this._components[i]&&this._components[i].getValue&&n.components.push(this._components[i].getValue());return n},n.prototype.getComputedValue=function(){console.warn("Node.getComputedValue is depricated. Use Node.getValue instead");for(var t=this._children.length,e={location:this.getId(),computedValues:{transform:this.isMounted()?o.get(this.getLocation()).getLocalTransform():null,size:this.isMounted()?s.get(this.getLocation()).get():null},children:[]},i=0;t>i;i++)this._children[i]&&this._children[i].getComputedValue&&e.children.push(this._children[i].getComputedValue());return e},n.prototype.getChildren=function(){return this._fullChildren},n.prototype.getRawChildren=function(){return this._children},n.prototype.getParent=function(){return this._parent},n.prototype.requestUpdate=function(t){return this._inUpdate||!this.isMounted()?this.requestUpdateOnNextTick(t):(-1===this._updateQueue.indexOf(t)&&(this._updateQueue.push(t),this._requestingUpdate||this._requestUpdate()),this)},n.prototype.requestUpdateOnNextTick=function(t){return-1===this._nextUpdateQueue.indexOf(t)&&this._nextUpdateQueue.push(t),this},n.prototype.isMounted=function(){return this._mounted},n.prototype.isRendered=function(){return this._mounted&&this._shown},n.prototype.isShown=function(){return this._shown},n.prototype.getOpacity=function(){return this._opacity},n.prototype.getMountPoint=function(){if(this.constructor.NO_DEFAULT_COMPONENTS){if(this.isMounted())return o.get(this.getLocation()).getMountPoint();throw new Error("This node does not have access to a transform component")}return this.getComponent(this._transformID).getMountPoint()},n.prototype.getAlign=function(){if(this.constructor.NO_DEFAULT_COMPONENTS){if(this.isMounted())return o.get(this.getLocation()).getAlign();throw new Error("This node does not have access to a transform component")}return this.getComponent(this._transformID).getAlign()},n.prototype.getOrigin=function(){if(this.constructor.NO_DEFAULT_COMPONENTS){if(this.isMounted())return o.get(this.getLocation()).getOrigin();throw new Error("This node does not have access to a transform component")}return this.getComponent(this._transformID).getOrigin()},n.prototype.getPosition=function(){if(this.constructor.NO_DEFAULT_COMPONENTS){if(this.isMounted())return o.get(this.getLocation()).getPosition();throw new Error("This node does not have access to a transform component")}return this.getComponent(this._transformID).getPosition()},n.prototype.getRotation=function(){if(this.constructor.NO_DEFAULT_COMPONENTS){if(this.isMounted())return o.get(this.getLocation()).getRotation();throw new Error("This node does not have access to a transform component")}return this.getComponent(this._transformID).getRotation()},n.prototype.getScale=function(){if(this.constructor.NO_DEFAULT_COMPONENTS){if(this.isMounted())return o.get(this.getLocation()).getScale();throw new Error("This node does not have access to a transform component")}return this.getComponent(this._transformID).getScale()},n.prototype.getSizeMode=function(){if(this.constructor.NO_DEFAULT_COMPONENTS){if(this.isMounted())return s.get(this.getLocation()).getSizeMode();throw new Error("This node does not have access to a size component")}return this.getComponent(this._sizeID).getSizeMode()},n.prototype.getProportionalSize=function(){if(this.constructor.NO_DEFAULT_COMPONENTS){if(this.isMounted())return s.get(this.getLocation()).getProportional();throw new Error("This node does not have access to a size component")}return this.getComponent(this._sizeID).getProportional()},n.prototype.getDifferentialSize=function(){if(this.constructor.NO_DEFAULT_COMPONENTS){if(this.isMounted())return s.get(this.getLocation()).getDifferential();throw new Error("This node does not have access to a size component")}return this.getComponent(this._sizeID).getDifferential()},n.prototype.getAbsoluteSize=function(){if(this.constructor.NO_DEFAULT_COMPONENTS){if(this.isMounted())return s.get(this.getLocation()).getAbsolute();throw new Error("This node does not have access to a size component")}return this.getComponent(this._sizeID).getAbsolute()},n.prototype.getRenderSize=function(){if(this.constructor.NO_DEFAULT_COMPONENTS){if(this.isMounted())return s.get(this.getLocation()).getRender();throw new Error("This node does not have access to a size component")}return this.getComponent(this._sizeID).getRender()},n.prototype.getSize=function(){if(this.constructor.NO_DEFAULT_COMPONENTS){if(this.isMounted())return s.get(this.getLocation()).get();throw new Error("This node does not have access to a size component")}return this.getComponent(this._sizeID).get()},n.prototype.getTransform=function(){return o.get(this.getLocation())},n.prototype.getUIEvents=function(){return this._UIEvents},n.prototype.addChild=function(t){var e=t?this._children.indexOf(t):-1;return t=t?t:new n,-1===e&&(e=this._freedChildIndicies.length?this._freedChildIndicies.pop():this._children.length,this._children[e]=t,this._fullChildren.push(t)),this.isMounted()&&t.mount(this.getLocation()+"/"+e),t},n.prototype.removeChild=function(t){var e=this._children.indexOf(t);if(e>-1){this._freedChildIndicies.push(e),this._children[e]=null,t.isMounted()&&t.dismount();var i=this._fullChildren.indexOf(t),n=this._fullChildren.length,s=0;for(s=i;n-1>s;s++)this._fullChildren[s]=this._fullChildren[s+1];return this._fullChildren.pop(),!0}return!1},n.prototype.addComponent=function(t){var e=this._components.indexOf(t);return-1===e&&(e=this._freedComponentIndicies.length?this._freedComponentIndicies.pop():this._components.length,this._components[e]=t,this.isMounted()&&t.onMount&&t.onMount(this,e),this.isShown()&&t.onShow&&t.onShow()),e},n.prototype.getComponent=function(t){return this._components[t]},n.prototype.removeComponent=function(t){var e=this._components.indexOf(t);return-1!==e&&(this._freedComponentIndicies.push(e),this.isShown()&&t.onHide&&t.onHide(),this.isMounted()&&t.onDismount&&t.onDismount(),this._components[e]=null),t},n.prototype.removeUIEvent=function(t){var e,i=this.getUIEvents(),n=this._components,s=i.indexOf(t);if(-1!==s){i.splice(s,1);for(var r=0,o=n.length;o>r;r++)e=n[r],e&&e.onRemoveUIEvent&&e.onRemoveUIEvent(t)}},n.prototype.addUIEvent=function(t){var e,i=this.getUIEvents(),n=this._components,s=-1!==i.indexOf(t);if(!s){i.push(t);for(var r=0,o=n.length;o>r;r++)e=n[r],e&&e.onAddUIEvent&&e.onAddUIEvent(t)}return this},n.prototype._requestUpdate=function(t){(t||!this._requestingUpdate)&&(this._updater&&this._updater.requestUpdate(this),this._requestingUpdate=!0)},n.prototype._vecOptionalSet=function(t,e,i){return null!=i&&t[e]!==i?(t[e]=i,this._requestingUpdate||this._requestUpdate(),!0):!1},n.prototype.show=function(){return r.show(this.getLocation()),this._shown=!0,this},n.prototype.hide=function(){return r.hide(this.getLocation()),this._shown=!1,this},n.prototype.setAlign=function(t,e,i){if(this.constructor.NO_DEFAULT_COMPONENTS){if(!this.isMounted())throw new Error("This node does not have access to a transform component");o.get(this.getLocation()).setAlign(t,e,i)}else this.getComponent(this._transformID).setAlign(t,e,i);return this},n.prototype.setMountPoint=function(t,e,i){if(this.constructor.NO_DEFAULT_COMPONENTS){if(!this.isMounted())throw new Error("This node does not have access to a transform component");o.get(this.getLocation()).setMountPoint(t,e,i)}else this.getComponent(this._transformID).setMountPoint(t,e,i);return this},n.prototype.setOrigin=function(t,e,i){if(this.constructor.NO_DEFAULT_COMPONENTS){if(!this.isMounted())throw new Error("This node does not have access to a transform component");o.get(this.getLocation()).setOrigin(t,e,i)}else this.getComponent(this._transformID).setOrigin(t,e,i);return this},n.prototype.setPosition=function(t,e,i){if(this.constructor.NO_DEFAULT_COMPONENTS){if(!this.isMounted())throw new Error("This node does not have access to a transform component");o.get(this.getLocation()).setPosition(t,e,i)}else this.getComponent(this._transformID).setPosition(t,e,i);return this},n.prototype.setRotation=function(t,e,i,n){if(this.constructor.NO_DEFAULT_COMPONENTS){if(!this.isMounted())throw new Error("This node does not have access to a transform component");o.get(this.getLocation()).setRotation(t,e,i,n)}else this.getComponent(this._transformID).setRotation(t,e,i,n);return this},n.prototype.setScale=function(t,e,i){if(this.constructor.NO_DEFAULT_COMPONENTS){if(!this.isMounted())throw new Error("This node does not have access to a transform component");o.get(this.getLocation()).setScale(t,e,i)}else this.getComponent(this._transformID).setScale(t,e,i);return this},n.prototype.setOpacity=function(t){if(t!==this._opacity){this._opacity=t,this._requestingUpdate||this._requestUpdate();for(var e,i=0,n=this._components,s=n.length;s>i;i++)e=n[i],e&&e.onOpacityChange&&e.onOpacityChange(t)}return this},n.prototype.setSizeMode=function(t,e,i){if(this.constructor.NO_DEFAULT_COMPONENTS){if(!this.isMounted())throw new Error("This node does not have access to a size component");s.get(this.getLocation()).setSizeMode(t,e,i)}else this.getComponent(this._sizeID).setSizeMode(t,e,i);return this},n.prototype.setProportionalSize=function(t,e,i){if(this.constructor.NO_DEFAULT_COMPONENTS){if(!this.isMounted())throw new Error("This node does not have access to a size component");s.get(this.getLocation()).setProportional(t,e,i)}else this.getComponent(this._sizeID).setProportional(t,e,i);return this},n.prototype.setDifferentialSize=function(t,e,i){if(this.constructor.NO_DEFAULT_COMPONENTS){if(!this.isMounted())throw new Error("This node does not have access to a size component");s.get(this.getLocation()).setDifferential(t,e,i)}else this.getComponent(this._sizeID).setDifferential(t,e,i);return this},n.prototype.setAbsoluteSize=function(t,e,i){if(this.constructor.NO_DEFAULT_COMPONENTS){if(!this.isMounted())throw new Error("This node does not have access to a size component");s.get(this.getLocation()).setAbsolute(t,e,i)}else this.getComponent(this._sizeID).setAbsolute(t,e,i);return this},n.prototype.getFrame=function(){return this._updater.getFrame()},n.prototype.getComponents=function(){return this._components},n.prototype.update=function(t){this._inUpdate=!0;for(var e,i=this._nextUpdateQueue,n=this._updateQueue;i.length;)n.unshift(i.pop());for(;n.length;)e=this._components[n.shift()],e&&e.onUpdate&&e.onUpdate(t);return this._inUpdate=!1,this._requestingUpdate=!1,this.isMounted()?this._nextUpdateQueue.length&&(this._updater.requestUpdateOnNextTick(this),this._requestingUpdate=!0):(this._parent=null,this._id=null),this},n.prototype.mount=function(t){if(this.isMounted())throw new Error("Node is already mounted at: "+this.getLocation());return this.constructor.NO_DEFAULT_COMPONENTS?(o.registerTransformAtPath(t),s.registerSizeAtPath(t)):(o.registerTransformAtPath(t,this.getComponent(this._transformID)),s.registerSizeAtPath(t,this.getComponent(this._sizeID))),r.mount(t,this),this._requestingUpdate||this._requestUpdate(),this},n.prototype.dismount=function(){if(!this.isMounted())throw new Error("Node is not mounted");var t=this.getLocation();o.deregisterTransformAtPath(t),s.deregisterSizeAtPath(t),r.dismount(t),this._requestingUpdate||this._requestUpdate()},t.exports=n},function(t,e,i){"use strict";function n(t,e){if(!t)throw new Error("Scene needs to be created with a DOM selector");if(!e)throw new Error("Scene needs to be created with a class like Famous");s.call(this),this._globalUpdater=e,this._selector=t,this.mount(t),this._globalUpdater.message(o.NEED_SIZE_FOR).message(t),this.show()}var s=i(31),r=i(8),o=i(5),a=i(12),h=i(14);n.prototype=Object.create(s.prototype),n.prototype.constructor=n,n.NO_DEFAULT_COMPONENTS=!0,n.prototype.getUpdater=function(){return this._updater},n.prototype.getSelector=function(){return this._selector},n.prototype.getDispatch=function(){return console.warn("Scene#getDispatch is deprecated, require the dispatch directly"),r},n.prototype.onReceive=function(t,e){if("CONTEXT_RESIZE"===t){if(e.length<2)throw new Error("CONTEXT_RESIZE's payload needs to be at least a pair of pixel sizes");this.setSizeMode("absolute","absolute","absolute"),this.setAbsoluteSize(e[0],e[1],e[2]?e[2]:0),this._updater.message(o.WITH).message(this._selector).message(o.READY)}},n.prototype.mount=function(t){if(this.isMounted())throw new Error("Scene is already mounted at: "+this.getLocation());r.mount(t,this),this._id=t,this._mounted=!0,this._parent=this,a.registerTransformAtPath(t),h.registerSizeAtPath(t)},t.exports=n},function(t,e,i){"use strict";function n(t,e){this.node=t,this.id=t.addComponent(this),this._events=new h,this.last1=new u,this.last2=new u,this.delta1=new u,this.delta2=new u,this.velocity1=new u,this.velocity2=new u,this.dist=0,this.diff12=new u,this.center=new u,this.centerDelta=new u,this.centerVelocity=new u,this.pointer1={position:this.last1,delta:this.delta1,velocity:this.velocity1},this.pointer2={position:this.last2,delta:this.delta2,velocity:this.velocity2},this.event={status:null,time:0,pointers:[],center:this.center,centerDelta:this.centerDelta,centerVelocity:this.centerVelocity,points:0,current:0},this.trackedPointerIDs=[-1,-1],this.timeOfPointer=0,this.multiTap=0,this.mice=[],this.gestures=[],this.options={},this.trackedGestures={};var i,n;if(e)for(i=0,n=e.length;n>i;i++)this.on(e[i],e[i].callback);t.addUIEvent("touchstart"),t.addUIEvent("mousedown"),t.addUIEvent("touchmove"),t.addUIEvent("mousemove"),t.addUIEvent("touchend"),t.addUIEvent("mouseup"),t.addUIEvent("mouseleave")}function s(t){var e;if(t.targetTouches?e=t.targetTouches:(this.mice[0]=t,e=this.mice,t.identifier=1),!e[0]||!e[1]||this.trackedPointerIDs[0]!==e[0].identifier||this.trackedPointerIDs[1]!==e[1].identifier){this.event.time=Date.now();var i,n;this.trackedPointerIDs[0]!==e[0].identifier&&(this.trackedGestures.tap&&(i=this.options.tap&&this.options.tap.threshold||250,this.event.time-this.timeOfPointer<i?this.event.taps++:this.event.taps=1,this.timeOfPointer=this.event.time,this.multiTap=1),this.event.current=1,this.event.points=1,n=e[0].identifier,this.trackedPointerIDs[0]=n,this.last1.set(e[0].pageX,e[0].pageY),this.velocity1.clear(),this.delta1.clear(),this.event.pointers.push(this.pointer1)),e[1]&&this.trackedPointerIDs[1]!==e[1].identifier&&(this.trackedGestures.tap&&(i=this.options.tap&&this.options.tap.threshold||250,this.event.time-this.timeOfPointer<i&&(this.multiTap=2)),this.event.current=2,this.event.points=2,n=e[1].identifier,this.trackedPointerIDs[1]=n,this.last2.set(e[1].pageX,e[1].pageY),this.velocity2.clear(),this.delta2.clear(),u.add(this.last1,this.last2,this.center).scale(.5),this.centerDelta.clear(),this.centerVelocity.clear(),u.subtract(this.last2,this.last1,this.diff12),this.dist=this.diff12.length(),this.trackedGestures.pinch&&(this.event.scale=this.event.scale||1,this.event.scaleDelta=0,this.event.scaleVelocity=0),this.trackedGestures.rotate&&(this.event.rotation=this.event.rotation||0,this.event.rotationDelta=0,this.event.rotationVelocity=0),this.event.pointers.push(this.pointer2)),this.event.status="start",1===this.event.points&&(this.center.copy(this.last1),this.centerDelta.clear(),this.centerVelocity.clear(),this.trackedGestures.pinch&&(this.event.scale=1,this.event.scaleDelta=0,this.event.scaleVelocity=0),this.trackedGestures.rotate&&(this.event.rotation=0,this.event.rotationDelta=0,this.event.rotationVelocity=0)),this.triggerGestures()}}function r(t){var e;if(t.targetTouches)e=t.targetTouches;else{if(!this.event.current)return;this.mice[0]=t,e=this.mice,t.identifier=1}var i=Date.now(),n=i-this.event.time;if(0!==n){var s=1e3/n;if(this.event.time=i,this.event.current=1,this.event.points=1,this.trackedPointerIDs[0]===e[0].identifier&&(c.set(e[0].pageX,e[0].pageY),u.subtract(c,this.last1,this.delta1),u.scale(this.delta1,s,this.velocity1),this.last1.copy(c)),e[1]){if(this.event.current=2,this.event.points=2,c.set(e[1].pageX,e[1].pageY),u.subtract(c,this.last2,this.delta2),u.scale(this.delta2,s,this.velocity2),this.last2.copy(c),u.add(this.last1,this.last2,c).scale(.5),u.subtract(c,this.center,this.centerDelta),u.add(this.velocity1,this.velocity2,this.centerVelocity).scale(.5),this.center.copy(c),u.subtract(this.last2,this.last1,c),this.trackedGestures.rotate){var r=c.dot(this.diff12),o=c.cross(this.diff12),a=-Math.atan2(o,r);this.event.rotation+=a,this.event.rotationDelta=a,this.event.rotationVelocity=a*s}var h=c.length(),p=h/this.dist;this.diff12.copy(c),this.dist=h,this.trackedGestures.pinch&&(this.event.scale*=p,p-=1,this.event.scaleDelta=p,this.event.scaleVelocity=p*s)}this.event.status="move",1===this.event.points&&(this.center.copy(this.last1),this.centerDelta.copy(this.delta1),this.centerVelocity.copy(this.velocity1),this.trackedGestures.pinch&&(this.event.scale=1,this.event.scaleDelta=0,this.event.scaleVelocity=0),this.trackedGestures.rotate&&(this.event.rotation=0,this.event.rotationDelta=0,this.event.rotationVelocity=0)),this.triggerGestures()}}function o(t){var e;if(t.targetTouches)e=t.targetTouches;else{if(!this.event.current)return;this.mice.pop(),e=this.mice}if(!e[0]||!e[1]||this.trackedPointerIDs[0]!==e[0].identifier||this.trackedPointerIDs[1]!==e[1].identifier){var i;if(this.event.status="end",!e[0])return this.event.current=0,this.trackedPointerIDs[0]=-1,this.trackedPointerIDs[1]=-1,this.triggerGestures(),this.event.pointers.pop(),void this.event.pointers.pop();this.trackedPointerIDs[0]!==e[0].identifier&&(this.trackedPointerIDs[0]=-1,i=e[0].identifier,this.trackedPointerIDs[0]=i,this.last1.set(e[0].pageX,e[0].pageY),this.velocity1.clear(),this.delta1.clear()),e[1]?this.trackedPointerIDs[1]!==e[1].identifier&&(this.trackedPointerIDs[1]=-1,this.event.points=2,i=e[1].identifier,this.trackedPointerIDs[1]=i,this.last2.set(e[1].pageX,e[1].pageY),this.velocity2.clear(),this.delta2.clear(),u.add(this.last1,this.last2,this.center).scale(.5),this.centerDelta.clear(),this.centerVelocity.clear(),u.subtract(this.last2,this.last1,this.diff12),this.dist=this.diff12.length()):(this.event.current=1,this.trackedPointerIDs[1]=-1,this.triggerGestures(),this.event.points=1,this.event.pointers.pop())}}function a(){this.event.current&&(this.event.status="end",this.event.current=0,this.trackedPointerIDs[0]=-1,this.triggerGestures(),this.event.pointers.pop())}var h=i(11),u=i(20),c=new u,p={drag:!0,tap:!0,rotate:!0,pinch:!0};n.prototype.onReceive=function(t,e){switch(t){case"touchstart":case"mousedown":s.call(this,e);break;case"touchmove":case"mousemove":r.call(this,e);break;case"touchend":case"mouseup":o.call(this,e);break;case"mouseleave":a.call(this,e)}},n.prototype.toString=function(){return"GestureHandler"},n.prototype.on=function(t,e){var i=t.event||t;p[i]&&(this.trackedGestures[i]=!0,this.gestures.push(i),t.event&&(this.options[i]=t),this._events.on(i,e))},n.prototype.triggerGestures=function(){for(var t=this.event,e=0,i=this.gestures.length;i>e;e++){var n=this.gestures[e];switch(n){case"rotate":case"pinch":2===t.points&&this.trigger(n,t);break;case"tap":if("start"===t.status)if(this.options.tap){var s=this.options.tap.points||1;this.multiTap>=s&&t.points>=s&&this.trigger(n,t)}else this.trigger(n,t);break;default:this.trigger(n,t)}}},n.prototype.trigger=function(t,e){this._events.trigger(t,e)},t.exports=n},function(t,e,i){"use strict";function n(t,e){if(!t)throw new Error("DOMElement must be instantiated on a node");if(this._changeQueue=[],this._requestingUpdate=!1,this._renderSized=!1,this._requestRenderSize=!1,this._UIEvents=t.getUIEvents().slice(0),this._classes=["famous-dom-element"],this._requestingEventListeners=[],this._styles={},this._attributes={},this._content="",this._tagName=e&&e.tagName?e.tagName:"div",this._renderSize=[0,0,0],this._node=t,t&&t.addComponent(this),this._callbacks=new s,this.setProperty("display",t.isShown()?"block":"none"),this.onOpacityChange(t.getOpacity()),e){var i,n;if(e.classes)for(i=0;i<e.classes.length;i++)this.addClass(e.classes[i]);if(e.attributes)for(n in e.attributes)this.setAttribute(n,e.attributes[n]);if(e.properties)for(n in e.properties)this.setProperty(n,e.properties[n]);e.id&&this.setId(e.id),e.content&&this.setContent(e.content),e.cutout===!1&&this.setCutoutState(e.cutout)}}var s=i(11),r=i(12),o=i(5),a=i(15);n.prototype.getValue=function(){return{classes:this._classes,styles:this._styles,attributes:this._attributes,content:this._content,id:this._attributes.id,tagName:this._tagName}},n.prototype.onUpdate=function(){var t=this._node,e=this._changeQueue,i=e.length;if(i&&t){for(t.sendDrawCommand(o.WITH),t.sendDrawCommand(t.getLocation());i--;)t.sendDrawCommand(e.shift());this._requestRenderSize&&(t.sendDrawCommand(o.DOM_RENDER_SIZE),t.sendDrawCommand(t.getLocation()),this._requestRenderSize=!1)}this._requestingUpdate=!1},n.prototype.onMount=function(t,e){this._node=t,this._id=e,this._UIEvents=t.getUIEvents().slice(0),r.makeBreakPointAt(t.getLocation()),this.onSizeModeChange.apply(this,t.getSizeMode()),this.draw(),this.setAttribute("data-fa-path",t.getLocation())},n.prototype.onDismount=function(){this.setProperty("display","none"),this.setAttribute("data-fa-path",""),this.setCutoutState(!1),this.onUpdate(),this._initialized=!1},n.prototype.onShow=function(){this.setProperty("display","block")},n.prototype.onHide=function(){this.setProperty("display","none")},n.prototype.setCutoutState=function(t){return this._initialized&&this._changeQueue.push(o.GL_CUTOUT_STATE,t),this._requestingUpdate||this._requestUpdate(),this},n.prototype.onTransformChange=function(t){this._changeQueue.push(o.CHANGE_TRANSFORM),t=t.getLocalTransform();for(var e=0,i=t.length;i>e;e++)this._changeQueue.push(t[e]);this._requestingUpdate||this._requestUpdate()},n.prototype.onSizeChange=function(t,e){var i=this._node.getSizeMode(),n=i[0]!==a.RENDER,s=i[1]!==a.RENDER;return this._initialized&&this._changeQueue.push(o.CHANGE_SIZE,n?t:n,s?e:s),this._requestingUpdate||this._requestUpdate(),this},n.prototype.onOpacityChange=function(t){return this.setProperty("opacity",t)},n.prototype.onAddUIEvent=function(t){return-1===this._UIEvents.indexOf(t)?(this._subscribe(t),this._UIEvents.push(t)):this._inDraw&&this._subscribe(t),this},n.prototype.onRemoveUIEvent=function(t){var e=this._UIEvents.indexOf(t);return-1!==e?(this._unsubscribe(t),this._UIEvents.splice(e,1)):this._inDraw&&this._unsubscribe(t),this},n.prototype._subscribe=function(t){this._initialized&&this._changeQueue.push(o.SUBSCRIBE,t),this._requestingUpdate||this._requestUpdate()},n.prototype.preventDefault=function(t){this._initialized&&this._changeQueue.push(o.PREVENT_DEFAULT,t),this._requestingUpdate||this._requestUpdate()},n.prototype.allowDefault=function(t){this._initialized&&this._changeQueue.push(o.ALLOW_DEFAULT,t),this._requestingUpdate||this._requestUpdate()},n.prototype._unsubscribe=function(t){this._initialized&&this._changeQueue.push(o.UNSUBSCRIBE,t),this._requestingUpdate||this._requestUpdate()},n.prototype.onSizeModeChange=function(t,e,i){(t===a.RENDER||e===a.RENDER||i===a.RENDER)&&(this._renderSized=!0,this._requestRenderSize=!0);var n=this._node.getSize();this.onSizeChange(n[0],n[1])},n.prototype.getRenderSize=function(){return this._renderSize},n.prototype._requestUpdate=function(){!this._requestingUpdate&&this._id&&(this._node.requestUpdate(this._id),this._requestingUpdate=!0)},n.prototype.init=function(){this._changeQueue.push(o.INIT_DOM,this._tagName),this._initialized=!0,this.onTransformChange(r.get(this._node.getLocation()));var t=this._node.getSize();this.onSizeChange(t[0],t[1]),this._requestingUpdate||this._requestUpdate()},n.prototype.setId=function(t){
return this.setAttribute("id",t),this},n.prototype.addClass=function(t){return this._classes.indexOf(t)<0?(this._initialized&&this._changeQueue.push(o.ADD_CLASS,t),this._classes.push(t),this._requestingUpdate||this._requestUpdate(),this._renderSized&&(this._requestRenderSize=!0),this):(this._inDraw&&(this._initialized&&this._changeQueue.push(o.ADD_CLASS,t),this._requestingUpdate||this._requestUpdate()),this)},n.prototype.removeClass=function(t){var e=this._classes.indexOf(t);return 0>e?this:(this._changeQueue.push(o.REMOVE_CLASS,t),this._classes.splice(e,1),this._requestingUpdate||this._requestUpdate(),this)},n.prototype.hasClass=function(t){return-1!==this._classes.indexOf(t)},n.prototype.setAttribute=function(t,e){return(this._attributes[t]!==e||this._inDraw)&&(this._attributes[t]=e,this._initialized&&this._changeQueue.push(o.CHANGE_ATTRIBUTE,t,e),this._requestUpdate||this._requestUpdate()),this},n.prototype.setProperty=function(t,e){return(this._styles[t]!==e||this._inDraw)&&(this._styles[t]=e,this._initialized&&this._changeQueue.push(o.CHANGE_PROPERTY,t,e),this._requestingUpdate||this._requestUpdate(),this._renderSized&&(this._requestRenderSize=!0)),this},n.prototype.setContent=function(t){return(this._content!==t||this._inDraw)&&(this._content=t,this._initialized&&this._changeQueue.push(o.CHANGE_CONTENT,t),this._requestingUpdate||this._requestUpdate(),this._renderSized&&(this._requestRenderSize=!0)),this},n.prototype.on=function(t,e){return this._callbacks.on(t,e)},n.prototype.onReceive=function(t,e){"resize"===t&&(this._renderSize[0]=e.val[0],this._renderSize[1]=e.val[1],this._requestingUpdate||this._requestUpdate()),this._callbacks.trigger(t,e)},n.prototype.draw=function(){var t,e,i;for(this._inDraw=!0,this.init(),e=0,i=this._classes.length;i>e;e++)this.addClass(this._classes[e]);this._content&&this.setContent(this._content);for(t in this._styles)null!=this._styles[t]&&this.setProperty(t,this._styles[t]);for(t in this._attributes)null!=this._attributes[t]&&this.setAttribute(t,this._attributes[t]);for(e=0,i=this._UIEvents.length;i>e;e++)this.onAddUIEvent(this._UIEvents[e]);this._inDraw=!1},t.exports=n},function(t,e,i){"use strict";function n(t,e,i){var n=this;t.classList.add("famous-dom-renderer"),p=p||h("transform"),this._compositor=i,this._target=null,this._parent=null,this._path=null,this._children=[],this._insertElCallbackStore=new u,this._removeElCallbackStore=new u,this._root=new r(t,e),this._boundTriggerEvent=function(t){return n._triggerEvent(t)},this._selector=e,this._elements={},this._elements[e]=this._root,this.perspectiveTransform=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this._VPtransform=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this._lastEv=null}function s(t){for(var e=[],i=t.target;i!==document.body;)e.push(i),i=i.parentNode;return e}var r=i(36),o=i(37),a=i(9),h=i(74),u=i(11),c=i(40),p=null;n.prototype.subscribe=function(t){this._assertTargetLoaded(),this._listen(t),this._target.subscribe[t]=!0},n.prototype.preventDefault=function(t){this._assertTargetLoaded(),this._listen(t),this._target.preventDefault[t]=!0},n.prototype.allowDefault=function(t){this._assertTargetLoaded(),this._listen(t),this._target.preventDefault[t]=!1},n.prototype._listen=function(t){if(this._assertTargetLoaded(),!this._target.listeners[t]&&!this._root.listeners[t]){var e=c[t][1]?this._root:this._target;e.listeners[t]=this._boundTriggerEvent,e.element.addEventListener(t,this._boundTriggerEvent)}},n.prototype.unsubscribe=function(t){this._assertTargetLoaded(),this._target.subscribe[t]=!1},n.prototype._triggerEvent=function(t){if(this._lastEv!==t)for(var e=t.path?t.path:s(t),i=0;i<e.length;i++)if(e[i].dataset){var n=e[i].dataset.faPath;if(n&&(this._elements[n].preventDefault[t.type]&&t.preventDefault(),this._elements[n]&&this._elements[n].subscribe[t.type])){this._lastEv=t;var r=c[t.type][0];this._compositor.sendEvent(n,t.type,new r(t));break}}},n.prototype.getSizeOf=function(t){var e=this._elements[t];if(!e)return null;var i={val:e.size};return this._compositor.sendEvent(t,"resize",i),i},n.prototype.draw=function(t){t.perspectiveDirty&&(this.perspectiveDirty=!0,this.perspectiveTransform[0]=t.perspectiveTransform[0],this.perspectiveTransform[1]=t.perspectiveTransform[1],this.perspectiveTransform[2]=t.perspectiveTransform[2],this.perspectiveTransform[3]=t.perspectiveTransform[3],this.perspectiveTransform[4]=t.perspectiveTransform[4],this.perspectiveTransform[5]=t.perspectiveTransform[5],this.perspectiveTransform[6]=t.perspectiveTransform[6],this.perspectiveTransform[7]=t.perspectiveTransform[7],this.perspectiveTransform[8]=t.perspectiveTransform[8],this.perspectiveTransform[9]=t.perspectiveTransform[9],this.perspectiveTransform[10]=t.perspectiveTransform[10],this.perspectiveTransform[11]=t.perspectiveTransform[11],this.perspectiveTransform[12]=t.perspectiveTransform[12],this.perspectiveTransform[13]=t.perspectiveTransform[13],this.perspectiveTransform[14]=t.perspectiveTransform[14],this.perspectiveTransform[15]=t.perspectiveTransform[15]),(t.viewDirty||t.perspectiveDirty)&&(o.multiply(this._VPtransform,this.perspectiveTransform,t.viewTransform),this._root.element.style[p]=this._stringifyMatrix(this._VPtransform))},n.prototype._assertPathLoaded=function(){if(!this._path)throw new Error("path not loaded")},n.prototype._assertParentLoaded=function(){if(!this._parent)throw new Error("parent not loaded")},n.prototype._assertChildrenLoaded=function(){if(!this._children)throw new Error("children not loaded")},n.prototype._assertTargetLoaded=function(){if(!this._target)throw new Error("No target loaded")},n.prototype.findParent=function(){this._assertPathLoaded();for(var t,e=this._path;!t&&e.length;)e=e.substring(0,e.lastIndexOf("/")),t=this._elements[e];return this._parent=t,t},n.prototype.findTarget=function(){return this._target=this._elements[this._path],this._target},n.prototype.loadPath=function(t){return this._path=t,this._target=this._elements[this._path],this._path},n.prototype.resolveChildren=function(t,e){for(var i,n,s=0,r=this._path;i=e.childNodes[s];)i.dataset?(n=i.dataset.faPath,n&&a.isDescendentOf(n,r)?t.appendChild(i):s++):s++},n.prototype.insertEl=function(t){if(this.findParent(),this._assertParentLoaded(),this._parent["void"])throw new Error(this._parent.path+" is a void element. Void elements are not allowed to have children.");this._target||(this._target=new r(document.createElement(t),this._path));var e=this._target.element,i=this._parent.element;this.resolveChildren(e,i),i.appendChild(e),this._elements[this._path]=this._target,this._insertElCallbackStore.trigger(this._path,this._target)},n.prototype.setProperty=function(t,e){this._assertTargetLoaded(),this._target.element.style[t]=e},n.prototype.setSize=function(t,e){this._assertTargetLoaded(),this.setWidth(t),this.setHeight(e)},n.prototype.setWidth=function(t){this._assertTargetLoaded();var e=this._target.content;t===!1?(this._target.explicitWidth=!0,e&&(e.style.width=""),t=e?e.offsetWidth:0,this._target.element.style.width=t+"px"):(this._target.explicitWidth=!1,e&&(e.style.width=t+"px"),this._target.element.style.width=t+"px"),this._target.size[0]=t},n.prototype.setHeight=function(t){this._assertTargetLoaded();var e=this._target.content;t===!1?(this._target.explicitHeight=!0,e&&(e.style.height=""),t=e?e.offsetHeight:0,this._target.element.style.height=t+"px"):(this._target.explicitHeight=!1,e&&(e.style.height=t+"px"),this._target.element.style.height=t+"px"),this._target.size[1]=t},n.prototype.setAttribute=function(t,e){this._assertTargetLoaded(),this._target.element.setAttribute(t,e)},n.prototype.setContent=function(t){this._assertTargetLoaded(),this._target.formElement?this._target.element.value=t:(this._target.content||(this._target.content=document.createElement("div"),this._target.content.classList.add("famous-dom-element-content"),this._target.element.insertBefore(this._target.content,this._target.element.firstChild)),this._target.content.innerHTML=t),this.setSize(this._target.explicitWidth?!1:this._target.size[0],this._target.explicitHeight?!1:this._target.size[1])},n.prototype.setMatrix=function(t){this._assertTargetLoaded(),this._target.element.style[p]=this._stringifyMatrix(t)},n.prototype.addClass=function(t){this._assertTargetLoaded(),this._target.element.classList.add(t)},n.prototype.removeClass=function(t){this._assertTargetLoaded(),this._target.element.classList.remove(t)},n.prototype._stringifyMatrix=function(t){var e="matrix3d(";return e+=t[0]<1e-6&&t[0]>-1e-6?"0,":t[0]+",",e+=t[1]<1e-6&&t[1]>-1e-6?"0,":t[1]+",",e+=t[2]<1e-6&&t[2]>-1e-6?"0,":t[2]+",",e+=t[3]<1e-6&&t[3]>-1e-6?"0,":t[3]+",",e+=t[4]<1e-6&&t[4]>-1e-6?"0,":t[4]+",",e+=t[5]<1e-6&&t[5]>-1e-6?"0,":t[5]+",",e+=t[6]<1e-6&&t[6]>-1e-6?"0,":t[6]+",",e+=t[7]<1e-6&&t[7]>-1e-6?"0,":t[7]+",",e+=t[8]<1e-6&&t[8]>-1e-6?"0,":t[8]+",",e+=t[9]<1e-6&&t[9]>-1e-6?"0,":t[9]+",",e+=t[10]<1e-6&&t[10]>-1e-6?"0,":t[10]+",",e+=t[11]<1e-6&&t[11]>-1e-6?"0,":t[11]+",",e+=t[12]<1e-6&&t[12]>-1e-6?"0,":t[12]+",",e+=t[13]<1e-6&&t[13]>-1e-6?"0,":t[13]+",",e+=t[14]<1e-6&&t[14]>-1e-6?"0,":t[14]+",",e+=t[15]+")"},n.prototype.onInsertEl=function(t,e){return this._insertElCallbackStore.on(t,e),this},n.prototype.offInsertEl=function(t,e){return this._insertElCallbackStore.off(t,e),this},n.prototype.onRemoveEl=function(t,e){return this._removeElCallbackStore.on(t,e),this},n.prototype.offRemoveEl=function(t,e){return this._removeElCallbackStore.off(t,e),this},t.exports=n},function(t,e,i){"use strict";function n(t,e){this.tagName=t.tagName.toLowerCase(),this["void"]=s[this.tagName];var i=t.constructor;this.formElement=i===HTMLInputElement||i===HTMLTextAreaElement||i===HTMLSelectElement,this.element=t,this.path=e,this.content=null,this.size=new Int16Array(3),this.explicitHeight=!1,this.explicitWidth=!1,this.postRenderSize=new Float32Array(2),this.listeners={},this.preventDefault={},this.subscribe={}}var s=i(38);t.exports=n},function(t,e){"use strict";function i(t,e){var i=e[0],n=e[1],s=e[2],r=e[3],o=e[4],a=e[5],h=e[6],u=e[7],c=e[8],p=e[9],l=e[10],d=e[11],f=e[12],_=e[13],g=e[14],y=e[15],v=i*a-n*o,m=i*h-s*o,w=i*u-r*o,x=n*h-s*a,E=n*u-r*a,C=s*u-r*h,I=c*_-p*f,T=c*g-l*f,b=c*y-d*f,z=p*g-l*_,S=p*y-d*_,M=l*y-d*g,R=v*M-m*S+w*z+x*b-E*T+C*I;return R?(R=1/R,t[0]=(a*M-h*S+u*z)*R,t[1]=(s*S-n*M-r*z)*R,t[2]=(_*C-g*E+y*x)*R,t[3]=(l*E-p*C-d*x)*R,t[4]=(h*b-o*M-u*T)*R,t[5]=(i*M-s*b+r*T)*R,t[6]=(g*w-f*C-y*m)*R,t[7]=(c*C-l*w+d*m)*R,t[8]=(o*S-a*b+u*I)*R,t[9]=(n*b-i*S-r*I)*R,t[10]=(f*E-_*w+y*v)*R,t[11]=(p*w-c*E-d*v)*R,t[12]=(a*T-o*z-h*I)*R,t[13]=(i*z-n*T+s*I)*R,t[14]=(_*m-f*x-g*v)*R,t[15]=(c*x-p*m+l*v)*R,t):null}function n(t,e,i){var n,s,r,o,a=e[0],h=e[1],u=e[2],c=e[3],p=e[4],l=e[5],d=e[6],f=e[7],_=e[8],g=e[9],y=e[10],v=e[11],m=e[12],w=e[13],x=e[14],E=e[15],C=i[0],I=i[1],T=i[2],b=i[3],z=i[4],S=i[5],M=i[6],R=i[7],A=i[8],O=i[9],D=i[10],L=i[11],P=i[12],N=i[13],U=i[14],G=i[15],k=!1;return n=C*a+I*p+T*_+b*m,s=C*h+I*l+T*g+b*w,r=C*u+I*d+T*y+b*x,o=C*c+I*f+T*v+b*E,k=k?k:n===t[0]||s===t[1]||r===t[2]||o===t[3],t[0]=n,t[1]=s,t[2]=r,t[3]=o,C=z,I=S,T=M,b=R,n=C*a+I*p+T*_+b*m,s=C*h+I*l+T*g+b*w,r=C*u+I*d+T*y+b*x,o=C*c+I*f+T*v+b*E,k=k?k:n===t[4]||s===t[5]||r===t[6]||o===t[7],t[4]=n,t[5]=s,t[6]=r,t[7]=o,C=A,I=O,T=D,b=L,n=C*a+I*p+T*_+b*m,s=C*h+I*l+T*g+b*w,r=C*u+I*d+T*y+b*x,o=C*c+I*f+T*v+b*E,k=k?k:n===t[8]||s===t[9]||r===t[10]||o===t[11],t[8]=n,t[9]=s,t[10]=r,t[11]=o,C=P,I=N,T=U,b=G,n=C*a+I*p+T*_+b*m,s=C*h+I*l+T*g+b*w,r=C*u+I*d+T*y+b*x,o=C*c+I*f+T*v+b*E,k=k?k:n===t[12]||s===t[13]||r===t[14]||o===t[15],t[12]=n,t[13]=s,t[14]=r,t[15]=o,t}t.exports={multiply:n,invert:i}},function(t,e){"use strict";var i={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0};t.exports=i},function(t,e,i){"use strict";function n(t){s.call(this,t),this.data=t.data}var s=i(6);n.prototype=Object.create(s.prototype),n.prototype.constructor=n,n.prototype.toString=function(){return"CompositionEvent"},t.exports=n},function(t,e,i){"use strict";var n=i(39),s=i(18),r=i(41),o=i(42),a=i(43),h=i(19),u=i(44),c=i(6),p=i(45),l={change:[s,!0],submit:[s,!0],abort:[s,!1],beforeinput:[o,!0],blur:[r,!1],click:[h,!0],compositionend:[n,!0],compositionstart:[n,!0],compositionupdate:[n,!0],dblclick:[h,!0],focus:[r,!1],focusin:[r,!0],focusout:[r,!0],input:[o,!0],keydown:[a,!0],keyup:[a,!0],load:[s,!1],mousedown:[h,!0],mouseenter:[h,!1],mouseleave:[h,!1],mousemove:[h,!1],mouseout:[h,!0],mouseover:[h,!0],mouseup:[h,!0],contextMenu:[h,!0],resize:[c,!1],scroll:[c,!1],select:[s,!0],unload:[s,!1],wheel:[p,!0],touchcancel:[u,!0],touchend:[u,!0],touchmove:[u,!0],touchstart:[u,!0]};t.exports=l},function(t,e,i){"use strict";function n(t){s.call(this,t)}var s=i(6);n.prototype=Object.create(s.prototype),n.prototype.constructor=n,n.prototype.toString=function(){return"FocusEvent"},t.exports=n},function(t,e,i){"use strict";function n(t){s.call(this,t),this.inputType=t.inputType,this.data=t.data,this.isComposing=t.isComposing,this.targetRange=t.targetRange}var s=i(6);n.prototype=Object.create(s.prototype),n.prototype.constructor=n,n.prototype.toString=function(){return"InputEvent"},t.exports=n},function(t,e,i){"use strict";function n(t){s.call(this,t),this.DOM_KEY_LOCATION_STANDARD=0,this.DOM_KEY_LOCATION_LEFT=1,this.DOM_KEY_LOCATION_RIGHT=2,this.DOM_KEY_LOCATION_NUMPAD=3,this.key=t.key,this.code=t.code,this.location=t.location,this.ctrlKey=t.ctrlKey,this.shiftKey=t.shiftKey,this.altKey=t.altKey,this.metaKey=t.metaKey,this.repeat=t.repeat,this.isComposing=t.isComposing,this.keyCode=t.keyCode}var s=i(6);n.prototype=Object.create(s.prototype),n.prototype.constructor=n,n.prototype.toString=function(){return"KeyboardEvent"},t.exports=n},function(t,e,i){"use strict";function n(t){this.identifier=t.identifier,this.screenX=t.screenX,this.screenY=t.screenY,this.clientX=t.clientX,this.clientY=t.clientY,this.pageX=t.pageX,this.pageY=t.pageY}function s(t){if(!t)return a;for(var e=[],i=0;i<t.length;i++)e[i]=new n(t[i]);return e}function r(t){o.call(this,t),this.touches=s(t.touches),this.targetTouches=s(t.targetTouches),this.changedTouches=s(t.changedTouches),this.altKey=t.altKey,this.metaKey=t.metaKey,this.ctrlKey=t.ctrlKey,this.shiftKey=t.shiftKey}var o=i(6),a=[];r.prototype=Object.create(o.prototype),r.prototype.constructor=r,r.prototype.toString=function(){return"TouchEvent"},t.exports=r},function(t,e,i){"use strict";function n(t){s.call(this,t),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2,this.deltaX=t.deltaX,this.deltaY=t.deltaY,this.deltaZ=t.deltaZ,this.deltaMode=t.deltaMode}var s=i(19);n.prototype=Object.create(s.prototype),n.prototype.constructor=n,n.prototype.toString=function(){return"WheelEvent"},t.exports=n},function(t,e,i){t.exports={Mat33:i(3),Quaternion:i(7),Vec2:i(20),Vec3:i(1)}},function(t,e,i){"use strict";function n(t){o.call(this,t),this.normals=[new s(0,1,0),new s(1,0,0),new s(0,0,1)],this.type=2}var s=i(1),r=i(22),o=r([new s(-100,-100,-100),new s(100,-100,-100),new s(-100,-100,100),new s(100,-100,100),new s(-100,100,-100),new s(100,100,-100),new s(-100,100,100),new s(100,100,100)]);n.prototype=Object.create(o.prototype),n.prototype.constructor=n,t.exports=n},function(t,e,i){"use strict";function n(t){s.call(this,t);var e=t.radius||1;this.radius=e,this.size=[2*e,2*e,2*e],this.updateLocalInertia(),this.inverseInertia.copy(this.localInverseInertia);var i=t.angularVelocity;i&&this.setAngularVelocity(i.x,i.y,i.z),this.type=4}var s=i(10),r=i(1),o=new r;n.prototype=Object.create(s.prototype),n.prototype.constructor=n,n.prototype.getRadius=function(){return this.radius},n.prototype.setRadius=function(t){return this.radius=t,this.size=[2*this.radius,2*this.radius,2*this.radius],this},n.prototype.updateLocalInertia=function(){var t=this.mass,e=this.radius,i=t*e*e;this.localInertia.set([.4*i,0,0,0,.4*i,0,0,0,.4*i]),this.localInverseInertia.set([2.5/i,0,0,0,2.5/i,0,0,0,2.5/i])},n.prototype.support=function(t){return r.scale(t,this.radius,o)},t.exports=n},function(t,e,i){"use strict";function n(t){s.call(this,t);var e=this.normal=new r,i=this.direction=t.direction;switch(i){case n.DOWN:e.set(0,1,0);break;case n.UP:e.set(0,-1,0);break;case n.LEFT:e.set(-1,0,0);break;case n.RIGHT:e.set(1,0,0);break;case n.FORWARD:e.set(0,0,-1);break;case n.BACKWARD:e.set(0,0,1)}this.invNormal=r.clone(e,new r).invert(),this.mass=1/0,this.inverseMass=0,this.type=8}var s=i(10),r=i(1);n.DOWN=0,n.UP=1,n.LEFT=2,n.RIGHT=3,n.FORWARD=4,n.BACKWARD=5,n.prototype=Object.create(s.prototype),n.prototype.constructor=n,t.exports=n},function(t,e,i){"use strict";function n(t,e,i){this.a=t,this.b=e,s.call(this,i),this.effectiveInertia=new o,this.angularImpulse=new r,this.error=0}var s=i(2),r=i(1),o=i(3),a=new r;n.prototype=Object.create(s.prototype),n.prototype.constructor=n,n.prototype.init=function(){this.cosAngle=this.cosAngle||this.a.orientation.dot(this.b.orientation)},n.prototype.update=function(){var t=this.a,e=this.b,i=t.orientation,n=e.orientation,s=i.dot(n),r=2*(s-this.cosAngle);this.error=r;var a=this.angularImpulse;e.applyAngularImpulse(a),t.applyAngularImpulse(a.invert()),o.add(t.inverseInertia,e.inverseInertia,this.effectiveInertia),this.effectiveInertia.inverse(),a.clear()},n.prototype.resolve=function(){var t=this.a,e=this.b,i=a,n=t.angularVelocity,s=e.angularVelocity;r.subtract(n,s,i),i.scale(1+this.error);var o=i.applyMatrix(this.effectiveInertia);e.applyAngularImpulse(o),t.applyAngularImpulse(o.invert()),o.invert(),this.angularImpulse.add(o)},t.exports=n},function(t,e,i){"use strict";function n(t,e,i){this.a=t,this.b=e,s.call(this,i),this.impulse=new r,this.angImpulseA=new r,this.angImpulseB=new r,this.error=new r,this.effMassMatrix=new o}var s=i(2),r=i(1),o=i(3),a=i(7),h=new r,u=new r,c=new r,p=new r,l=new r;n.prototype=Object.create(s.prototype),n.prototype.constructor=n,n.prototype.init=function(){var t=this.anchor,e=this.a,i=this.b,n=a.conjugate(e.orientation,new a),s=a.conjugate(i.orientation,new a);this.rA=r.subtract(t,e.position,new r),this.rB=r.subtract(t,i.position,new r),this.bodyRA=n.rotateVector(this.rA,new r),this.bodyRB=s.rotateVector(this.rB,new r)},n.prototype.update=function(t,e){var i=this.a,n=this.b,s=i.orientation.rotateVector(this.bodyRA,this.rA),a=n.orientation.rotateVector(this.bodyRB,this.rB),h=new o([0,s.z,-s.y,-s.z,0,s.x,s.y,-s.x,0]),c=new o([0,a.z,-a.y,-a.z,0,a.x,a.y,-a.x,0]),p=o.multiply(h,i.inverseInertia,new o).multiply(h.transpose()),l=o.multiply(c,n.inverseInertia,new o).multiply(c.transpose()),d=o.add(p,l,p),f=r.add(i.position,this.rA,this.anchor),_=r.add(n.position,this.rB,u);r.subtract(_,f,this.error),this.error.scale(.2/e);var g=i.inverseMass,y=n.inverseMass,v=new o([g+y,0,0,0,g+y,0,0,0,g+y]);o.add(d,v,this.effMassMatrix),this.effMassMatrix.inverse();var m=this.impulse,w=this.angImpulseA,x=this.angImpulseB;n.applyImpulse(m),n.applyAngularImpulse(x),m.invert(),i.applyImpulse(m),i.applyAngularImpulse(w),m.clear(),w.clear(),x.clear()},n.prototype.resolve=function(){var t=this.a,e=this.b,i=this.rA,n=this.rB,s=r.add(t.velocity,r.cross(t.angularVelocity,i,l),c),o=r.add(e.velocity,r.cross(e.angularVelocity,n,l),p),a=s.subtract(o).subtract(this.error).applyMatrix(this.effMassMatrix),d=r.cross(n,a,h),f=r.cross(i,a,u).invert();e.applyImpulse(a),e.applyAngularImpulse(d),a.invert(),t.applyImpulse(a),t.applyAngularImpulse(f),a.invert(),this.impulse.add(a),this.angImpulseA.add(f),this.angImpulseB.add(d)},t.exports=n},function(t,e,i){"use strict";function n(t,e,i){return e>t?e:t>i?i:t}function s(t,e,i,n,s,r){this.penetration=t,this.normal=e,this.worldContactA=i,this.worldContactB=n,this.localContactA=s,this.localContactB=r}function r(t,e){this.targets=[],t&&(this.targets=this.targets.concat(t)),p.call(this,e)}function o(t,e,i){var n=e.position,s=i.position,r=c.subtract(s,n,new c),o=r.length(),a=e.radius+i.radius,h=r.scale(1/o),u=a-o;if(!(0>u)){var p=c.scale(h,e.radius,new c),l=c.scale(h,-i.radius,new c),d=c.add(n,p,new c),f=c.add(s,l,new c),_=m().reset(u,h,d,f,p,l);t.contactManifoldTable.registerContact(e,i,_)}}function a(t,e,i){if(e.type===C){var s=i;i=e,e=s}var r=e.position,o=i.position,a=c.subtract(o,r,w),h=e.orientation,u=i.radius,p=e.size,l=.5*p[0],d=.5*p[1],f=.5*p[2],_=e.normals,g=h.rotateVector(_[1],new c),y=h.rotateVector(_[0],new c),v=h.rotateVector(_[2],new c),x=new c;x.x=n(c.dot(a,g),-l,l),x.y=n(c.dot(a,y),-d,d),x.z=n(c.dot(a,v),-f,f),x.applyRotation(h);var E=c.add(r,x,new c),I=c.subtract(E,o,E),T=I.length(),b=u-T;if(!(0>b)){var z=c.scale(I,-1/T,new c),S=x,M=I,R=c.add(r,S,new c),A=c.add(o,M,new c),O=m().reset(b,z,R,A,S,M);t.contactManifoldTable.registerContact(e,i,O)}}function h(t,e,i){var n=_(e,i);if(n){var s=g(e,i,n);null!==s&&t.contactManifoldTable.registerContact(e,i,s)}}function u(t,e,i){if(e.type===I){var n=i;i=e,e=n}var s=e.position,r=i.position,o=i.normal,a=i.invNormal,h=e.support(a),u=c.add(s,h,new c),p=c.subtract(u,r,w),l=c.dot(p,a);if(!(0>l)){var d=c.scale(o,l,new c).add(u),f=c.subtract(d,i.position,new c),_=m().reset(l,a,u,d,h,f);t.contactManifoldTable.registerContact(e,i,_)}}var c=i(1),p=i(2),l=i(60),d=i(57),f=i(59),_=f.gjk,g=f.epa,y=i(58),v=i(13);v.register("CollisionData",s);var m=v.requestCollisionData,w=new c;s.prototype.reset=function(t,e,i,n,s,r){return this.penetration=t,this.normal=e,this.worldContactA=i,this.worldContactB=n,this.localContactA=s,this.localContactB=r,this},r.prototype=Object.create(p.prototype),r.prototype.constructor=r,r.prototype.init=function(){if(this.broadPhase){var t=this.broadphase;t instanceof Function&&(this.broadPhase=new t(this.targets))}else this.broadPhase=new l(this.targets);this.contactManifoldTable=this.contactManifoldTable||new y},r.prototype.update=function(t,e){if(this.contactManifoldTable.update(e),0!==this.targets.length){var i,n;for(i=0,n=this.targets.length;n>i;i++)this.targets[i].updateShape();var s,r=this.broadPhase.update();for(i=0,n=r.length;n>i;i++)s=r[i],s&&this.applyNarrowPhase(s);this.contactManifoldTable.prepContacts(e)}},r.prototype.resolve=function(t,e){this.contactManifoldTable.resolveManifolds(e)},r.prototype.addTarget=function(t){this.targets.push(t),this.broadPhase.add(t)},r.prototype.removeTarget=function(t){var e=this.targets.indexOf(t);0>e||(this.targets.splice(e,1),this.broadPhase.remove(t))};var x=1,E=2,C=4,I=8,T=x|x,b=E|E,z=E|x,S=C|C,M=E|C,R=x|C,A=x|I,O=E|I,D=C|I,L={};L[T]=h,L[b]=h,L[z]=h,L[R]=h,L[S]=o,L[M]=a,L[A]=u,L[O]=u,L[D]=u,r.prototype.applyNarrowPhase=function(t){for(var e=0,i=t.length;i>e;e++)for(var n=e+1;i>n;n++){var s=t[e],r=t[n];if(0!==(s.collisionMask&r.collisionGroup&&s.collisionGroup&r.collisionMask)){var o=s.type|r.type;L[o]&&L[o](this,s,r)}}},r.SweepAndPrune=l,r.BruteForce=d.BruteForce,r.BruteForceAABB=d.BruteForceAABB,t.exports=r},function(t,e,i){"use strict";function n(t,e){t?t instanceof Array?this.targets=t:this.targets=[t]:this.targets=[],s.call(this,e),this.impulses={},this.normals={},this.velocityBiases={},this.divisors={}}var s=i(2),r=i(1),o=new r,a=new r,h=1e-7,u=Math.PI;n.prototype=Object.create(s.prototype),n.prototype.constructor=n,n.prototype.init=function(){this.equation1=this.equation1||function(){return 0},this.equation2=this.equation2||function(t,e,i){return i},this.period=this.period||1,this.dampingRatio=this.dampingRatio||.5,this.stiffness=4*u*u/(this.period*this.period),this.damping=4*u*this.dampingRatio/this.period},n.prototype.update=function(t,e){for(var i=this.targets,n=this.normals,s=this.velocityBiases,u=this.divisors,c=this.impulses,p=o,l=a,d=this.equation1,f=this.equation2,_=this.damping,g=this.stiffness,y=0,v=i.length;v>y;y++){var m=i[y],w=m._ID;if(!m.immune){var x,E,C=m.position,I=m.mass;if(0===this.period)x=0,E=1;else{var T=_*I,b=g*I;x=1/(e*(T+e*b)),E=e*b/(T+e*b)}var z=C.x,S=C.y,M=C.z,R=d(z,S,M),A=(d(z+h,S,M)-R)/h,O=(d(z,S+h,M)-R)/h,D=(d(z,S,M+h)-R)/h,L=f(z,S,M),P=(f(z+h,S,M)-L)/h,N=(f(z,S+h,M)-L)/h,U=(f(z,S,M+h)-L)/h;l.set(A+P,O+N,D+U),l.normalize();var G=E*(R+L)/e,k=x+1/I,F=c[w]||0;r.scale(l,F,p),m.applyImpulse(p),n[w]=n[w]||new r,n[w].copy(l),s[w]=G,u[w]=k,c[w]=0}}},n.prototype.resolve=function(){for(var t=this.targets,e=this.normals,i=this.velocityBiases,n=this.divisors,s=this.impulses,a=o,h=0,u=t.length;u>h;h++){var c=t[h],p=c._ID;if(!c.immune){var l=c.velocity,d=e[p],f=-(r.dot(d,l)+i[p])/n[p];r.scale(d,f,a),c.applyImpulse(a),s[p]+=f}}},t.exports=n},function(t,e,i){"use strict";function n(t,e,i){this.a=t,this.b=e,s.call(this,i),this.impulse=0,this.distance=0,this.normal=new r,this.velocityBias=0,this.divisor=0}var s=i(2),r=i(1),o=new r,a=new r,h=new r,u=new r,c=new r,p=Math.PI;n.prototype=Object.create(s.prototype),n.prototype.constructor=n,n.prototype.init=function(){this.direction=this.direction||r.subtract(this.b.position,this.a.position,new r),this.direction.normalize(),this.minLength=this.minLength||0,this.period=this.period||.2,this.dampingRatio=this.dampingRatio||.5,this.stiffness=4*p*p/(this.period*this.period),this.damping=4*p*this.dampingRatio/this.period},n.prototype.update=function(t,e){var i=this.a,n=this.b,s=o,h=u,p=a,l=c,d=i.position,f=i.inverseMass,_=n.position,g=n.inverseMass,y=this.direction;r.subtract(_,d,h),r.scale(y,r.dot(y,h),l);var v=l.add(d);r.subtract(_,v,s);var m=s.length();s.normalize();var w,x,E=f+g,C=1/E;if(0===this.period)w=0,x=1;else{var I=this.damping*C,T=this.stiffness*C;w=1/(e*(I+e*T)),x=e*T/(I+e*T)}var b=x*m/e,z=w+E,S=this.impulse;r.scale(s,S,p),n.applyImpulse(p),i.applyImpulse(p.invert()),this.normal.copy(s),this.distance=m,this.velocityBias=b,this.divisor=z,this.impulse=0},n.prototype.resolve=function(){var t=this.a,e=this.b,i=a,n=h,s=this.minLength,o=this.distance;if(!(Math.abs(o)<s)){var u=t.velocity,c=e.velocity,p=this.normal;r.subtract(c,u,n);var l=-(r.dot(p,n)+this.velocityBias)/this.divisor;r.scale(p,l,i),e.applyImpulse(i),t.applyImpulse(i.invert()),this.impulse+=l}},t.exports=n},function(t,e,i){"use strict";function n(t,e,i){this.a=t,this.b=e,s.call(this,i),this.impulse=0,this.distance=0,this.normal=new r,this.velocityBias=0,this.divisor=0}var s=i(2),r=i(1),o=new r,a=new r,h=new r,u=new r,c=Math.PI;n.prototype=Object.create(s.prototype),n.prototype.constructor=n,n.prototype.init=function(){this.length=this.length||r.subtract(this.b.position,this.a.position,u).length(),this.minLength=this.minLength||0,this.period=this.period||.2,this.dampingRatio=this.dampingRatio||.5,this.stiffness=4*c*c/(this.period*this.period),this.damping=4*c*this.dampingRatio/this.period},n.prototype.update=function(t,e){var i=this.a,n=this.b,s=o,h=u,c=a,p=this.length,l=i.position,d=i.inverseMass,f=n.position,_=n.inverseMass;r.subtract(f,l,h);var g=h.length();r.scale(h,1/g,s);var y,v,m=g-p,w=d+_,x=1/w;if(0===this.period)y=0,v=1;else{var E=this.damping*x,C=this.stiffness*x;y=1/(e*(E+e*C)),v=e*C/(E+e*C)}var I=v*m/e,T=y+w,b=this.impulse;r.scale(s,b,c),n.applyImpulse(c),i.applyImpulse(c.invert()),this.normal.copy(s),this.distance=m,this.velocityBias=I,this.divisor=T,this.impulse=0},n.prototype.resolve=function(){var t=this.a,e=this.b,i=a,n=h,s=this.minLength,o=this.distance;if(!(Math.abs(o)<s)){var u=t.getVelocity(),c=e.getVelocity(),p=this.normal;r.subtract(c,u,n);var l=-(r.dot(p,n)+this.velocityBias)/this.divisor;r.scale(p,l,i),e.applyImpulse(i),t.applyImpulse(i.invert()),this.impulse+=l}},t.exports=n},function(t,e,i){"use strict";function n(t,e,i){this.a=t,this.b=e,s.call(this,i),this.impulse=new r,this.angImpulseA=new r,this.angImpulseB=new r,this.error=new r,this.errorRot=[0,0],this.effMassMatrix=new o,this.effMassMatrixRot=[]}var s=i(2),r=i(1),o=i(3),a=i(7),h=new r,u=new r,c=new r,p=new r,l=new r,d=new r,f=new r,_=new r;n.prototype=Object.create(s.prototype),n.prototype.constructor=n,n.prototype.init=function(){var t=this.anchor,e=this.axis.normalize(),i=this.a,n=this.b,s=a.conjugate(i.orientation,new a),o=a.conjugate(n.orientation,new a);this.rA=r.subtract(t,i.position,new r),this.rB=r.subtract(t,n.position,new r),this.bodyRA=s.rotateVector(this.rA,new r),this.bodyRB=o.rotateVector(this.rB,new r),this.axisA=r.clone(e),this.axisB=r.clone(e),this.axisBTangent1=new r,this.axisBTangent2=new r,this.t1xA=new r,this.t2xA=new r,this.bodyAxisA=s.rotateVector(e,new r),this.bodyAxisB=o.rotateVector(e,new r)},n.prototype.update=function(t,e){var i=this.a,n=this.b,s=i.orientation.rotateVector(this.bodyAxisA,this.axisA),a=n.orientation.rotateVector(this.bodyAxisB,this.axisB);this.axis.copy(a);var l=a,d=this.axisBTangent1,f=this.axisBTangent2;l.x>=.57735?d.set(l.y,-l.x,0):d.set(0,l.z,-l.y),d.normalize(),r.cross(l,d,f);var _=r.cross(d,s,this.t1xA),g=r.cross(f,s,this.t2xA),y=i.orientation.rotateVector(this.bodyRA,this.rA),v=n.orientation.rotateVector(this.bodyRB,this.rB),m=new o([0,y.z,-y.y,-y.z,0,y.x,y.y,-y.x,0]),w=new o([0,v.z,-v.y,-v.z,0,v.x,v.y,-v.x,0]),x=o.multiply(m,i.inverseInertia,new o).multiply(m.transpose()),E=o.multiply(w,n.inverseInertia,new o).multiply(w.transpose()),C=o.add(x,E,x),I=r.add(i.position,this.rA,this.anchor),T=r.add(n.position,this.rB,h),b=1/e;r.subtract(T,I,this.error),this.error.scale(.2*b);var z=i.inverseMass,S=n.inverseMass,M=new o([z+S,0,0,0,z+S,0,0,0,z+S]);o.add(C,M,this.effMassMatrix),this.effMassMatrix.inverse();var R=i.inverseInertia.vectorMultiply(_,h),A=i.inverseInertia.vectorMultiply(g,u),O=n.inverseInertia.vectorMultiply(_,c),D=n.inverseInertia.vectorMultiply(g,p),L=r.dot(_,R)+r.dot(_,O),P=r.dot(_,A)+r.dot(_,D),N=r.dot(g,R)+r.dot(g,O),U=r.dot(g,A)+r.dot(g,D),G=1/(L*U-P*N);this.effMassMatrixRot[0]=U*G,this.effMassMatrixRot[1]=-N*G,this.effMassMatrixRot[2]=-P*G,this.effMassMatrixRot[3]=L*G,this.errorRot[0]=.2*r.dot(s,d)*b,this.errorRot[1]=.2*r.dot(s,f)*b;var k=this.impulse.scale(.5),F=this.angImpulseA.scale(.5),V=this.angImpulseB.scale(.5);n.applyImpulse(k),n.applyAngularImpulse(V),k.invert(),i.applyImpulse(k),i.applyAngularImpulse(F),k.clear(),F.clear(),V.clear()},n.prototype.resolve=function(){var t=this.a,e=this.b,i=this.rA,n=this.rB,s=this.t1xA,o=this.t2xA,a=t.angularVelocity,g=e.angularVelocity,y=r.add(t.velocity,r.cross(a,i,f),l),v=r.add(e.velocity,r.cross(g,n,f),d),m=y.subtract(v).subtract(this.error).applyMatrix(this.effMassMatrix),w=r.subtract(g,a,_),x=this.errorRot,E=r.dot(s,w)+x[0],C=r.dot(o,w)+x[1],I=this.effMassMatrixRot,T=-(I[0]*E+I[1]*C),b=-(I[2]*E+I[3]*C),z=r.scale(s,T,u).add(r.scale(o,b,c)),S=r.cross(n,m,h).add(z),M=r.cross(i,m,p).invert().subtract(z);e.applyImpulse(m),e.applyAngularImpulse(S),m.invert(),t.applyImpulse(m),t.applyAngularImpulse(M),m.invert(),this.impulse.add(m),this.angImpulseA.add(M),this.angImpulseB.add(S)},t.exports=n},function(t,e,i){"use strict";function n(t){this._volumes=[],this._entityRegistry={};for(var e=0;e<t.length;e++)this.add(t[e])}function s(t){this.targets=t}var r=i(23);n.prototype.add=function(t){var e=new r(t);this._entityRegistry[t._ID]=t,this._volumes.push(e)},n.prototype.update=function(){for(var t=this._volumes,e=this._entityRegistry,i=0,n=t.length;n>i;i++)t[i].update();for(var s=[],o=0,a=t.length;a>o;o++)for(var h=o+1;a>h;h++)r.checkOverlap(t[o],t[h])&&s.push([e[o],e[h]]);return s},s.prototype.add=function(t){this.targets.push(t)},s.prototype.update=function(){return[this.targets]},t.exports.BruteForceAABB=n,t.exports.BruteForce=s},function(t,e,i){"use strict";function n(t,e,i){return e>t?e:t>i?i:t}function s(){this.manifolds=[],this.collisionMatrix={},this._IDPool=[]}function r(t,e,i,n){this.lowID=t,this.highID=e,this.contacts=[],this.numContacts=0,this.bodyA=i,this.bodyB=n,this.lru=0}function o(t,e,i){this.bodyA=t,this.bodyB=e,this.data=i,this.normalImpulse=0,this.tangentImpulse1=0,this.tangentImpulse2=0,this.impulse=new a,this.angImpulseA=new a,this.angImpulseB=new a,i&&this.init()}var a=i(1),h=i(13);h.register("Manifold",r),h.register("Contact",o);var u=h.requestManifold,c=h.requestContact,p=h.freeManifold,l=h.freeContact,d=new a,f=new a,_=new a,g=new a,y=new a,v=new a,m=new a,w=new a,x=new a,E=new a,C=new a,I=new a,T=new a,b=new a,z=new a;s.prototype.addManifold=function(t,e,i,n){var s=this.collisionMatrix;s[t]=s[t]||{};var r=this._IDPool.length?this._IDPool.pop():this.manifolds.length;this.collisionMatrix[t][e]=r;var o=u().reset(t,e,i,n);return this.manifolds[r]=o,
o},s.prototype.removeManifold=function(t,e){var i=this.collisionMatrix;this.manifolds[e]=null,i[t.lowID][t.highID]=null,this._IDPool.push(e),p(t)},s.prototype.update=function(t){for(var e=this.manifolds,i=0,n=e.length;n>i;i++){var s=e[i];if(s){var r=s.update(t);r||(this.removeManifold(s,i),s.bodyA.events.trigger("collision:end",s),s.bodyB.events.trigger("collision:end",s))}}},s.prototype.prepContacts=function(t){for(var e=this.manifolds,i=0,n=e.length;n>i;i++){var s=e[i];if(s)for(var r=s.contacts,o=0,a=r.length;a>o;o++){var h=r[o];h&&h.update(t)}}},s.prototype.resolveManifolds=function(){for(var t=this.manifolds,e=0,i=t.length;i>e;e++){var n=t[e];n&&n.resolveContacts()}},s.prototype.registerContact=function(t,e,i){var n,s;t._ID<e._ID?(n=t._ID,s=e._ID):(n=e._ID,s=t._ID);var r,o=this.manifolds,a=this.collisionMatrix;a[n]&&null!=a[n][s]?(r=o[a[n][s]],r.contains(i),r.addContact(t,e,i)):(r=this.addManifold(n,s,t,e),r.addContact(t,e,i),t.events.trigger("collision:start",r),e.events.trigger("collision:start",r))};var S=10;r.prototype.reset=function(t,e,i,n){return this.lowID=t,this.highID=e,this.contacts=[],this.numContacts=0,this.bodyA=i,this.bodyB=n,this.lru=0,this},r.prototype.addContact=function(t,e,i){var n=this.lru;this.contacts[n]&&this.removeContact(this.contacts[n],n),this.contacts[n]=c().reset(t,e,i),this.lru=(this.lru+1)%4,this.numContacts++},r.prototype.removeContact=function(t,e){this.contacts[e]=null,this.numContacts--,h.freeCollisionData(t.data),t.data=null,l(t)},r.prototype.contains=function(t){for(var e=t.worldContactA,i=t.worldContactB,n=this.contacts,s=0,r=n.length;r>s;s++){var o=n[s];if(o){var h=o.data,u=a.subtract(h.worldContactA,e,b).length(),c=a.subtract(h.worldContactB,i,z).length();if(S>u||S>c)return this.removeContact(o,s),!0}}return!1},r.prototype.update=function(){for(var t=this.contacts,e=this.bodyA,i=this.bodyB,n=e.position,s=i.position,r=0,o=t.length;o>r;r++){var h=t[r];if(h){var u=h.data,c=u.normal,p=u.localContactA,l=u.localContactB,d=u.worldContactA,f=u.worldContactB,_=a.add(n,p,C),g=a.add(s,l,I),y=a.dot(a.subtract(g,_,T),c)>0,v=a.subtract(d,_,b),m=a.subtract(f,g,z);(v.length()>=S||m.length()>=S||y)&&this.removeContact(h,r)}}return this.numContacts?!0:!1},r.prototype.resolveContacts=function(){for(var t=this.contacts,e=0,i=t.length;i>e;e++)t[e]&&t[e].resolve()},o.prototype.reset=function(t,e,i){return this.bodyA=t,this.bodyB=e,this.data=i,this.normalImpulse=0,this.tangentImpulse1=0,this.tangentImpulse2=0,this.impulse.clear(),this.angImpulseA.clear(),this.angImpulseB.clear(),this.init(),this},o.prototype.init=function(){var t=this.data,e=t.normal,i=new a;e.x>=.57735?i.set(e.y,-e.x,0):i.set(0,e.z,-e.y),i.normalize();var n=a.cross(e,i,new a);this.tangent1=i,this.tangent2=n;var s=this.bodyA,r=this.bodyB,o=t.localContactA,h=t.localContactB,u=s.inverseMass+r.inverseMass,c=a.cross(o,e,v),p=a.cross(h,e,m);this.effNormalMass=1/(u+a.dot(c,s.inverseInertia.vectorMultiply(c,d))+a.dot(p,r.inverseInertia.vectorMultiply(p,d)));var l=a.cross(o,i,v),f=a.cross(h,i,m);this.effTangentialMass1=1/(u+a.dot(l,s.inverseInertia.vectorMultiply(l,d))+a.dot(f,r.inverseInertia.vectorMultiply(f,d)));var _=a.cross(o,n,v),g=a.cross(h,n,m);this.effTangentialMass2=1/(u+a.dot(_,s.inverseInertia.vectorMultiply(_,d))+a.dot(g,r.inverseInertia.vectorMultiply(g,d))),this.restitution=Math.min(s.restitution,r.restitution),this.friction=s.friction*r.friction},o.prototype.update=function(t){var e=this.data,i=this.bodyA,n=this.bodyB,s=e.localContactA,r=e.localContactB,o=e.normal,h=a.add(i.velocity,a.cross(i.angularVelocity,s,y),_),u=a.add(n.velocity,a.cross(n.angularVelocity,r,y),g),c=u.subtract(h),p=a.dot(c,o),l=.15,d=1.5,f=20,v=Math.abs(p)<f?0:this.restitution;this.velocityBias=-l*Math.max(e.penetration-d,0)/t,this.velocityBias+=v*p;var m=this.impulse.scale(.25),w=this.angImpulseA.scale(.25),x=this.angImpulseB.scale(.25);n.applyImpulse(m),n.applyAngularImpulse(x),m.invert(),i.applyImpulse(m),i.applyAngularImpulse(w),this.normalImpulse=0,this.tangentImpulse1=0,this.tangentImpulse2=0,m.clear(),w.clear(),x.clear()},o.prototype.resolve=function(){var t=this.data,e=this.bodyA,i=this.bodyB,s=t.localContactA,r=t.localContactB,o=t.normal,h=this.tangent1,u=this.tangent2,c=a.add(e.velocity,a.cross(e.angularVelocity,s,y),_),p=a.add(i.velocity,a.cross(i.angularVelocity,r,y),g),l=p.subtract(c),v=-(a.dot(l,o)+this.velocityBias)*this.effNormalMass,m=Math.max(this.normalImpulse+v,0);v=m-this.normalImpulse;var C=this.friction*m,I=-a.dot(l,h)*this.effTangentialMass1,T=n(this.tangentImpulse1+I,-C,C);I=T-this.tangentImpulse1;var b=-a.dot(l,u)*this.effTangentialMass2,z=n(this.tangentImpulse2+b,-C,C);b=z-this.tangentImpulse2;var S=a.scale(o,v,w),M=a.scale(h,I,x),R=a.scale(u,b,E);S.add(M).add(R);var A=a.cross(r,S,d),O=a.cross(s,S,f).invert();i.applyImpulse(S),i.applyAngularImpulse(A),S.invert(),e.applyImpulse(S),e.applyAngularImpulse(O),this.normalImpulse=m,this.tangentImpulse1=T,this.tangentImpulse2=z,this.impulse.add(S),this.angImpulseA.add(O),this.angImpulseB.add(A)},t.exports=s},function(t,e,i){"use strict";function n(t,e,i){this.vertex=t,this.worldVertexA=e,this.worldVertexB=i}function s(t){var e,i=t.vertices;for(e=i.length;e--;){var n=i.pop();null!==n&&l(n)}t.numVertices=0;var s=t.features;for(e=s.length;e--;){var r=s.pop();null!==r&&f(r)}t.numFeatures=0,d(t)}function r(t,e,i){var n=h.scale(i,-1,w),s=h.add(t.support(i),t.position,new h),r=h.add(e.support(n),e.position,new h);return c().reset(h.subtract(s,r,new h),s,r)}function o(t,e){var i=r,n=h.subtract(e.position,t.position,m).normalize(),o=p();o.addVertex(i(t,e,n)),n.invert();for(var a=0,u=1e3;a++<u&&(0!==n.x||0!==n.y||0!==n.z)&&(o.addVertex(i(t,e,n)),!(h.dot(o.getLastVertex().vertex,n)<0));)if(o.simplexContainsOrigin(n,l))return o;return s(o),!1}function a(t,e,i){for(var n=r,o=1/0,a=0,c=1e3;a++<c;){var p=i.getFeatureClosestToOrigin();if(null===p)return null;var d=p.normal,f=n(t,e,d);if(o=Math.min(o,h.dot(f.vertex,d)),o-p.distance<=.01){var m=i.vertices[p.vertexIndices[0]],w=i.vertices[p.vertexIndices[1]],x=i.vertices[p.vertexIndices[2]],E=m.vertex,C=w.vertex,I=x.vertex,T=h.scale(d,p.distance,_),b=h.subtract(C,E,g),z=h.subtract(I,E,y),S=h.subtract(T,E,v),M=h.dot(b,b),R=h.dot(b,z),A=h.dot(z,z),O=h.dot(S,b),D=h.dot(S,z),L=M*A-R*R,P=(A*O-R*D)/L,N=(M*D-R*O)/L,U=1-P-N,G=m.worldVertexA.scale(U).add(w.worldVertexA.scale(P)).add(x.worldVertexA.scale(N)),k=m.worldVertexB.scale(U).add(w.worldVertexB.scale(P)).add(x.worldVertexB.scale(N)),F=h.subtract(G,t.position,new h),V=h.subtract(k,e.position,new h);return s(i),l(f),u.requestCollisionData().reset(p.distance,d,G,k,F,V)}i.addVertex(f),i.reshape()}throw new Error("EPA failed to terminate in allotted iterations.")}var h=i(1),u=i(13);u.register("GJK_EPASupportPoint",n);var c=u.requestGJK_EPASupportPoint,p=u.requestDynamicGeometry,l=u.freeGJK_EPASupportPoint,d=u.freeDynamicGeometry,f=u.freeDynamicGeometryFeature,_=new h,g=new h,y=new h,v=new h,m=new h,w=new h;n.prototype.reset=function(t,e,i){return this.vertex=t,this.worldVertexA=e,this.worldVertexB=i,this},t.exports.gjk=o,t.exports.epa=a},function(t,e,i){"use strict";function n(t){this._sweepVolumes=[],this._entityRegistry={},this._boundingVolumeRegistry={},this.endpoints={x:[],y:[],z:[]},this.overlaps=[],this.overlapsMatrix={},this._IDPool=[],t=t||[];for(var e=0;e<t.length;e++)this.add(t[e])}function s(t){this._boundingVolume=t,this._ID=t._ID,this.points={x:[{_ID:t._ID,side:0,value:null},{_ID:t._ID,side:1,value:null}],y:[{_ID:t._ID,side:0,value:null},{_ID:t._ID,side:1,value:null}],z:[{_ID:t._ID,side:0,value:null},{_ID:t._ID,side:1,value:null}]},this.update()}var r=i(23),o=["x","y","z"];n.prototype.add=function(t){var e=new r(t),i=new s(e);this._entityRegistry[t._ID]=t,this._boundingVolumeRegistry[t._ID]=e,this._sweepVolumes.push(i);for(var n=0;3>n;n++){var a=o[n];this.endpoints[a].push(i.points[a][0]),this.endpoints[a].push(i.points[a][1])}},n.prototype.remove=function(t){this._entityRegistry[t._ID]=null,this._boundingVolumeRegistry[t._ID]=null;var e,i,n;for(e=0,i=this._sweepVolumes.length;i>e;e++)if(this._sweepVolumes[e]._ID===t._ID){n=e;break}this._sweepVolumes.splice(n,1);var s,r=this.endpoints,o=[];for(e=0,i=r.x.length;i>e;e++)s=r.x[e],s._ID!==t._ID&&o.push(s);var a=[];for(e=0,i=r.y.length;i>e;e++)s=r.y[e],s._ID!==t._ID&&a.push(s);var h=[];for(e=0,i=r.z.length;i>e;e++)s=r.z[e],s._ID!==t._ID&&h.push(s);r.x=o,r.y=a,r.z=h},n.prototype.update=function(){var t,e,i,n,s=this._sweepVolumes,a=this._entityRegistry,h=this._boundingVolumeRegistry;for(e=0,n=s.length;n>e;e++)s[e].update();var u=this.endpoints,c=this.overlaps,p=this.overlapsMatrix,l=this._IDPool;for(i=0;3>i;i++){var d=o[i],f=u[d];for(e=1,n=f.length;n>e;e++){var _,g,y,v,m,w,x,E=f[e],C=E.value;for(t=e-1;t>=0&&(_=f[t]).value>C;)w=E._ID,x=_._ID,x>w?(v=w,m=x):(v=x,m=w),~E.side&_.side?r.checkOverlap(h[w],h[x])&&(g=p[v]=p[v]||{},y=g[m]=l.length?l.pop():c.length,c[y]=[a[v],a[m]]):E.side&~_.side&&(g=p[v])&&null!=g[m]&&(y=g[m],c[y]=null,g[m]=null,l.push(y)),f[t+1]=_,t--;f[t+1]=E}}return c},s.prototype.update=function(){var t=this._boundingVolume;t.update();for(var e=this.points,i=0;3>i;i++){var n=o[i];e[n][0].value=t.vertices[n][0],e[n][1].value=t.vertices[n][1]}},t.exports=n},function(t,e,i){"use strict";function n(t,e){s.call(this,t,e)}var s=i(4),r=i(1),o=new r;n.prototype=Object.create(s.prototype),n.prototype.constructor=n,n.QUADRATIC=function(t){return t*t},n.LINEAR=function(t){return t},n.prototype.init=function(){this.max=this.max||1/0,this.strength=this.strength||1,this.type=this.type||n.LINEAR},n.prototype.update=function(){for(var t=this.targets,e=this.type,i=o,n=this.max,s=this.strength,a=0,h=t.length;h>a;a++){var u=t[a],c=u.velocity,p=c.length(),l=p?1/p:0,d=-s*e(p);r.scale(c,(-n>d?-n:d)*l,i),u.applyForce(i)}},t.exports=n},function(t,e,i){"use strict";function n(t,e){s.call(this,t,e)}var s=i(4),r=i(1),o=new r;n.prototype=Object.create(s.prototype),n.prototype.constructor=n,n.DOWN=0,n.UP=1,n.LEFT=2,n.RIGHT=3,n.FORWARD=4,n.BACKWARD=5,n.prototype.init=function(t){if(this.max=this.max||1/0,t.acceleration)return this.strength=this.acceleration.length(),void(this.direction=-1);var e=this.acceleration=new r,i=this.direction=this.direction||n.DOWN,s=this.strength=this.strength||200;switch(i){case n.DOWN:e.set(0,s,0);break;case n.UP:e.set(0,-1*s,0);break;case n.LEFT:e.set(-1*s,0,0);break;case n.RIGHT:e.set(s,0,0);break;case n.FORWARD:e.set(0,0,-1*s);break;case n.BACKWARD:e.set(0,0,s)}},n.prototype.update=function(){for(var t=this.targets,e=o,i=this.max,n=this.acceleration,s=n.length(),a=s?1/s:0,h=0,u=t.length;u>h;h++){var c=t[h],p=s*c.mass;r.scale(n,(p>i?i:p)*a,e),c.applyForce(e)}},t.exports=n},function(t,e,i){"use strict";function n(t,e,i){this.source=t||null,s.call(this,e,i)}var s=i(4),r=i(1),o=new r;n.prototype=Object.create(s.prototype),n.prototype.constructor=n,n.prototype.init=function(){this.max=this.max||1/0,this.strength=this.strength||200},n.prototype.update=function(){for(var t=this.source,e=this.targets,i=o,n=this.strength,s=this.max,a=this.anchor||t.position,h=this.anchor?1:t.mass,u=0,c=e.length;c>u;u++){var p=e[u];r.subtract(a,p.position,i);var l=i.length(),d=l?1/l:0,f=n*h*p.mass*d*d;f=0>f?-s>f?-s:f:f>s?s:f,i.scale(f*d),p.applyForce(i),t&&t.applyForce(i.invert())}},t.exports=n},function(t,e,i){"use strict";function n(t,e){s.call(this,t,e)}var s=i(4),r=i(1),o=new r;n.prototype=Object.create(s.prototype),n.prototype.constructor=n,n.QUADRATIC=function(t){return t.length()},n.LINEAR=function(){return 1},n.prototype.init=function(){this.max=this.max||1/0,this.strength=this.strength||1,this.type=this.type||n.LINEAR},n.prototype.update=function(){for(var t=this.targets,e=this.type,i=o,n=this.max,s=this.strength,a=0,h=t.length;h>a;a++){var u=t[a],c=u.angularVelocity,p=-s*e(c);r.scale(c,-n>p?-n:p,i),u.applyTorque(i)}},t.exports=n},function(t,e,i){"use strict";function n(t,e,i){this.source=t||null,s.call(this,e,i)}var s=i(4),r=i(1),o=i(3),a=i(7),h=new a,u=new r,c=new r,p=new o,l=Math.PI;n.prototype=Object.create(s.prototype),n.prototype.constructor=n,n.prototype.init=function(t){this.source||(this.anchor=this.anchor?this.anchor.normalize():new a(1,0,0,0)),t.stiffness||t.damping?(this.stiffness=this.stiffness||100,this.damping=this.damping||0,this.period=null,this.dampingRatio=null):(t.period||t.dampingRatio)&&(this.period=this.period||1,this.dampingRatio=this.dampingRatio||0,this.stiffness=2*l/this.period,this.stiffness*=this.stiffness,this.damping=4*l*this.dampingRatio/this.period)},n.prototype.update=function(){for(var t=this.source,e=this.targets,i=h,n=u,s=c,l=p,d=this.max,f=this.stiffness,_=this.damping,g=this.anchor||t.orientation,y=this.anchor?null:t.inverseInertia,v=0,m=e.length;m>v;v++){var w=e[v],x=w.orientation;if(a.conjugate(x,i),i.multiply(g),!(i.w>=1)){var E=Math.acos(i.w),C=Math.sqrt(1-i.w*i.w),I=s.copy(i).scale(2*E/C);I.scale(f),null!==y?o.add(y,w.inverseInertia,l).inverse():o.inverse(w.inverseInertia,l),0!==_&&(t?I.add(r.subtract(w.angularVelocity,t.angularVelocity,n).scale(-_)):I.add(r.scale(w.angularVelocity,-_,n)));var T=I.applyMatrix(l),b=T.length();b>d&&T.scale(d/b),w.applyTorque(T),t&&t.applyTorque(T.invert())}}},t.exports=n},function(t,e,i){"use strict";function n(t,e,i){this.source=t||null,s.call(this,e,i)}var s=i(4),r=i(1),o=new r,a=new r;n.prototype=Object.create(s.prototype),n.prototype.constructor=n;var h=Math.PI;n.FENE=function(t,e){var i=.99*e,n=Math.max(Math.min(t,i),-i);return n/(1-n*n/(e*e))},n.HOOKE=function(t){return t},n.prototype.init=function(t){this.max=this.max||1/0,this.length=this.length||0,this.type=this.type||n.HOOKE,this.maxLength=this.maxLength||1/0,t.stiffness||t.damping?(this.stiffness=this.stiffness||100,this.damping=this.damping||0,this.period=null,this.dampingRatio=null):(t.period||t.dampingRatio)&&(this.period=this.period||1,this.dampingRatio=this.dampingRatio||0,this.stiffness=2*h/this.period,this.stiffness*=this.stiffness,this.damping=4*h*this.dampingRatio/this.period)},n.prototype.update=function(){for(var t=this.source,e=this.targets,i=o,n=a,s=this.max,h=this.stiffness,u=this.damping,c=this.length,p=this.maxLength,l=this.anchor||t.position,d=this.anchor?0:t.inverseMass,f=this.type,_=0,g=e.length;g>_;_++){var y=e[_];r.subtract(l,y.position,i);var v=i.length(),m=v-c;if(!(Math.abs(m)<1e-6)){var w=1/(y.inverseMass+d);null!==this.period&&(h*=w,u*=w),i.scale(h*f(m,p)/m),0!==u&&(t?i.add(r.subtract(y.velocity,t.velocity,n).scale(-u)):i.add(r.scale(y.velocity,-u,n)));var x=i.length(),E=x?1/x:0;r.scale(i,(x>s?s:x)*E,i),y.applyForce(i),t&&t.applyForce(i.invert())}}},t.exports=n},function(t,e,i){"use strict";t.exports={Particle:i(10),convexBodyFactory:i(22),Box:i(47),Sphere:i(48),Wall:i(49),Constraint:i(2),Angle:i(50),Collision:i(52),Direction:i(54),Distance:i(55),Curve:i(53),Hinge:i(56),BallAndSocket:i(51),Force:i(4),Drag:i(61),RotationalDrag:i(64),Gravity1D:i(62),Gravity3D:i(63),Spring:i(66),RotationalSpring:i(65),PhysicsEngine:i(25),Geometry:i(21)}},function(t,e,i){"use strict";t.exports={requestAnimationFrame:i(24).requestAnimationFrame,cancelAnimationFrame:i(24).cancelAnimationFrame}},function(t,e,i){"use strict";function n(){var t=this;this._updates=[],this._looper=function(e){t.loop(e)},this._time=0,this._stoppedAt=0,this._sleep=0,this._startOnVisibilityChange=!0,this._rAF=null,this._sleepDiff=!0,this.start(),a&&document.addEventListener(u,function(){t._onVisibilityChange()})}var s=i(68),r=s.requestAnimationFrame,o=s.cancelAnimationFrame,a="undefined"!=typeof document;if(a){var h,u;"undefined"!=typeof document.hidden?(h="hidden",u="visibilitychange"):"undefined"!=typeof document.mozHidden?(h="mozHidden",u="mozvisibilitychange"):"undefined"!=typeof document.msHidden?(h="msHidden",u="msvisibilitychange"):"undefined"!=typeof document.webkitHidden&&(h="webkitHidden",u="webkitvisibilitychange")}n.prototype._onVisibilityChange=function(){document[h]?this._onUnfocus():this._onFocus()},n.prototype._onFocus=function(){this._startOnVisibilityChange&&this._start()},n.prototype._onUnfocus=function(){this._stop()},n.prototype.start=function(){return this._running||(this._startOnVisibilityChange=!0,this._start()),this},n.prototype._start=function(){this._running=!0,this._sleepDiff=!0,this._rAF=r(this._looper)},n.prototype.stop=function(){return this._running&&(this._startOnVisibilityChange=!1,this._stop()),this},n.prototype._stop=function(){this._running=!1,this._stoppedAt=this._time,o(this._rAF)},n.prototype.isRunning=function(){return this._running},n.prototype.step=function(t){this._time=t,this._sleepDiff&&(this._sleep+=t-this._stoppedAt,this._sleepDiff=!1);for(var e=t-this._sleep,i=0,n=this._updates.length;n>i;i++)this._updates[i].update(e);return this},n.prototype.loop=function(t){return this.step(t),this._rAF=r(this._looper),this},n.prototype.update=function(t){return-1===this._updates.indexOf(t)&&this._updates.push(t),this},n.prototype.noLongerUpdate=function(t){var e=this._updates.indexOf(t);return e>-1&&this._updates.splice(e,1),this},t.exports=n},function(t,e,i){"use strict";function n(){r(),this._contexts={},this._outCommands=[],this._inCommands=[],this._time=null,this._resized=!1;var t=this;window.addEventListener("resize",function(){t.onResize()})}var s=i(71),r=i(73),o=i(5);n.prototype.onResize=function(){this._resized=!0;for(var t in this._contexts)this._contexts[t].updateSize()},n.prototype.getTime=function(){return this._time},n.prototype.sendEvent=function(t,e,i){this._outCommands.push(o.WITH,t,o.TRIGGER,e,i)},n.prototype.sendResize=function(t,e){this.sendEvent(t,"CONTEXT_RESIZE",e)},n.prototype.handleWith=function(t,e){var i=e[t],n=i.split("/"),s=this.getOrSetContext(n.shift());return s.receive(i,e,t)},n.prototype.getOrSetContext=function(t){if(this._contexts[t])return this._contexts[t];var e=new s(t,this);return this._contexts[t]=e,e},n.prototype.getContext=function(t){return this._contexts[t]?this._contexts[t]:void 0},n.prototype.drawCommands=function(){for(var t=this._inCommands,e=0,i=t[e];i;){switch(i){case o.TIME:this._time=t[++e];break;case o.WITH:e=this.handleWith(++e,t);break;case o.NEED_SIZE_FOR:this.giveSizeFor(++e,t)}i=t[++e]}for(var n in this._contexts)this._contexts[n].draw();return this._resized&&this.updateSize(),this._outCommands},n.prototype.updateSize=function(){for(var t in this._contexts)this._contexts[t].updateSize()},n.prototype.receiveCommands=function(t){for(var e=t.length,i=0;e>i;i++)this._inCommands.push(t[i]);for(var n in this._contexts)this._contexts[n].checkInit()},n.prototype.giveSizeFor=function(t,e){var i=e[t],n=this.getContext(i);if(n){var s=n.getRootSize();this.sendResize(i,s)}else this.getOrSetContext(i)},n.prototype.clearCommands=function(){this._inCommands.length=0,this._outCommands.length=0,this._resized=!1},t.exports=n},function(t,e,i){"use strict";function n(t,e){if(this._compositor=e,this._rootEl=document.querySelector(t),this._selector=t,null===this._rootEl)throw new Error('Failed to create Context: No matches for "'+t+'" found.');this._selector=t,this._initDOMRenderer(),this._webGLRenderer=null,this._domRenderer=new L(this._domRendererRootEl,t,e),this._canvasEl=null,this._renderState={projectionType:D.ORTHOGRAPHIC_PROJECTION,perspectiveTransform:new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),viewTransform:new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),viewDirty:!1,perspectiveDirty:!1},this._size=[],this._meshTransform=new Float32Array(16),this._meshSize=[0,0,0],this._initDOM=!1,this._commandCallbacks=[],this.initCommandCallbacks(),this.updateSize()}function s(t,e,i,n){return t._webGLRenderer&&t._webGLRenderer.getOrSetCutout(e),t._domRenderer.preventDefault(i[++n]),n}function r(t,e,i,n){return t._webGLRenderer&&t._webGLRenderer.getOrSetCutout(e),t._domRenderer.allowDefault(i[++n]),n}function o(t,e,i,n){return t._initDOM=!0,n}function a(t,e,i,n){return t._domRenderer.insertEl(i[++n]),n}function h(t,e,i,n){return t._domRenderer.getSizeOf(i[++n]),n}function u(t,e,i,n){var s=t._meshTransform;return s[0]=i[++n],s[1]=i[++n],s[2]=i[++n],s[3]=i[++n],s[4]=i[++n],s[5]=i[++n],s[6]=i[++n],s[7]=i[++n],s[8]=i[++n],s[9]=i[++n],s[10]=i[++n],s[11]=i[++n],s[12]=i[++n],s[13]=i[++n],s[14]=i[++n],s[15]=i[++n],t._domRenderer.setMatrix(s),t._webGLRenderer&&t._webGLRenderer.setCutoutUniform(e,"u_transform",s),n}function c(t,e,i,n){var s=i[++n],r=i[++n];return t._domRenderer.setSize(s,r),t._webGLRenderer&&(t._meshSize[0]=s,t._meshSize[1]=r,t._webGLRenderer.setCutoutUniform(e,"u_size",t._meshSize)),n}function p(t,e,i,n){return t._webGLRenderer&&t._webGLRenderer.getOrSetCutout(e),t._domRenderer.setProperty(i[++n],i[++n]),n}function l(t,e,i,n){return t._webGLRenderer&&t._webGLRenderer.getOrSetCutout(e),t._domRenderer.setContent(i[++n]),n}function d(t,e,i,n){return t._webGLRenderer&&t._webGLRenderer.getOrSetCutout(e),t._domRenderer.setAttribute(i[++n],i[++n]),n}function f(t,e,i,n){return t._webGLRenderer&&t._webGLRenderer.getOrSetCutout(e),t._domRenderer.addClass(i[++n]),n}function _(t,e,i,n){return t._webGLRenderer&&t._webGLRenderer.getOrSetCutout(e),t._domRenderer.removeClass(i[++n]),n}function g(t,e,i,n){return t._webGLRenderer&&t._webGLRenderer.getOrSetCutout(e),t._domRenderer.subscribe(i[++n]),n}function y(t,e,i,n){return t._webGLRenderer&&t._webGLRenderer.getOrSetCutout(e),t._domRenderer.unsubscribe(i[++n]),n}function v(t,e,i,n){return t._webGLRenderer||t._initWebGLRenderer(),t._webGLRenderer.setMeshOptions(e,i[++n]),n}function m(t,e,i,n){return t._webGLRenderer||t._initWebGLRenderer(),t._webGLRenderer.setAmbientLightColor(e,i[++n],i[++n],i[++n]),n}function w(t,e,i,n){return t._webGLRenderer||t._initWebGLRenderer(),t._webGLRenderer.setLightPosition(e,i[++n],i[++n],i[++n]),n}function x(t,e,i,n){return t._webGLRenderer||t._initWebGLRenderer(),t._webGLRenderer.setLightColor(e,i[++n],i[++n],i[++n]),n}function E(t,e,i,n){return t._webGLRenderer||t._initWebGLRenderer(),t._webGLRenderer.handleMaterialInput(e,i[++n],i[++n]),n}function C(t,e,i,n){return t._webGLRenderer||t._initWebGLRenderer(),t._webGLRenderer.setGeometry(e,i[++n],i[++n],i[++n]),n}function I(t,e,i,n){return t._webGLRenderer||t._initWebGLRenderer(),t._webGLRenderer.setMeshUniform(e,i[++n],i[++n]),n}function T(t,e,i,n){return t._webGLRenderer||t._initWebGLRenderer(),t._webGLRenderer.bufferData(i[++n],i[++n],i[++n],i[++n],i[++n]),n}function b(t,e,i,n){return t._webGLRenderer||t._initWebGLRenderer(),t._webGLRenderer.setCutoutState(e,i[++n]),n}function z(t,e,i,n){return t._webGLRenderer||t._initWebGLRenderer(),t._webGLRenderer.setMeshVisibility(e,i[++n]),n}function S(t,e,i,n){return t._webGLRenderer||t._initWebGLRenderer(),t._webGLRenderer.removeMesh(e),n}function M(t,e,i,n){return t._renderState.projectionType=D.PINHOLE_PROJECTION,t._renderState.perspectiveTransform[11]=-1/i[++n],t._renderState.perspectiveDirty=!0,n}function R(t,e,i,n){return t._renderState.projectionType=D.ORTHOGRAPHIC_PROJECTION,t._renderState.perspectiveTransform[11]=0,t._renderState.perspectiveDirty=!0,n}function A(t,e,i,n){return t._renderState.viewTransform[0]=i[++n],t._renderState.viewTransform[1]=i[++n],t._renderState.viewTransform[2]=i[++n],t._renderState.viewTransform[3]=i[++n],t._renderState.viewTransform[4]=i[++n],t._renderState.viewTransform[5]=i[++n],t._renderState.viewTransform[6]=i[++n],t._renderState.viewTransform[7]=i[++n],t._renderState.viewTransform[8]=i[++n],t._renderState.viewTransform[9]=i[++n],t._renderState.viewTransform[10]=i[++n],t._renderState.viewTransform[11]=i[++n],t._renderState.viewTransform[12]=i[++n],t._renderState.viewTransform[13]=i[++n],t._renderState.viewTransform[14]=i[++n],t._renderState.viewTransform[15]=i[++n],t._renderState.viewDirty=!0,n}var O=null,D=i(27),L=i(35),P=i(5);n.prototype.updateSize=function(){var t=this._rootEl.offsetWidth,e=this._rootEl.offsetHeight;return this._size[0]=t,this._size[1]=e,this._size[2]=t>e?t:e,this._compositor.sendResize(this._selector,this._size),this._webGLRenderer&&this._webGLRenderer.updateSize(this._size),this},n.prototype.draw=function(){this._domRenderer.draw(this._renderState),this._webGLRenderer&&this._webGLRenderer.draw(this._renderState),this._renderState.perspectiveDirty&&(this._renderState.perspectiveDirty=!1),this._renderState.viewDirty&&(this._renderState.viewDirty=!1)},n.prototype._initDOMRenderer=function(){this._domRendererRootEl=document.createElement("div"),this._rootEl.appendChild(this._domRendererRootEl),this._domRendererRootEl.style.visibility="hidden",this._domRenderer=new L(this._domRendererRootEl,this._selector,this._compositor)},n.prototype.initCommandCallbacks=function(){this._commandCallbacks[P.INIT_DOM]=a,this._commandCallbacks[P.DOM_RENDER_SIZE]=h,this._commandCallbacks[P.CHANGE_TRANSFORM]=u,this._commandCallbacks[P.CHANGE_SIZE]=c,this._commandCallbacks[P.CHANGE_PROPERTY]=p,this._commandCallbacks[P.CHANGE_CONTENT]=l,this._commandCallbacks[P.CHANGE_ATTRIBUTE]=d,this._commandCallbacks[P.ADD_CLASS]=f,this._commandCallbacks[P.REMOVE_CLASS]=_,this._commandCallbacks[P.SUBSCRIBE]=g,this._commandCallbacks[P.UNSUBSCRIBE]=y,this._commandCallbacks[P.GL_SET_DRAW_OPTIONS]=v,this._commandCallbacks[P.GL_AMBIENT_LIGHT]=m,this._commandCallbacks[P.GL_LIGHT_POSITION]=w,this._commandCallbacks[P.GL_LIGHT_COLOR]=x,this._commandCallbacks[P.MATERIAL_INPUT]=E,this._commandCallbacks[P.GL_SET_GEOMETRY]=C,this._commandCallbacks[P.GL_UNIFORMS]=I,this._commandCallbacks[P.GL_BUFFER_DATA]=T,this._commandCallbacks[P.GL_CUTOUT_STATE]=b,this._commandCallbacks[P.GL_MESH_VISIBILITY]=z,this._commandCallbacks[P.GL_REMOVE_MESH]=S,this._commandCallbacks[P.PINHOLE_PROJECTION]=M,this._commandCallbacks[P.ORTHOGRAPHIC_PROJECTION]=R,this._commandCallbacks[P.CHANGE_VIEW_TRANSFORM]=A,this._commandCallbacks[P.PREVENT_DEFAULT]=s,this._commandCallbacks[P.ALLOW_DEFAULT]=r,this._commandCallbacks[P.READY]=o},n.prototype._initWebGLRenderer=function(){this._webGLRendererRootEl=document.createElement("canvas"),this._rootEl.appendChild(this._webGLRendererRootEl),this._webGLRenderer=new O(this._webGLRendererRootEl,this._compositor),this._webGLRenderer.updateSize(this._size)},n.prototype.getRootSize=function(){return[this._rootEl.offsetWidth,this._rootEl.offsetHeight]},n.prototype.checkInit=function(){this._initDOM&&(this._domRendererRootEl.style.visibility="visible",this._initDOM=!1)},n.prototype.receive=function(t,e,i){var n=i,s=e[++n];for(this._domRenderer.loadPath(t);null!=s;){if(s===P.WITH||s===P.TIME)return n-1;n=this._commandCallbacks[s](this,t,e,n)+1,s=e[n]}return n},n.prototype.getDOMRenderer=function(){return this._domRenderer},n.prototype.getWebGLRenderer=function(){return this._webGLRenderer},t.exports=n},function(t,e,i){"use strict";function n(t,e,i){this._thread=t,this._compositor=e,this._renderLoop=i,this._renderLoop.update(this);var n=this;this._thread.onmessage=function(t){var e=t.data?t.data:t;if(e[0]===s.ENGINE)switch(e[1]){case s.START:n._engine.start();break;case s.STOP:n._engine.stop();break;default:console.error('Unknown ENGINE command "'+e[1]+'"')}else n._compositor.receiveCommands(e)},this._thread.onerror=function(t){console.error(t)}}var s=i(5);n.prototype.getThread=function(){return this._thread},n.prototype.getCompositor=function(){return this._compositor},n.prototype.getEngine=function(){return this._renderLoop},n.prototype.getRenderLoop=function(){return this._renderLoop},n.prototype.update=function(t){this._thread.postMessage([s.FRAME,t]);var e=this._compositor.drawCommands();this._thread.postMessage(e),this._compositor.clearCommands()},t.exports=n},function(t,e){"use strict";function i(){if(!s)if(s=!0,document.createStyleSheet){var t=document.createStyleSheet();t.cssText=n}else{var e=document.getElementsByTagName("head")[0],i=document.createElement("style");i.styleSheet?i.styleSheet.cssText=n:i.appendChild(document.createTextNode(n)),(e?e:document.documentElement).appendChild(i)}}var n=".famous-dom-renderer {width:100%;height:100%;transform-style:preserve-3d;-webkit-transform-style:preserve-3d;}.famous-dom-element {-webkit-transform-origin:0% 0%;transform-origin:0% 0%;-webkit-backface-visibility:visible;backface-visibility:visible;-webkit-transform-style:preserve-3d;transform-style:preserve-3d;-webkit-tap-highlight-color:transparent;pointer-events:auto;z-index:1;}.famous-dom-element-content,.famous-dom-element {position:absolute;box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;}.famous-webgl-renderer {-webkit-transform:translateZ(1000000px);transform:translateZ(1000000px);pointer-events:none;position:absolute;z-index:1;top:0;width:100%;height:100%;}",s="undefined"==typeof document;t.exports=i},function(t,e){"use strict";function i(t){for(var e=0;e<n.length;e++){var i=n[e]+t;if(""===document.documentElement.style[i])return i}return t}var n=["","-ms-","-webkit-","-moz-","-o-"];t.exports=i}]);